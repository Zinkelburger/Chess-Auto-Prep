(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var bt=!1,_t=!1,ie=[],wt=-1;function Ri(e){Ni(e)}function Ni(e){ie.includes(e)||ie.push(e),Fi()}function Di(e){let t=ie.indexOf(e);t!==-1&&t>wt&&ie.splice(t,1)}function Fi(){!_t&&!bt&&(bt=!0,queueMicrotask(Bi))}function Bi(){bt=!1,_t=!0;for(let e=0;e<ie.length;e++)ie[e](),wt=e;ie.length=0,wt=-1,_t=!1}var be,he,_e,Wn,yt=!0;function Ki(e){yt=!1,e(),yt=!0}function qi(e){be=e.reactive,_e=e.release,he=t=>e.effect(t,{scheduler:n=>{yt?Ri(n):n()}}),Wn=e.raw}function wn(e){he=e}function ji(e){let t=()=>{};return[r=>{let i=he(r);return e._x_effects||(e._x_effects=new Set,e._x_runEffects=()=>{e._x_effects.forEach(o=>o())}),e._x_effects.add(i),t=()=>{i!==void 0&&(e._x_effects.delete(i),_e(i))},i},()=>{t()}]}function Hn(e,t){let n=!0,r,i=he(()=>{let o=e();JSON.stringify(o),n?r=o:queueMicrotask(()=>{t(o,r),r=o}),n=!1});return()=>_e(i)}var Un=[],Gn=[],Vn=[];function zi(e){Vn.push(e)}function Bt(e,t){typeof t=="function"?(e._x_cleanups||(e._x_cleanups=[]),e._x_cleanups.push(t)):(t=e,Gn.push(t))}function Jn(e){Un.push(e)}function Qn(e,t,n){e._x_attributeCleanups||(e._x_attributeCleanups={}),e._x_attributeCleanups[t]||(e._x_attributeCleanups[t]=[]),e._x_attributeCleanups[t].push(n)}function Yn(e,t){e._x_attributeCleanups&&Object.entries(e._x_attributeCleanups).forEach(([n,r])=>{(t===void 0||t.includes(n))&&(r.forEach(i=>i()),delete e._x_attributeCleanups[n])})}function Wi(e){var t,n;for((t=e._x_effects)==null||t.forEach(Di);(n=e._x_cleanups)!=null&&n.length;)e._x_cleanups.pop()()}var Kt=new MutationObserver(Wt),qt=!1;function jt(){Kt.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),qt=!0}function Zn(){Hi(),Kt.disconnect(),qt=!1}var Ce=[];function Hi(){let e=Kt.takeRecords();Ce.push(()=>e.length>0&&Wt(e));let t=Ce.length;queueMicrotask(()=>{if(Ce.length===t)for(;Ce.length>0;)Ce.shift()()})}function S(e){if(!qt)return e();Zn();let t=e();return jt(),t}var zt=!1,We=[];function Ui(){zt=!0}function Gi(){zt=!1,Wt(We),We=[]}function Wt(e){if(zt){We=We.concat(e);return}let t=[],n=new Set,r=new Map,i=new Map;for(let o=0;o<e.length;o++)if(!e[o].target._x_ignoreMutationObserver&&(e[o].type==="childList"&&(e[o].removedNodes.forEach(s=>{s.nodeType===1&&s._x_marker&&n.add(s)}),e[o].addedNodes.forEach(s=>{if(s.nodeType===1){if(n.has(s)){n.delete(s);return}s._x_marker||t.push(s)}})),e[o].type==="attributes")){let s=e[o].target,a=e[o].attributeName,c=e[o].oldValue,l=()=>{r.has(s)||r.set(s,[]),r.get(s).push({name:a,value:s.getAttribute(a)})},u=()=>{i.has(s)||i.set(s,[]),i.get(s).push(a)};s.hasAttribute(a)&&c===null?l():s.hasAttribute(a)?(u(),l()):u()}i.forEach((o,s)=>{Yn(s,o)}),r.forEach((o,s)=>{Un.forEach(a=>a(s,o))});for(let o of n)t.some(s=>s.contains(o))||Gn.forEach(s=>s(o));for(let o of t)o.isConnected&&Vn.forEach(s=>s(o));t=null,n=null,r=null,i=null}function Xn(e){return le(ce(e))}function Ne(e,t,n){return e._x_dataStack=[t,...ce(n||e)],()=>{e._x_dataStack=e._x_dataStack.filter(r=>r!==t)}}function ce(e){return e._x_dataStack?e._x_dataStack:typeof ShadowRoot=="function"&&e instanceof ShadowRoot?ce(e.host):e.parentNode?ce(e.parentNode):[]}function le(e){return new Proxy({objects:e},Vi)}var Vi={ownKeys({objects:e}){return Array.from(new Set(e.flatMap(t=>Object.keys(t))))},has({objects:e},t){return t==Symbol.unscopables?!1:e.some(n=>Object.prototype.hasOwnProperty.call(n,t)||Reflect.has(n,t))},get({objects:e},t,n){return t=="toJSON"?Ji:Reflect.get(e.find(r=>Reflect.has(r,t))||{},t,n)},set({objects:e},t,n,r){const i=e.find(s=>Object.prototype.hasOwnProperty.call(s,t))||e[e.length-1],o=Object.getOwnPropertyDescriptor(i,t);return o!=null&&o.set&&(o!=null&&o.get)?o.set.call(r,n)||!0:Reflect.set(i,t,n)}};function Ji(){return Reflect.ownKeys(this).reduce((t,n)=>(t[n]=Reflect.get(this,n),t),{})}function Ht(e){let t=r=>typeof r=="object"&&!Array.isArray(r)&&r!==null,n=(r,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(r)).forEach(([o,{value:s,enumerable:a}])=>{if(a===!1||s===void 0||typeof s=="object"&&s!==null&&s.__v_skip)return;let c=i===""?o:`${i}.${o}`;typeof s=="object"&&s!==null&&s._x_interceptor?r[o]=s.initialize(e,c,o):t(s)&&s!==r&&!(s instanceof Element)&&n(s,c)})};return n(e)}function er(e,t=()=>{}){let n={initialValue:void 0,_x_interceptor:!0,initialize(r,i,o){return e(this.initialValue,()=>Qi(r,i),s=>xt(r,i,s),i,o)}};return t(n),r=>{if(typeof r=="object"&&r!==null&&r._x_interceptor){let i=n.initialize.bind(n);n.initialize=(o,s,a)=>{let c=r.initialize(o,s,a);return n.initialValue=c,i(o,s,a)}}else n.initialValue=r;return n}}function Qi(e,t){return t.split(".").reduce((n,r)=>n[r],e)}function xt(e,t,n){if(typeof t=="string"&&(t=t.split(".")),t.length===1)e[t[0]]=n;else{if(t.length===0)throw error;return e[t[0]]||(e[t[0]]={}),xt(e[t[0]],t.slice(1),n)}}var tr={};function K(e,t){tr[e]=t}function $e(e,t){let n=Yi(t);return Object.entries(tr).forEach(([r,i])=>{Object.defineProperty(e,`$${r}`,{get(){return i(t,n)},enumerable:!1})}),e}function Yi(e){let[t,n]=lr(e),r={interceptor:er,...t};return Bt(e,n),r}function Zi(e,t,n,...r){try{return n(...r)}catch(i){Ie(i,e,t)}}function Ie(...e){return nr(...e)}var nr=eo;function Xi(e){nr=e}function eo(e,t,n=void 0){e=Object.assign(e??{message:"No error message given."},{el:t,expression:n}),console.warn(`Alpine Expression Error: ${e.message}

${n?'Expression: "'+n+`"

`:""}`,t),setTimeout(()=>{throw e},0)}var me=!0;function rr(e){let t=me;me=!1;let n=e();return me=t,n}function oe(e,t,n={}){let r;return E(e,t)(i=>r=i,n),r}function E(...e){return ir(...e)}var ir=sr;function to(e){ir=e}var or;function no(e){or=e}function sr(e,t){let n={};$e(n,e);let r=[n,...ce(e)],i=typeof t=="function"?ro(r,t):oo(r,t,e);return Zi.bind(null,e,t,i)}function ro(e,t){return(n=()=>{},{scope:r={},params:i=[],context:o}={})=>{if(!me){Le(n,t,le([r,...e]),i);return}let s=t.apply(le([r,...e]),i);Le(n,s)}}var lt={};function io(e,t){if(lt[e])return lt[e];let n=Object.getPrototypeOf(async function(){}).constructor,r=/^[\n\s]*if.*\(.*\)/.test(e.trim())||/^(let|const)\s/.test(e.trim())?`(async()=>{ ${e} })()`:e,o=(()=>{try{let s=new n(["__self","scope"],`with (scope) { __self.result = ${r} }; __self.finished = true; return __self.result;`);return Object.defineProperty(s,"name",{value:`[Alpine] ${e}`}),s}catch(s){return Ie(s,t,e),Promise.resolve()}})();return lt[e]=o,o}function oo(e,t,n){let r=io(t,n);return(i=()=>{},{scope:o={},params:s=[],context:a}={})=>{r.result=void 0,r.finished=!1;let c=le([o,...e]);if(typeof r=="function"){let l=r.call(a,r,c).catch(u=>Ie(u,n,t));r.finished?(Le(i,r.result,c,s,n),r.result=void 0):l.then(u=>{Le(i,u,c,s,n)}).catch(u=>Ie(u,n,t)).finally(()=>r.result=void 0)}}}function Le(e,t,n,r,i){if(me&&typeof t=="function"){let o=t.apply(n,r);o instanceof Promise?o.then(s=>Le(e,s,n,r)).catch(s=>Ie(s,i,t)):e(o)}else typeof t=="object"&&t instanceof Promise?t.then(o=>e(o)):e(t)}function so(...e){return or(...e)}function ao(e,t,n={}){let r={};$e(r,e);let i=[r,...ce(e)],o=le([n.scope??{},...i]),s=n.params??[];if(t.includes("await")){let a=Object.getPrototypeOf(async function(){}).constructor,c=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(async()=>{ ${t} })()`:t;return new a(["scope"],`with (scope) { let __result = ${c}; return __result }`).call(n.context,o)}else{let a=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(()=>{ ${t} })()`:t,l=new Function(["scope"],`with (scope) { let __result = ${a}; return __result }`).call(n.context,o);return typeof l=="function"&&me?l.apply(o,s):l}}var Ut="x-";function we(e=""){return Ut+e}function co(e){Ut=e}var He={};function C(e,t){return He[e]=t,{before(n){if(!He[n]){console.warn(String.raw`Cannot find directive \`${n}\`. \`${e}\` will use the default order of execution`);return}const r=re.indexOf(n);re.splice(r>=0?r:re.indexOf("DEFAULT"),0,e)}}}function lo(e){return Object.keys(He).includes(e)}function Gt(e,t,n){if(t=Array.from(t),e._x_virtualDirectives){let o=Object.entries(e._x_virtualDirectives).map(([a,c])=>({name:a,value:c})),s=ar(o);o=o.map(a=>s.find(c=>c.name===a.name)?{name:`x-bind:${a.name}`,value:`"${a.value}"`}:a),t=t.concat(o)}let r={};return t.map(dr((o,s)=>r[o]=s)).filter(pr).map(ho(r,n)).sort(po).map(o=>fo(e,o))}function ar(e){return Array.from(e).map(dr()).filter(t=>!pr(t))}var St=!1,Ee=new Map,cr=Symbol();function uo(e){St=!0;let t=Symbol();cr=t,Ee.set(t,[]);let n=()=>{for(;Ee.get(t).length;)Ee.get(t).shift()();Ee.delete(t)},r=()=>{St=!1,n()};e(n),r()}function lr(e){let t=[],n=a=>t.push(a),[r,i]=ji(e);return t.push(i),[{Alpine:xe,effect:r,cleanup:n,evaluateLater:E.bind(E,e),evaluate:oe.bind(oe,e)},()=>t.forEach(a=>a())]}function fo(e,t){let n=()=>{},r=He[t.type]||n,[i,o]=lr(e);Qn(e,t.original,o);let s=()=>{e._x_ignore||e._x_ignoreSelf||(r.inline&&r.inline(e,t,i),r=r.bind(r,e,t,i),St?Ee.get(cr).push(r):r())};return s.runCleanups=o,s}var ur=(e,t)=>({name:n,value:r})=>(n.startsWith(e)&&(n=n.replace(e,t)),{name:n,value:r}),fr=e=>e;function dr(e=()=>{}){return({name:t,value:n})=>{let{name:r,value:i}=hr.reduce((o,s)=>s(o),{name:t,value:n});return r!==t&&e(r,t),{name:r,value:i}}}var hr=[];function Vt(e){hr.push(e)}function pr({name:e}){return gr().test(e)}var gr=()=>new RegExp(`^${Ut}([^:^.]+)\\b`);function ho(e,t){return({name:n,value:r})=>{let i=n.match(gr()),o=n.match(/:([a-zA-Z0-9\-_:]+)/),s=n.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],a=t||e[n]||n;return{type:i?i[1]:null,value:o?o[1]:null,modifiers:s.map(c=>c.replace(".","")),expression:r,original:a}}}var Ct="DEFAULT",re=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",Ct,"teleport"];function po(e,t){let n=re.indexOf(e.type)===-1?Ct:e.type,r=re.indexOf(t.type)===-1?Ct:t.type;return re.indexOf(n)-re.indexOf(r)}function Oe(e,t,n={}){e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))}function ue(e,t){if(typeof ShadowRoot=="function"&&e instanceof ShadowRoot){Array.from(e.children).forEach(i=>ue(i,t));return}let n=!1;if(t(e,()=>n=!0),n)return;let r=e.firstElementChild;for(;r;)ue(r,t),r=r.nextElementSibling}function R(e,...t){console.warn(`Alpine Warning: ${e}`,...t)}var yn=!1;function go(){yn&&R("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),yn=!0,document.body||R("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),Oe(document,"alpine:init"),Oe(document,"alpine:initializing"),jt(),zi(t=>U(t,ue)),Bt(t=>ye(t)),Jn((t,n)=>{Gt(t,n).forEach(r=>r())});let e=t=>!Xe(t.parentElement,!0);Array.from(document.querySelectorAll(br().join(","))).filter(e).forEach(t=>{U(t)}),Oe(document,"alpine:initialized"),setTimeout(()=>{_o()})}var Jt=[],mr=[];function vr(){return Jt.map(e=>e())}function br(){return Jt.concat(mr).map(e=>e())}function _r(e){Jt.push(e)}function wr(e){mr.push(e)}function Xe(e,t=!1){return fe(e,n=>{if((t?br():vr()).some(i=>n.matches(i)))return!0})}function fe(e,t){if(e){if(t(e))return e;if(e._x_teleportBack&&(e=e._x_teleportBack),e.parentNode instanceof ShadowRoot)return fe(e.parentNode.host,t);if(e.parentElement)return fe(e.parentElement,t)}}function mo(e){return vr().some(t=>e.matches(t))}var yr=[];function vo(e){yr.push(e)}var bo=1;function U(e,t=ue,n=()=>{}){fe(e,r=>r._x_ignore)||uo(()=>{t(e,(r,i)=>{r._x_marker||(n(r,i),yr.forEach(o=>o(r,i)),Gt(r,r.attributes).forEach(o=>o()),r._x_ignore||(r._x_marker=bo++),r._x_ignore&&i())})})}function ye(e,t=ue){t(e,n=>{Wi(n),Yn(n),delete n._x_marker})}function _o(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([t,n,r])=>{lo(n)||r.some(i=>{if(document.querySelector(i))return R(`found "${i}", but missing ${t} plugin`),!0})})}var kt=[],Qt=!1;function Yt(e=()=>{}){return queueMicrotask(()=>{Qt||setTimeout(()=>{At()})}),new Promise(t=>{kt.push(()=>{e(),t()})})}function At(){for(Qt=!1;kt.length;)kt.shift()()}function wo(){Qt=!0}function Zt(e,t){return Array.isArray(t)?xn(e,t.join(" ")):typeof t=="object"&&t!==null?yo(e,t):typeof t=="function"?Zt(e,t()):xn(e,t)}function xn(e,t){let n=i=>i.split(" ").filter(o=>!e.classList.contains(o)).filter(Boolean),r=i=>(e.classList.add(...i),()=>{e.classList.remove(...i)});return t=t===!0?t="":t||"",r(n(t))}function yo(e,t){let n=a=>a.split(" ").filter(Boolean),r=Object.entries(t).flatMap(([a,c])=>c?n(a):!1).filter(Boolean),i=Object.entries(t).flatMap(([a,c])=>c?!1:n(a)).filter(Boolean),o=[],s=[];return i.forEach(a=>{e.classList.contains(a)&&(e.classList.remove(a),s.push(a))}),r.forEach(a=>{e.classList.contains(a)||(e.classList.add(a),o.push(a))}),()=>{s.forEach(a=>e.classList.add(a)),o.forEach(a=>e.classList.remove(a))}}function et(e,t){return typeof t=="object"&&t!==null?xo(e,t):So(e,t)}function xo(e,t){let n={};return Object.entries(t).forEach(([r,i])=>{n[r]=e.style[r],r.startsWith("--")||(r=Co(r)),e.style.setProperty(r,i)}),setTimeout(()=>{e.style.length===0&&e.removeAttribute("style")}),()=>{et(e,n)}}function So(e,t){let n=e.getAttribute("style",t);return e.setAttribute("style",t),()=>{e.setAttribute("style",n||"")}}function Co(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Mt(e,t=()=>{}){let n=!1;return function(){n?t.apply(this,arguments):(n=!0,e.apply(this,arguments))}}C("transition",(e,{value:t,modifiers:n,expression:r},{evaluate:i})=>{typeof r=="function"&&(r=i(r)),r!==!1&&(!r||typeof r=="boolean"?Ao(e,n,t):ko(e,r,t))});function ko(e,t,n){xr(e,Zt,""),{enter:i=>{e._x_transition.enter.during=i},"enter-start":i=>{e._x_transition.enter.start=i},"enter-end":i=>{e._x_transition.enter.end=i},leave:i=>{e._x_transition.leave.during=i},"leave-start":i=>{e._x_transition.leave.start=i},"leave-end":i=>{e._x_transition.leave.end=i}}[n](t)}function Ao(e,t,n){xr(e,et);let r=!t.includes("in")&&!t.includes("out")&&!n,i=r||t.includes("in")||["enter"].includes(n),o=r||t.includes("out")||["leave"].includes(n);t.includes("in")&&!r&&(t=t.filter((b,v)=>v<t.indexOf("out"))),t.includes("out")&&!r&&(t=t.filter((b,v)=>v>t.indexOf("out")));let s=!t.includes("opacity")&&!t.includes("scale"),a=s||t.includes("opacity"),c=s||t.includes("scale"),l=a?0:1,u=c?ke(t,"scale",95)/100:1,f=ke(t,"delay",0)/1e3,d=ke(t,"origin","center"),h="opacity, transform",p=ke(t,"duration",150)/1e3,m=ke(t,"duration",75)/1e3,g="cubic-bezier(0.4, 0.0, 0.2, 1)";i&&(e._x_transition.enter.during={transformOrigin:d,transitionDelay:`${f}s`,transitionProperty:h,transitionDuration:`${p}s`,transitionTimingFunction:g},e._x_transition.enter.start={opacity:l,transform:`scale(${u})`},e._x_transition.enter.end={opacity:1,transform:"scale(1)"}),o&&(e._x_transition.leave.during={transformOrigin:d,transitionDelay:`${f}s`,transitionProperty:h,transitionDuration:`${m}s`,transitionTimingFunction:g},e._x_transition.leave.start={opacity:1,transform:"scale(1)"},e._x_transition.leave.end={opacity:l,transform:`scale(${u})`})}function xr(e,t,n={}){e._x_transition||(e._x_transition={enter:{during:n,start:n,end:n},leave:{during:n,start:n,end:n},in(r=()=>{},i=()=>{}){Pt(e,t,{during:this.enter.during,start:this.enter.start,end:this.enter.end},r,i)},out(r=()=>{},i=()=>{}){Pt(e,t,{during:this.leave.during,start:this.leave.start,end:this.leave.end},r,i)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(e,t,n,r){const i=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let o=()=>i(n);if(t){e._x_transition&&(e._x_transition.enter||e._x_transition.leave)?e._x_transition.enter&&(Object.entries(e._x_transition.enter.during).length||Object.entries(e._x_transition.enter.start).length||Object.entries(e._x_transition.enter.end).length)?e._x_transition.in(n):o():e._x_transition?e._x_transition.in(n):o();return}e._x_hidePromise=e._x_transition?new Promise((s,a)=>{e._x_transition.out(()=>{},()=>s(r)),e._x_transitioning&&e._x_transitioning.beforeCancel(()=>a({isFromCancelledTransition:!0}))}):Promise.resolve(r),queueMicrotask(()=>{let s=Sr(e);s?(s._x_hideChildren||(s._x_hideChildren=[]),s._x_hideChildren.push(e)):i(()=>{let a=c=>{let l=Promise.all([c._x_hidePromise,...(c._x_hideChildren||[]).map(a)]).then(([u])=>u==null?void 0:u());return delete c._x_hidePromise,delete c._x_hideChildren,l};a(e).catch(c=>{if(!c.isFromCancelledTransition)throw c})})})};function Sr(e){let t=e.parentNode;if(t)return t._x_hidePromise?t:Sr(t)}function Pt(e,t,{during:n,start:r,end:i}={},o=()=>{},s=()=>{}){if(e._x_transitioning&&e._x_transitioning.cancel(),Object.keys(n).length===0&&Object.keys(r).length===0&&Object.keys(i).length===0){o(),s();return}let a,c,l;Mo(e,{start(){a=t(e,r)},during(){c=t(e,n)},before:o,end(){a(),l=t(e,i)},after:s,cleanup(){c(),l()}})}function Mo(e,t){let n,r,i,o=Mt(()=>{S(()=>{n=!0,r||t.before(),i||(t.end(),At()),t.after(),e.isConnected&&t.cleanup(),delete e._x_transitioning})});e._x_transitioning={beforeCancels:[],beforeCancel(s){this.beforeCancels.push(s)},cancel:Mt(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();o()}),finish:o},S(()=>{t.start(),t.during()}),wo(),requestAnimationFrame(()=>{if(n)return;let s=Number(getComputedStyle(e).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,a=Number(getComputedStyle(e).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;s===0&&(s=Number(getComputedStyle(e).animationDuration.replace("s",""))*1e3),S(()=>{t.before()}),r=!0,requestAnimationFrame(()=>{n||(S(()=>{t.end()}),At(),setTimeout(e._x_transitioning.finish,s+a),i=!0)})})}function ke(e,t,n){if(e.indexOf(t)===-1)return n;const r=e[e.indexOf(t)+1];if(!r||t==="scale"&&isNaN(r))return n;if(t==="duration"||t==="delay"){let i=r.match(/([0-9]+)ms/);if(i)return i[1]}return t==="origin"&&["top","right","left","center","bottom"].includes(e[e.indexOf(t)+2])?[r,e[e.indexOf(t)+2]].join(" "):r}var Q=!1;function Z(e,t=()=>{}){return(...n)=>Q?t(...n):e(...n)}function Po(e){return(...t)=>Q&&e(...t)}var Cr=[];function tt(e){Cr.push(e)}function Eo(e,t){Cr.forEach(n=>n(e,t)),Q=!0,kr(()=>{U(t,(n,r)=>{r(n,()=>{})})}),Q=!1}var Et=!1;function Oo(e,t){t._x_dataStack||(t._x_dataStack=e._x_dataStack),Q=!0,Et=!0,kr(()=>{To(t)}),Q=!1,Et=!1}function To(e){let t=!1;U(e,(r,i)=>{ue(r,(o,s)=>{if(t&&mo(o))return s();t=!0,i(o,s)})})}function kr(e){let t=he;wn((n,r)=>{let i=t(n);return _e(i),()=>{}}),e(),wn(t)}function Ar(e,t,n,r=[]){switch(e._x_bindings||(e._x_bindings=be({})),e._x_bindings[t]=n,t=r.includes("camel")?Bo(t):t,t){case"value":$o(e,n);break;case"style":Lo(e,n);break;case"class":Io(e,n);break;case"selected":case"checked":Ro(e,t,n);break;default:Mr(e,t,n);break}}function $o(e,t){if(Or(e))e.attributes.value===void 0&&(e.value=t),window.fromModel&&(typeof t=="boolean"?e.checked=ze(e.value)===t:e.checked=Sn(e.value,t));else if(Xt(e))Number.isInteger(t)?e.value=t:!Array.isArray(t)&&typeof t!="boolean"&&![null,void 0].includes(t)?e.value=String(t):Array.isArray(t)?e.checked=t.some(n=>Sn(n,e.value)):e.checked=!!t;else if(e.tagName==="SELECT")Fo(e,t);else{if(e.value===t)return;e.value=t===void 0?"":t}}function Io(e,t){e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedClasses=Zt(e,t)}function Lo(e,t){e._x_undoAddedStyles&&e._x_undoAddedStyles(),e._x_undoAddedStyles=et(e,t)}function Ro(e,t,n){Mr(e,t,n),Do(e,t,n)}function Mr(e,t,n){[null,void 0,!1].includes(n)&&qo(t)?e.removeAttribute(t):(Pr(t)&&(n=t),No(e,t,n))}function No(e,t,n){e.getAttribute(t)!=n&&e.setAttribute(t,n)}function Do(e,t,n){e[t]!==n&&(e[t]=n)}function Fo(e,t){const n=[].concat(t).map(r=>r+"");Array.from(e.options).forEach(r=>{r.selected=n.includes(r.value)})}function Bo(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function Sn(e,t){return e==t}function ze(e){return[1,"1","true","on","yes",!0].includes(e)?!0:[0,"0","false","off","no",!1].includes(e)?!1:e?!!e:null}var Ko=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function Pr(e){return Ko.has(e)}function qo(e){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(e)}function jo(e,t,n){return e._x_bindings&&e._x_bindings[t]!==void 0?e._x_bindings[t]:Er(e,t,n)}function zo(e,t,n,r=!0){if(e._x_bindings&&e._x_bindings[t]!==void 0)return e._x_bindings[t];if(e._x_inlineBindings&&e._x_inlineBindings[t]!==void 0){let i=e._x_inlineBindings[t];return i.extract=r,rr(()=>oe(e,i.expression))}return Er(e,t,n)}function Er(e,t,n){let r=e.getAttribute(t);return r===null?typeof n=="function"?n():n:r===""?!0:Pr(t)?!![t,"true"].includes(r):r}function Xt(e){return e.type==="checkbox"||e.localName==="ui-checkbox"||e.localName==="ui-switch"}function Or(e){return e.type==="radio"||e.localName==="ui-radio"}function Tr(e,t){let n;return function(){const r=this,i=arguments,o=function(){n=null,e.apply(r,i)};clearTimeout(n),n=setTimeout(o,t)}}function $r(e,t){let n;return function(){let r=this,i=arguments;n||(e.apply(r,i),n=!0,setTimeout(()=>n=!1,t))}}function Ir({get:e,set:t},{get:n,set:r}){let i=!0,o,s=he(()=>{let a=e(),c=n();if(i)r(ut(a)),i=!1;else{let l=JSON.stringify(a),u=JSON.stringify(c);l!==o?r(ut(a)):l!==u&&t(ut(c))}o=JSON.stringify(e()),JSON.stringify(n())});return()=>{_e(s)}}function ut(e){return typeof e=="object"?JSON.parse(JSON.stringify(e)):e}function Wo(e){(Array.isArray(e)?e:[e]).forEach(n=>n(xe))}var te={},Cn=!1;function Ho(e,t){if(Cn||(te=be(te),Cn=!0),t===void 0)return te[e];te[e]=t,Ht(te[e]),typeof t=="object"&&t!==null&&t.hasOwnProperty("init")&&typeof t.init=="function"&&te[e].init()}function Uo(){return te}var Lr={};function Go(e,t){let n=typeof t!="function"?()=>t:t;return e instanceof Element?Rr(e,n()):(Lr[e]=n,()=>{})}function Vo(e){return Object.entries(Lr).forEach(([t,n])=>{Object.defineProperty(e,t,{get(){return(...r)=>n(...r)}})}),e}function Rr(e,t,n){let r=[];for(;r.length;)r.pop()();let i=Object.entries(t).map(([s,a])=>({name:s,value:a})),o=ar(i);return i=i.map(s=>o.find(a=>a.name===s.name)?{name:`x-bind:${s.name}`,value:`"${s.value}"`}:s),Gt(e,i,n).map(s=>{r.push(s.runCleanups),s()}),()=>{for(;r.length;)r.pop()()}}var Nr={};function Jo(e,t){Nr[e]=t}function Qo(e,t){return Object.entries(Nr).forEach(([n,r])=>{Object.defineProperty(e,n,{get(){return(...i)=>r.bind(t)(...i)},enumerable:!1})}),e}var Yo={get reactive(){return be},get release(){return _e},get effect(){return he},get raw(){return Wn},version:"3.15.3",flushAndStopDeferringMutations:Gi,dontAutoEvaluateFunctions:rr,disableEffectScheduling:Ki,startObservingMutations:jt,stopObservingMutations:Zn,setReactivityEngine:qi,onAttributeRemoved:Qn,onAttributesAdded:Jn,closestDataStack:ce,skipDuringClone:Z,onlyDuringClone:Po,addRootSelector:_r,addInitSelector:wr,setErrorHandler:Xi,interceptClone:tt,addScopeToNode:Ne,deferMutations:Ui,mapAttributes:Vt,evaluateLater:E,interceptInit:vo,initInterceptors:Ht,injectMagics:$e,setEvaluator:to,setRawEvaluator:no,mergeProxies:le,extractProp:zo,findClosest:fe,onElRemoved:Bt,closestRoot:Xe,destroyTree:ye,interceptor:er,transition:Pt,setStyles:et,mutateDom:S,directive:C,entangle:Ir,throttle:$r,debounce:Tr,evaluate:oe,evaluateRaw:so,initTree:U,nextTick:Yt,prefixed:we,prefix:co,plugin:Wo,magic:K,store:Ho,start:go,clone:Oo,cloneNode:Eo,bound:jo,$data:Xn,watch:Hn,walk:ue,data:Jo,bind:Go},xe=Yo;function Zo(e,t){const n=Object.create(null),r=e.split(",");for(let i=0;i<r.length;i++)n[r[i]]=!0;return i=>!!n[i]}var Xo=Object.freeze({}),es=Object.prototype.hasOwnProperty,nt=(e,t)=>es.call(e,t),se=Array.isArray,Te=e=>Dr(e)==="[object Map]",ts=e=>typeof e=="string",en=e=>typeof e=="symbol",rt=e=>e!==null&&typeof e=="object",ns=Object.prototype.toString,Dr=e=>ns.call(e),Fr=e=>Dr(e).slice(8,-1),tn=e=>ts(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,rs=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},is=rs(e=>e.charAt(0).toUpperCase()+e.slice(1)),Br=(e,t)=>e!==t&&(e===e||t===t),Ot=new WeakMap,Ae=[],j,ae=Symbol("iterate"),Tt=Symbol("Map key iterate");function os(e){return e&&e._isEffect===!0}function ss(e,t=Xo){os(e)&&(e=e.raw);const n=ls(e,t);return t.lazy||n(),n}function as(e){e.active&&(Kr(e),e.options.onStop&&e.options.onStop(),e.active=!1)}var cs=0;function ls(e,t){const n=function(){if(!n.active)return e();if(!Ae.includes(n)){Kr(n);try{return fs(),Ae.push(n),j=n,e()}finally{Ae.pop(),qr(),j=Ae[Ae.length-1]}}};return n.id=cs++,n.allowRecurse=!!t.allowRecurse,n._isEffect=!0,n.active=!0,n.raw=e,n.deps=[],n.options=t,n}function Kr(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}var ve=!0,nn=[];function us(){nn.push(ve),ve=!1}function fs(){nn.push(ve),ve=!0}function qr(){const e=nn.pop();ve=e===void 0?!0:e}function B(e,t,n){if(!ve||j===void 0)return;let r=Ot.get(e);r||Ot.set(e,r=new Map);let i=r.get(n);i||r.set(n,i=new Set),i.has(j)||(i.add(j),j.deps.push(i),j.options.onTrack&&j.options.onTrack({effect:j,target:e,type:t,key:n}))}function Y(e,t,n,r,i,o){const s=Ot.get(e);if(!s)return;const a=new Set,c=u=>{u&&u.forEach(f=>{(f!==j||f.allowRecurse)&&a.add(f)})};if(t==="clear")s.forEach(c);else if(n==="length"&&se(e))s.forEach((u,f)=>{(f==="length"||f>=r)&&c(u)});else switch(n!==void 0&&c(s.get(n)),t){case"add":se(e)?tn(n)&&c(s.get("length")):(c(s.get(ae)),Te(e)&&c(s.get(Tt)));break;case"delete":se(e)||(c(s.get(ae)),Te(e)&&c(s.get(Tt)));break;case"set":Te(e)&&c(s.get(ae));break}const l=u=>{u.options.onTrigger&&u.options.onTrigger({effect:u,target:e,key:n,type:t,newValue:r,oldValue:i,oldTarget:o}),u.options.scheduler?u.options.scheduler(u):u()};a.forEach(l)}var ds=Zo("__proto__,__v_isRef,__isVue"),jr=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(en)),hs=zr(),ps=zr(!0),kn=gs();function gs(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const r=y(this);for(let o=0,s=this.length;o<s;o++)B(r,"get",o+"");const i=r[t](...n);return i===-1||i===!1?r[t](...n.map(y)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){us();const r=y(this)[t].apply(this,n);return qr(),r}}),e}function zr(e=!1,t=!1){return function(r,i,o){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_raw"&&o===(e?t?Es:Gr:t?Ps:Ur).get(r))return r;const s=se(r);if(!e&&s&&nt(kn,i))return Reflect.get(kn,i,o);const a=Reflect.get(r,i,o);return(en(i)?jr.has(i):ds(i))||(e||B(r,"get",i),t)?a:$t(a)?!s||!tn(i)?a.value:a:rt(a)?e?Vr(a):an(a):a}}var ms=vs();function vs(e=!1){return function(n,r,i,o){let s=n[r];if(!e&&(i=y(i),s=y(s),!se(n)&&$t(s)&&!$t(i)))return s.value=i,!0;const a=se(n)&&tn(r)?Number(r)<n.length:nt(n,r),c=Reflect.set(n,r,i,o);return n===y(o)&&(a?Br(i,s)&&Y(n,"set",r,i,s):Y(n,"add",r,i)),c}}function bs(e,t){const n=nt(e,t),r=e[t],i=Reflect.deleteProperty(e,t);return i&&n&&Y(e,"delete",t,void 0,r),i}function _s(e,t){const n=Reflect.has(e,t);return(!en(t)||!jr.has(t))&&B(e,"has",t),n}function ws(e){return B(e,"iterate",se(e)?"length":ae),Reflect.ownKeys(e)}var ys={get:hs,set:ms,deleteProperty:bs,has:_s,ownKeys:ws},xs={get:ps,set(e,t){return console.warn(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0},deleteProperty(e,t){return console.warn(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0}},rn=e=>rt(e)?an(e):e,on=e=>rt(e)?Vr(e):e,sn=e=>e,it=e=>Reflect.getPrototypeOf(e);function Fe(e,t,n=!1,r=!1){e=e.__v_raw;const i=y(e),o=y(t);t!==o&&!n&&B(i,"get",t),!n&&B(i,"get",o);const{has:s}=it(i),a=r?sn:n?on:rn;if(s.call(i,t))return a(e.get(t));if(s.call(i,o))return a(e.get(o));e!==i&&e.get(t)}function Be(e,t=!1){const n=this.__v_raw,r=y(n),i=y(e);return e!==i&&!t&&B(r,"has",e),!t&&B(r,"has",i),e===i?n.has(e):n.has(e)||n.has(i)}function Ke(e,t=!1){return e=e.__v_raw,!t&&B(y(e),"iterate",ae),Reflect.get(e,"size",e)}function An(e){e=y(e);const t=y(this);return it(t).has.call(t,e)||(t.add(e),Y(t,"add",e,e)),this}function Mn(e,t){t=y(t);const n=y(this),{has:r,get:i}=it(n);let o=r.call(n,e);o?Hr(n,r,e):(e=y(e),o=r.call(n,e));const s=i.call(n,e);return n.set(e,t),o?Br(t,s)&&Y(n,"set",e,t,s):Y(n,"add",e,t),this}function Pn(e){const t=y(this),{has:n,get:r}=it(t);let i=n.call(t,e);i?Hr(t,n,e):(e=y(e),i=n.call(t,e));const o=r?r.call(t,e):void 0,s=t.delete(e);return i&&Y(t,"delete",e,void 0,o),s}function En(){const e=y(this),t=e.size!==0,n=Te(e)?new Map(e):new Set(e),r=e.clear();return t&&Y(e,"clear",void 0,void 0,n),r}function qe(e,t){return function(r,i){const o=this,s=o.__v_raw,a=y(s),c=t?sn:e?on:rn;return!e&&B(a,"iterate",ae),s.forEach((l,u)=>r.call(i,c(l),c(u),o))}}function je(e,t,n){return function(...r){const i=this.__v_raw,o=y(i),s=Te(o),a=e==="entries"||e===Symbol.iterator&&s,c=e==="keys"&&s,l=i[e](...r),u=n?sn:t?on:rn;return!t&&B(o,"iterate",c?Tt:ae),{next(){const{value:f,done:d}=l.next();return d?{value:f,done:d}:{value:a?[u(f[0]),u(f[1])]:u(f),done:d}},[Symbol.iterator](){return this}}}}function V(e){return function(...t){{const n=t[0]?`on key "${t[0]}" `:"";console.warn(`${is(e)} operation ${n}failed: target is readonly.`,y(this))}return e==="delete"?!1:this}}function Ss(){const e={get(o){return Fe(this,o)},get size(){return Ke(this)},has:Be,add:An,set:Mn,delete:Pn,clear:En,forEach:qe(!1,!1)},t={get(o){return Fe(this,o,!1,!0)},get size(){return Ke(this)},has:Be,add:An,set:Mn,delete:Pn,clear:En,forEach:qe(!1,!0)},n={get(o){return Fe(this,o,!0)},get size(){return Ke(this,!0)},has(o){return Be.call(this,o,!0)},add:V("add"),set:V("set"),delete:V("delete"),clear:V("clear"),forEach:qe(!0,!1)},r={get(o){return Fe(this,o,!0,!0)},get size(){return Ke(this,!0)},has(o){return Be.call(this,o,!0)},add:V("add"),set:V("set"),delete:V("delete"),clear:V("clear"),forEach:qe(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(o=>{e[o]=je(o,!1,!1),n[o]=je(o,!0,!1),t[o]=je(o,!1,!0),r[o]=je(o,!0,!0)}),[e,n,t,r]}var[Cs,ks]=Ss();function Wr(e,t){const n=e?ks:Cs;return(r,i,o)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?r:Reflect.get(nt(n,i)&&i in r?n:r,i,o)}var As={get:Wr(!1)},Ms={get:Wr(!0)};function Hr(e,t,n){const r=y(n);if(r!==n&&t.call(e,r)){const i=Fr(e);console.warn(`Reactive ${i} contains both the raw and reactive versions of the same object${i==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var Ur=new WeakMap,Ps=new WeakMap,Gr=new WeakMap,Es=new WeakMap;function Os(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Ts(e){return e.__v_skip||!Object.isExtensible(e)?0:Os(Fr(e))}function an(e){return e&&e.__v_isReadonly?e:Jr(e,!1,ys,As,Ur)}function Vr(e){return Jr(e,!0,xs,Ms,Gr)}function Jr(e,t,n,r,i){if(!rt(e))return console.warn(`value cannot be made reactive: ${String(e)}`),e;if(e.__v_raw&&!(t&&e.__v_isReactive))return e;const o=i.get(e);if(o)return o;const s=Ts(e);if(s===0)return e;const a=new Proxy(e,s===2?r:n);return i.set(e,a),a}function y(e){return e&&y(e.__v_raw)||e}function $t(e){return!!(e&&e.__v_isRef===!0)}K("nextTick",()=>Yt);K("dispatch",e=>Oe.bind(Oe,e));K("watch",(e,{evaluateLater:t,cleanup:n})=>(r,i)=>{let o=t(r),a=Hn(()=>{let c;return o(l=>c=l),c},i);n(a)});K("store",Uo);K("data",e=>Xn(e));K("root",e=>Xe(e));K("refs",e=>(e._x_refs_proxy||(e._x_refs_proxy=le($s(e))),e._x_refs_proxy));function $s(e){let t=[];return fe(e,n=>{n._x_refs&&t.push(n._x_refs)}),t}var ft={};function Qr(e){return ft[e]||(ft[e]=0),++ft[e]}function Is(e,t){return fe(e,n=>{if(n._x_ids&&n._x_ids[t])return!0})}function Ls(e,t){e._x_ids||(e._x_ids={}),e._x_ids[t]||(e._x_ids[t]=Qr(t))}K("id",(e,{cleanup:t})=>(n,r=null)=>{let i=`${n}${r?`-${r}`:""}`;return Rs(e,i,t,()=>{let o=Is(e,n),s=o?o._x_ids[n]:Qr(n);return r?`${n}-${s}-${r}`:`${n}-${s}`})});tt((e,t)=>{e._x_id&&(t._x_id=e._x_id)});function Rs(e,t,n,r){if(e._x_id||(e._x_id={}),e._x_id[t])return e._x_id[t];let i=r();return e._x_id[t]=i,n(()=>{delete e._x_id[t]}),i}K("el",e=>e);Yr("Focus","focus","focus");Yr("Persist","persist","persist");function Yr(e,t,n){K(t,r=>R(`You can't use [$${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,r))}C("modelable",(e,{expression:t},{effect:n,evaluateLater:r,cleanup:i})=>{let o=r(t),s=()=>{let u;return o(f=>u=f),u},a=r(`${t} = __placeholder`),c=u=>a(()=>{},{scope:{__placeholder:u}}),l=s();c(l),queueMicrotask(()=>{if(!e._x_model)return;e._x_removeModelListeners.default();let u=e._x_model.get,f=e._x_model.set,d=Ir({get(){return u()},set(h){f(h)}},{get(){return s()},set(h){c(h)}});i(d)})});C("teleport",(e,{modifiers:t,expression:n},{cleanup:r})=>{e.tagName.toLowerCase()!=="template"&&R("x-teleport can only be used on a <template> tag",e);let i=On(n),o=e.content.cloneNode(!0).firstElementChild;e._x_teleport=o,o._x_teleportBack=e,e.setAttribute("data-teleport-template",!0),o.setAttribute("data-teleport-target",!0),e._x_forwardEvents&&e._x_forwardEvents.forEach(a=>{o.addEventListener(a,c=>{c.stopPropagation(),e.dispatchEvent(new c.constructor(c.type,c))})}),Ne(o,{},e);let s=(a,c,l)=>{l.includes("prepend")?c.parentNode.insertBefore(a,c):l.includes("append")?c.parentNode.insertBefore(a,c.nextSibling):c.appendChild(a)};S(()=>{s(o,i,t),Z(()=>{U(o)})()}),e._x_teleportPutBack=()=>{let a=On(n);S(()=>{s(e._x_teleport,a,t)})},r(()=>S(()=>{o.remove(),ye(o)}))});var Ns=document.createElement("div");function On(e){let t=Z(()=>document.querySelector(e),()=>Ns)();return t||R(`Cannot find x-teleport element for selector: "${e}"`),t}var Zr=()=>{};Zr.inline=(e,{modifiers:t},{cleanup:n})=>{t.includes("self")?e._x_ignoreSelf=!0:e._x_ignore=!0,n(()=>{t.includes("self")?delete e._x_ignoreSelf:delete e._x_ignore})};C("ignore",Zr);C("effect",Z((e,{expression:t},{effect:n})=>{n(E(e,t))}));function It(e,t,n,r){let i=e,o=c=>r(c),s={},a=(c,l)=>u=>l(c,u);if(n.includes("dot")&&(t=Ds(t)),n.includes("camel")&&(t=Fs(t)),n.includes("passive")&&(s.passive=!0),n.includes("capture")&&(s.capture=!0),n.includes("window")&&(i=window),n.includes("document")&&(i=document),n.includes("debounce")){let c=n[n.indexOf("debounce")+1]||"invalid-wait",l=Ue(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=Tr(o,l)}if(n.includes("throttle")){let c=n[n.indexOf("throttle")+1]||"invalid-wait",l=Ue(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=$r(o,l)}return n.includes("prevent")&&(o=a(o,(c,l)=>{l.preventDefault(),c(l)})),n.includes("stop")&&(o=a(o,(c,l)=>{l.stopPropagation(),c(l)})),n.includes("once")&&(o=a(o,(c,l)=>{c(l),i.removeEventListener(t,o,s)})),(n.includes("away")||n.includes("outside"))&&(i=document,o=a(o,(c,l)=>{e.contains(l.target)||l.target.isConnected!==!1&&(e.offsetWidth<1&&e.offsetHeight<1||e._x_isShown!==!1&&c(l))})),n.includes("self")&&(o=a(o,(c,l)=>{l.target===e&&c(l)})),(Ks(t)||Xr(t))&&(o=a(o,(c,l)=>{qs(l,n)||c(l)})),i.addEventListener(t,o,s),()=>{i.removeEventListener(t,o,s)}}function Ds(e){return e.replace(/-/g,".")}function Fs(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function Ue(e){return!Array.isArray(e)&&!isNaN(e)}function Bs(e){return[" ","_"].includes(e)?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function Ks(e){return["keydown","keyup"].includes(e)}function Xr(e){return["contextmenu","click","mouse"].some(t=>e.includes(t))}function qs(e,t){let n=t.filter(o=>!["window","document","prevent","stop","once","capture","self","away","outside","passive","preserve-scroll"].includes(o));if(n.includes("debounce")){let o=n.indexOf("debounce");n.splice(o,Ue((n[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.includes("throttle")){let o=n.indexOf("throttle");n.splice(o,Ue((n[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.length===0||n.length===1&&Tn(e.key).includes(n[0]))return!1;const i=["ctrl","shift","alt","meta","cmd","super"].filter(o=>n.includes(o));return n=n.filter(o=>!i.includes(o)),!(i.length>0&&i.filter(s=>((s==="cmd"||s==="super")&&(s="meta"),e[`${s}Key`])).length===i.length&&(Xr(e.type)||Tn(e.key).includes(n[0])))}function Tn(e){if(!e)return[];e=Bs(e);let t={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return t[e]=e,Object.keys(t).map(n=>{if(t[n]===e)return n}).filter(n=>n)}C("model",(e,{modifiers:t,expression:n},{effect:r,cleanup:i})=>{let o=e;t.includes("parent")&&(o=e.parentNode);let s=E(o,n),a;typeof n=="string"?a=E(o,`${n} = __placeholder`):typeof n=="function"&&typeof n()=="string"?a=E(o,`${n()} = __placeholder`):a=()=>{};let c=()=>{let d;return s(h=>d=h),$n(d)?d.get():d},l=d=>{let h;s(p=>h=p),$n(h)?h.set(d):a(()=>{},{scope:{__placeholder:d}})};typeof n=="string"&&e.type==="radio"&&S(()=>{e.hasAttribute("name")||e.setAttribute("name",n)});let u=e.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(e.type)||t.includes("lazy")?"change":"input",f=Q?()=>{}:It(e,u,t,d=>{l(dt(e,t,d,c()))});if(t.includes("fill")&&([void 0,null,""].includes(c())||Xt(e)&&Array.isArray(c())||e.tagName.toLowerCase()==="select"&&e.multiple)&&l(dt(e,t,{target:e},c())),e._x_removeModelListeners||(e._x_removeModelListeners={}),e._x_removeModelListeners.default=f,i(()=>e._x_removeModelListeners.default()),e.form){let d=It(e.form,"reset",[],h=>{Yt(()=>e._x_model&&e._x_model.set(dt(e,t,{target:e},c())))});i(()=>d())}e._x_model={get(){return c()},set(d){l(d)}},e._x_forceModelUpdate=d=>{d===void 0&&typeof n=="string"&&n.match(/\./)&&(d=""),window.fromModel=!0,S(()=>Ar(e,"value",d)),delete window.fromModel},r(()=>{let d=c();t.includes("unintrusive")&&document.activeElement.isSameNode(e)||e._x_forceModelUpdate(d)})});function dt(e,t,n,r){return S(()=>{if(n instanceof CustomEvent&&n.detail!==void 0)return n.detail!==null&&n.detail!==void 0?n.detail:n.target.value;if(Xt(e))if(Array.isArray(r)){let i=null;return t.includes("number")?i=ht(n.target.value):t.includes("boolean")?i=ze(n.target.value):i=n.target.value,n.target.checked?r.includes(i)?r:r.concat([i]):r.filter(o=>!js(o,i))}else return n.target.checked;else{if(e.tagName.toLowerCase()==="select"&&e.multiple)return t.includes("number")?Array.from(n.target.selectedOptions).map(i=>{let o=i.value||i.text;return ht(o)}):t.includes("boolean")?Array.from(n.target.selectedOptions).map(i=>{let o=i.value||i.text;return ze(o)}):Array.from(n.target.selectedOptions).map(i=>i.value||i.text);{let i;return Or(e)?n.target.checked?i=n.target.value:i=r:i=n.target.value,t.includes("number")?ht(i):t.includes("boolean")?ze(i):t.includes("trim")?i.trim():i}}})}function ht(e){let t=e?parseFloat(e):null;return zs(t)?t:e}function js(e,t){return e==t}function zs(e){return!Array.isArray(e)&&!isNaN(e)}function $n(e){return e!==null&&typeof e=="object"&&typeof e.get=="function"&&typeof e.set=="function"}C("cloak",e=>queueMicrotask(()=>S(()=>e.removeAttribute(we("cloak")))));wr(()=>`[${we("init")}]`);C("init",Z((e,{expression:t},{evaluate:n})=>typeof t=="string"?!!t.trim()&&n(t,{},!1):n(t,{},!1)));C("text",(e,{expression:t},{effect:n,evaluateLater:r})=>{let i=r(t);n(()=>{i(o=>{S(()=>{e.textContent=o})})})});C("html",(e,{expression:t},{effect:n,evaluateLater:r})=>{let i=r(t);n(()=>{i(o=>{S(()=>{e.innerHTML=o,e._x_ignoreSelf=!0,U(e),delete e._x_ignoreSelf})})})});Vt(ur(":",fr(we("bind:"))));var ei=(e,{value:t,modifiers:n,expression:r,original:i},{effect:o,cleanup:s})=>{if(!t){let c={};Vo(c),E(e,r)(u=>{Rr(e,u,i)},{scope:c});return}if(t==="key")return Ws(e,r);if(e._x_inlineBindings&&e._x_inlineBindings[t]&&e._x_inlineBindings[t].extract)return;let a=E(e,r);o(()=>a(c=>{c===void 0&&typeof r=="string"&&r.match(/\./)&&(c=""),S(()=>Ar(e,t,c,n))})),s(()=>{e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedStyles&&e._x_undoAddedStyles()})};ei.inline=(e,{value:t,modifiers:n,expression:r})=>{t&&(e._x_inlineBindings||(e._x_inlineBindings={}),e._x_inlineBindings[t]={expression:r,extract:!1})};C("bind",ei);function Ws(e,t){e._x_keyExpression=t}_r(()=>`[${we("data")}]`);C("data",(e,{expression:t},{cleanup:n})=>{if(Hs(e))return;t=t===""?"{}":t;let r={};$e(r,e);let i={};Qo(i,r);let o=oe(e,t,{scope:i});(o===void 0||o===!0)&&(o={}),$e(o,e);let s=be(o);Ht(s);let a=Ne(e,s);s.init&&oe(e,s.init),n(()=>{s.destroy&&oe(e,s.destroy),a()})});tt((e,t)=>{e._x_dataStack&&(t._x_dataStack=e._x_dataStack,t.setAttribute("data-has-alpine-state",!0))});function Hs(e){return Q?Et?!0:e.hasAttribute("data-has-alpine-state"):!1}C("show",(e,{modifiers:t,expression:n},{effect:r})=>{let i=E(e,n);e._x_doHide||(e._x_doHide=()=>{S(()=>{e.style.setProperty("display","none",t.includes("important")?"important":void 0)})}),e._x_doShow||(e._x_doShow=()=>{S(()=>{e.style.length===1&&e.style.display==="none"?e.removeAttribute("style"):e.style.removeProperty("display")})});let o=()=>{e._x_doHide(),e._x_isShown=!1},s=()=>{e._x_doShow(),e._x_isShown=!0},a=()=>setTimeout(s),c=Mt(f=>f?s():o(),f=>{typeof e._x_toggleAndCascadeWithTransitions=="function"?e._x_toggleAndCascadeWithTransitions(e,f,s,o):f?a():o()}),l,u=!0;r(()=>i(f=>{!u&&f===l||(t.includes("immediate")&&(f?a():o()),c(f),l=f,u=!1)}))});C("for",(e,{expression:t},{effect:n,cleanup:r})=>{let i=Gs(t),o=E(e,i.items),s=E(e,e._x_keyExpression||"index");e._x_prevKeys=[],e._x_lookup={},n(()=>Us(e,i,o,s)),r(()=>{Object.values(e._x_lookup).forEach(a=>S(()=>{ye(a),a.remove()})),delete e._x_prevKeys,delete e._x_lookup})});function Us(e,t,n,r){let i=s=>typeof s=="object"&&!Array.isArray(s),o=e;n(s=>{Vs(s)&&s>=0&&(s=Array.from(Array(s).keys(),g=>g+1)),s===void 0&&(s=[]);let a=e._x_lookup,c=e._x_prevKeys,l=[],u=[];if(i(s))s=Object.entries(s).map(([g,b])=>{let v=In(t,b,g,s);r(w=>{u.includes(w)&&R("Duplicate key on x-for",e),u.push(w)},{scope:{index:g,...v}}),l.push(v)});else for(let g=0;g<s.length;g++){let b=In(t,s[g],g,s);r(v=>{u.includes(v)&&R("Duplicate key on x-for",e),u.push(v)},{scope:{index:g,...b}}),l.push(b)}let f=[],d=[],h=[],p=[];for(let g=0;g<c.length;g++){let b=c[g];u.indexOf(b)===-1&&h.push(b)}c=c.filter(g=>!h.includes(g));let m="template";for(let g=0;g<u.length;g++){let b=u[g],v=c.indexOf(b);if(v===-1)c.splice(g,0,b),f.push([m,g]);else if(v!==g){let w=c.splice(g,1)[0],k=c.splice(v-1,1)[0];c.splice(g,0,k),c.splice(v,0,w),d.push([w,k])}else p.push(b);m=b}for(let g=0;g<h.length;g++){let b=h[g];b in a&&(S(()=>{ye(a[b]),a[b].remove()}),delete a[b])}for(let g=0;g<d.length;g++){let[b,v]=d[g],w=a[b],k=a[v],A=document.createElement("div");S(()=>{k||R('x-for ":key" is undefined or invalid',o,v,a),k.after(A),w.after(k),k._x_currentIfEl&&k.after(k._x_currentIfEl),A.before(w),w._x_currentIfEl&&w.after(w._x_currentIfEl),A.remove()}),k._x_refreshXForScope(l[u.indexOf(v)])}for(let g=0;g<f.length;g++){let[b,v]=f[g],w=b==="template"?o:a[b];w._x_currentIfEl&&(w=w._x_currentIfEl);let k=l[v],A=u[v],D=document.importNode(o.content,!0).firstElementChild,F=be(k);Ne(D,F,o),D._x_refreshXForScope=_=>{Object.entries(_).forEach(([q,P])=>{F[q]=P})},S(()=>{w.after(D),Z(()=>U(D))()}),typeof A=="object"&&R("x-for key cannot be an object, it must be a string or an integer",o),a[A]=D}for(let g=0;g<p.length;g++)a[p[g]]._x_refreshXForScope(l[u.indexOf(p[g])]);o._x_prevKeys=u})}function Gs(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n=/^\s*\(|\)\s*$/g,r=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=e.match(r);if(!i)return;let o={};o.items=i[2].trim();let s=i[1].replace(n,"").trim(),a=s.match(t);return a?(o.item=s.replace(t,"").trim(),o.index=a[1].trim(),a[2]&&(o.collection=a[2].trim())):o.item=s,o}function In(e,t,n,r){let i={};return/^\[.*\]$/.test(e.item)&&Array.isArray(t)?e.item.replace("[","").replace("]","").split(",").map(s=>s.trim()).forEach((s,a)=>{i[s]=t[a]}):/^\{.*\}$/.test(e.item)&&!Array.isArray(t)&&typeof t=="object"?e.item.replace("{","").replace("}","").split(",").map(s=>s.trim()).forEach(s=>{i[s]=t[s]}):i[e.item]=t,e.index&&(i[e.index]=n),e.collection&&(i[e.collection]=r),i}function Vs(e){return!Array.isArray(e)&&!isNaN(e)}function ti(){}ti.inline=(e,{expression:t},{cleanup:n})=>{let r=Xe(e);r._x_refs||(r._x_refs={}),r._x_refs[t]=e,n(()=>delete r._x_refs[t])};C("ref",ti);C("if",(e,{expression:t},{effect:n,cleanup:r})=>{e.tagName.toLowerCase()!=="template"&&R("x-if can only be used on a <template> tag",e);let i=E(e,t),o=()=>{if(e._x_currentIfEl)return e._x_currentIfEl;let a=e.content.cloneNode(!0).firstElementChild;return Ne(a,{},e),S(()=>{e.after(a),Z(()=>U(a))()}),e._x_currentIfEl=a,e._x_undoIf=()=>{S(()=>{ye(a),a.remove()}),delete e._x_currentIfEl},a},s=()=>{e._x_undoIf&&(e._x_undoIf(),delete e._x_undoIf)};n(()=>i(a=>{a?o():s()})),r(()=>e._x_undoIf&&e._x_undoIf())});C("id",(e,{expression:t},{evaluate:n})=>{n(t).forEach(i=>Ls(e,i))});tt((e,t)=>{e._x_ids&&(t._x_ids=e._x_ids)});Vt(ur("@",fr(we("on:"))));C("on",Z((e,{value:t,modifiers:n,expression:r},{cleanup:i})=>{let o=r?E(e,r):()=>{};e.tagName.toLowerCase()==="template"&&(e._x_forwardEvents||(e._x_forwardEvents=[]),e._x_forwardEvents.includes(t)||e._x_forwardEvents.push(t));let s=It(e,t,n,a=>{o(()=>{},{scope:{$event:a},params:[a]})});i(()=>s())}));ot("Collapse","collapse","collapse");ot("Intersect","intersect","intersect");ot("Focus","trap","focus");ot("Mask","mask","mask");function ot(e,t,n){C(t,r=>R(`You can't use [x-${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,r))}xe.setEvaluator(sr);xe.setRawEvaluator(ao);xe.setReactivityEngine({reactive:an,effect:ss,release:as,raw:y});var Js=xe,cn=Js;class Qs{constructor(){this.worker=null,this.ready=!1,this.analyzing=!1,this.resolve=null,this.currentEval=null,this.bestMove=null,this.pv=[],this.initPromise=null}async init(){if(this.ready)return;if(this.initPromise)return this.initPromise;const t="/engines/stockfish.js";return this.initPromise=new Promise((n,r)=>{try{this.worker=new Worker(t),this.worker.onerror=i=>{console.error("Stockfish worker error:",i),r(new Error("Failed to load Stockfish engine"))},this.worker.onmessage=i=>{const o=i.data;if(o.includes("uciok")&&(this.ready=!0,this.worker.postMessage("setoption name Hash value 32"),this.worker.postMessage("setoption name Threads value 1"),this.worker.postMessage("isready")),o.includes("readyok")&&!this.analyzing&&n(),o.startsWith("info depth")&&o.includes(" pv ")){const s=o.match(/score cp (-?\d+)/),a=o.match(/score mate (-?\d+)/),c=o.match(/ pv (.+)/);if(s)this.currentEval=parseInt(s[1])/100;else if(a){const l=parseInt(a[1]);this.currentEval=l>0?100:-100}c&&(this.pv=c[1].split(" "))}if(o.startsWith("bestmove")){const s=o.match(/bestmove (\S+)/);s&&(this.bestMove=s[1]),this.analyzing=!1,this.resolve&&(this.resolve({eval:this.currentEval,bestMove:this.bestMove,pv:[...this.pv]}),this.resolve=null)}},this.worker.postMessage("uci"),setTimeout(()=>{this.ready||r(new Error("Stockfish initialization timeout"))},1e4)}catch(i){r(i)}}),this.initPromise}async analyze(t,n=14){return this.ready||await this.init(),new Promise(r=>{this.resolve=r,this.analyzing=!0,this.currentEval=0,this.bestMove=null,this.pv=[],this.worker.postMessage("ucinewgame"),this.worker.postMessage(`position fen ${t}`),this.worker.postMessage(`go depth ${n}`)})}stop(){this.analyzing&&this.worker&&this.worker.postMessage("stop")}destroy(){this.worker&&(this.worker.terminate(),this.worker=null,this.ready=!1)}}const Ys=["white","black"],Ge=["a","b","c","d","e","f","g","h"],Ve=["1","2","3","4","5","6","7","8"],Zs=[...Ve].reverse(),ln=Array.prototype.concat(...Ge.map(e=>Ve.map(t=>e+t))),L=e=>ln[8*e[0]+e[1]],x=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],ni=ln.map(x);function Xs(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const ea=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},un=e=>e==="white"?"black":"white",Re=(e,t)=>{const n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},Lt=(e,t)=>e.role===t.role&&e.color===t.color,De=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],z=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},ri=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},fn=(e,t)=>{e.style.visibility=t?"visible":"hidden"},pe=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},ii=e=>e.button===2,H=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function oi(e,t,n){const r=x(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[n.left+n.width*r[0]/8+n.width/16,n.top+n.height*(7-r[1])/8+n.height/16]}const de=(e,t)=>Math.abs(e-t),ta=e=>(t,n,r,i)=>de(t,r)<2&&(e==="white"?i===n+1||n<=1&&i===n+2&&t===r:i===n-1||n>=6&&i===n-2&&t===r),si=(e,t,n,r)=>{const i=de(e,n),o=de(t,r);return i===1&&o===2||i===2&&o===1},ai=(e,t,n,r)=>de(e,n)===de(t,r),ci=(e,t,n,r)=>e===n||t===r,li=(e,t,n,r)=>ai(e,t,n,r)||ci(e,t,n,r),na=(e,t,n)=>(r,i,o,s)=>de(r,o)<2&&de(i,s)<2||n&&i===s&&i===(e==="white"?0:7)&&(r===4&&(o===2&&t.includes(0)||o===6&&t.includes(7))||t.includes(o));function ra(e,t){const n=t==="white"?"1":"8",r=[];for(const[i,o]of e)i[1]===n&&o.color===t&&o.role==="rook"&&r.push(x(i)[0]);return r}function ui(e,t,n){const r=e.get(t);if(!r)return[];const i=x(t),o=r.role,s=o==="pawn"?ta(r.color):o==="knight"?si:o==="bishop"?ai:o==="rook"?ci:o==="queen"?li:na(r.color,ra(e,r.color),n);return ni.filter(a=>(i[0]!==a[0]||i[1]!==a[1])&&s(i[0],i[1],a[0],a[1])).map(L)}function $(e,...t){e&&setTimeout(()=>e(...t),1)}function ia(e){e.orientation=un(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function oa(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function sa(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,r]of e.pieces)r.role==="king"&&r.color===t&&(e.check=n)}function aa(e,t,n,r){ee(e),e.premovable.current=[t,n],$(e.premovable.events.set,t,n,r)}function X(e){e.premovable.current&&(e.premovable.current=void 0,$(e.premovable.events.unset))}function ca(e,t,n){X(e),e.predroppable.current={role:t,key:n},$(e.predroppable.events.set,t,n)}function ee(e){const t=e.predroppable;t.current&&(t.current=void 0,$(t.events.unset))}function la(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||r.role!=="king")return!1;const i=x(t),o=x(n);if(i[1]!==0&&i[1]!==7||i[1]!==o[1])return!1;i[0]===4&&!e.pieces.has(n)&&(o[0]===6?n=L([7,o[1]]):o[0]===2&&(n=L([0,o[1]])));const s=e.pieces.get(n);return!s||s.color!==r.color||s.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),i[0]<o[0]?(e.pieces.set(L([6,o[1]]),r),e.pieces.set(L([5,o[1]]),s)):(e.pieces.set(L([2,o[1]]),r),e.pieces.set(L([3,o[1]]),s)),!0)}function fi(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!r)return!1;const o=i&&i.color!==r.color?i:void 0;return n===e.selected&&N(e),$(e.events.move,t,n,o),la(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,$(e.events.change),o||!0}function dn(e,t,n,r){if(e.pieces.has(n))if(r)e.pieces.delete(n);else return!1;return $(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,$(e.events.change),e.movable.dests=void 0,e.turnColor=un(e.turnColor),!0}function di(e,t,n){const r=fi(e,t,n);return r&&(e.movable.dests=void 0,e.turnColor=un(e.turnColor),e.animation.current=void 0),r}function hi(e,t,n){if(hn(e,t,n)){const r=di(e,t,n);if(r){const i=e.hold.stop();N(e);const o={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(o.captured=r),$(e.movable.events.after,t,n,o),!0}}else if(fa(e,t,n))return aa(e,t,n,{ctrlKey:e.stats.ctrlKey}),N(e),!0;return N(e),!1}function pi(e,t,n,r){const i=e.pieces.get(t);i&&(ua(e,t,n)||r)?(e.pieces.delete(t),dn(e,i,n,r),$(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&da(e,t,n)?ca(e,i.role,n):(X(e),ee(e)),e.pieces.delete(t),N(e)}function Rt(e,t,n){if($(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){N(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&hi(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(mi(e,t)||pn(e,t))&&(gi(e,t),e.hold.start())}function gi(e,t){e.selected=t,pn(e,t)?e.premovable.customDests||(e.premovable.dests=ui(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function N(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function mi(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const hn=(e,t,n)=>{var r,i;return t!==n&&mi(e,t)&&(e.movable.free||!!(!((i=(r=e.movable.dests)===null||r===void 0?void 0:r.get(t))===null||i===void 0)&&i.includes(n)))};function ua(e,t,n){const r=e.pieces.get(t);return!!r&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function pn(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function fa(e,t,n){var r,i;const o=(i=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(t))!==null&&i!==void 0?i:ui(e.pieces,t,e.premovable.castle);return t!==n&&pn(e,t)&&o.includes(n)}function da(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function ha(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function pa(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],r=t[1];let i=!1;if(hn(e,n,r)){const o=di(e,n,r);if(o){const s={premove:!0};o!==!0&&(s.captured=o),$(e.movable.events.after,n,r,s),i=!0}}return X(e),i}function ga(e,t){const n=e.predroppable.current;let r=!1;if(!n)return!1;if(t(n)){const i={role:n.role,color:e.movable.color};dn(e,i,n.key)&&($(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),r=!0)}return ee(e),r}function gn(e){X(e),ee(e),N(e)}function Ln(e){e.movable.color=e.movable.dests=e.animation.current=void 0,gn(e)}function ge(e,t,n){let r=Math.floor(8*(e[0]-n.left)/n.width);t||(r=7-r);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(i=7-i),r>=0&&r<8&&i>=0&&i<8?L([r,i]):void 0}function ma(e,t,n,r){const i=x(e),o=ni.filter(l=>li(i[0],i[1],l[0],l[1])||si(i[0],i[1],l[0],l[1])),a=o.map(l=>oi(L(l),n,r)).map(l=>Re(t,l)),[,c]=a.reduce((l,u,f)=>l[0]<u?l:[u,f],[a[0],0]);return L(o[c])}const I=e=>e.orientation==="white",vi="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",va={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},ba={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function bi(e){e==="start"&&(e=vi);const t=new Map;let n=7,r=0;for(const i of e)switch(i){case" ":case"[":return t;case"/":if(--n,n<0)return t;r=0;break;case"~":{const o=t.get(L([r-1,n]));o&&(o.promoted=!0);break}default:{const o=i.charCodeAt(0);if(o<57)r+=o-48;else{const s=i.toLowerCase();t.set(L([r,n]),{role:va[s],color:i===s?"black":"white"}),++r}}}return t}function _a(e){return Zs.map(t=>Ge.map(n=>{const r=e.get(n+t);if(r){let i=ba[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function _i(e,t){t.animation&&(mn(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function wi(e,t){var n,r,i;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((r=t.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),mn(e,t),t.fen&&(e.pieces=bi(t.fen),e.drawable.shapes=((i=t.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in t&&sa(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&gi(e,e.selected),_i(e,t),!e.movable.rookCastle&&e.movable.dests){const o=e.movable.color==="white"?"1":"8",s="e"+o,a=e.movable.dests.get(s),c=e.pieces.get(s);if(!a||!c||c.role!=="king")return;e.movable.dests.set(s,a.filter(l=>!(l==="a"+o&&a.includes("c"+o))&&!(l==="h"+o&&a.includes("g"+o))))}}function mn(e,t){for(const n in t)n==="__proto__"||n==="constructor"||!Object.prototype.hasOwnProperty.call(t,n)||(Object.prototype.hasOwnProperty.call(e,n)&&Rn(e[n])&&Rn(t[n])?mn(e[n],t[n]):e[n]=t[n])}function Rn(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const ne=(e,t)=>t.animation.enabled?xa(e,t):J(e,t);function J(e,t){const n=e(t);return t.dom.redraw(),n}const pt=(e,t)=>({key:e,pos:x(e),piece:t}),wa=(e,t)=>t.sort((n,r)=>Re(e.pos,n.pos)-Re(e.pos,r.pos))[0];function ya(e,t){const n=new Map,r=[],i=new Map,o=[],s=[],a=new Map;let c,l,u;for(const[f,d]of e)a.set(f,pt(f,d));for(const f of ln)c=t.pieces.get(f),l=a.get(f),c?l?Lt(c,l.piece)||(o.push(l),s.push(pt(f,c))):s.push(pt(f,c)):l&&o.push(l);for(const f of s)l=wa(f,o.filter(d=>Lt(f.piece,d.piece))),l&&(u=[l.pos[0]-f.pos[0],l.pos[1]-f.pos[1]],n.set(f.key,u.concat(u)),r.push(l.key));for(const f of o)r.includes(f.key)||i.set(f.key,f.piece);return{anims:n,fadings:i}}function yi(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(t-n.start)*n.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=Sa(r);for(const o of n.plan.anims.values())o[2]=o[0]*i,o[3]=o[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((o=performance.now())=>yi(e,o))}}function xa(e,t){const n=new Map(t.pieces),r=e(t),i=ya(n,t);if(i.anims.size||i.fadings.size){const o=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},o||yi(t,performance.now())}else t.dom.redraw();return r}const Sa=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Ca=["green","red","blue","yellow"];function ka(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?N(e):gn(e);const n=pe(t),r=ge(n,I(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:n,brush:Ea(t),snapToValidMove:e.drawable.defaultSnapToValidMove},xi(e))}function xi(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=ge(t.pos,I(e),e.dom.bounds());n||(t.snapToValidMove=!1);const r=t.snapToValidMove?ma(t.orig,t.pos,I(e),e.dom.bounds()):n;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),xi(e)}})}function Aa(e,t){e.drawable.current&&(e.drawable.current.pos=pe(t))}function Ma(e){const t=e.drawable.current;t&&(t.mouseSq&&Oa(e.drawable,t),Si(e))}function Si(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Pa(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Ci(e.drawable))}function Ea(e){var t;const n=(e.shiftKey||e.ctrlKey)&&ii(e),r=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return Ca[(n?1:0)+(r?2:0)]}function Oa(e,t){const n=i=>i.orig===t.orig&&i.dest===t.dest,r=e.shapes.find(n);r&&(e.shapes=e.shapes.filter(i=>!n(i))),(!r||r.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Ci(e)}function Ci(e){e.onChange&&e.onChange(e.shapes)}function Ta(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),r=pe(t),i=ge(r,I(e),n);if(!i)return;const o=e.pieces.get(i),s=e.selected;if(!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!o||o.color!==e.turnColor)&&Pa(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||o||s||$a(e,r)))t.preventDefault();else if(t.touches)return;const a=!!e.premovable.current,c=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&hn(e,e.selected,i)?ne(f=>Rt(f,i),e):Rt(e,i);const l=e.selected===i,u=Ai(e,i);if(o&&u&&l&&ha(e,i)){e.draggable.current={orig:i,piece:o,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:s,originTarget:t.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");const f=e.dom.elements.ghost;f&&(f.className=`ghost ${o.color} ${o.role}`,z(f,De(n)(x(i),I(e))),fn(f,!0)),vn(e)}else a&&X(e),c&&ee(e);e.dom.redraw()}function $a(e,t){const n=I(e),r=e.dom.bounds(),i=Math.pow(r.width/8,2);for(const o of e.pieces.keys()){const s=oi(o,n,r);if(Re(s,t)<=i)return!0}return!1}function Ia(e,t,n,r){const i="a0";e.pieces.set(i,t),e.dom.redraw();const o=pe(n);e.draggable.current={orig:i,piece:t,origPos:o,pos:o,started:!0,element:()=>Ai(e,i),originTarget:n.target,newPiece:!0,force:!!r,keyHasChanged:!1},vn(e)}function vn(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const r=e.pieces.get(n.orig);if(!r||!Lt(r,n.piece))Je(e);else if(!n.started&&Re(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const o=n.element();if(!o)return;o.cgDragging=!0,o.classList.add("dragging"),n.element=o}const i=e.dom.bounds();z(n.element,[n.pos[0]-i.left-i.width/16,n.pos[1]-i.top-i.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==ge(n.pos,I(e),i))}vn(e)})}function La(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=pe(t))}function Ra(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}X(e),ee(e);const r=pe(t)||n.pos,i=ge(r,I(e),e.dom.bounds());i&&n.started&&n.orig!==i?n.newPiece?pi(e,n.orig,i,n.force):(e.stats.ctrlKey=t.ctrlKey,hi(e,n.orig,i)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(n.orig),$(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===i||!i)?N(e):e.selectable.enabled||N(e),ki(e),e.draggable.current=void 0,e.dom.redraw()}function Je(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,N(e),ki(e),e.dom.redraw())}function ki(e){const t=e.dom.elements;t.ghost&&fn(t.ghost,!1)}function Ai(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function Na(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{Nn(e,2),setTimeout(()=>Nn(e,void 0),120)},120)}function Nn(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Da(e,t){function n(){ia(e),t()}return{set(r){r.orientation&&r.orientation!==e.orientation&&n(),_i(e,r),(r.fen?ne:J)(i=>wi(i,r),e)},state:e,getFen:()=>_a(e.pieces),toggleOrientation:n,setPieces(r){ne(i=>oa(i,r),e)},selectSquare(r,i){r?ne(o=>Rt(o,r,i),e):e.selected&&(N(e),e.dom.redraw())},move(r,i){ne(o=>fi(o,r,i),e)},newPiece(r,i){ne(o=>dn(o,r,i),e)},playPremove(){if(e.premovable.current){if(ne(pa,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=ga(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){J(X,e)},cancelPredrop(){J(ee,e)},cancelMove(){J(r=>{gn(r),Je(r)},e)},stop(){J(r=>{Ln(r),Je(r)},e)},explode(r){Na(e,r)},setAutoShapes(r){J(i=>i.drawable.autoShapes=r,e)},setShapes(r){J(i=>i.drawable.shapes=r,e)},getKeyAtDomPos(r){return ge(r,I(e),e.dom.bounds())},redrawAll:t,dragNewPiece(r,i,o){Ia(e,r,i,o)},destroy(){Ln(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Fa(){return{pieces:bi(vi),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:ea()}}const Dn={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Ba(){const e=M("defs"),t=O(M("filter"),{id:"cg-filter-blur"});return t.appendChild(O(M("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function Ka(e,t,n){var r;const i=e.drawable,o=i.current,s=o&&o.mouseSq?o:void 0,a=new Map,c=e.dom.bounds(),l=i.autoShapes.filter(h=>!h.piece);for(const h of i.shapes.concat(l).concat(s?[s]:[])){if(!h.dest)continue;const p=(r=a.get(h.dest))!==null&&r!==void 0?r:new Set,m=Ze(Ye(x(h.orig),e.orientation),c),g=Ze(Ye(x(h.dest),e.orientation),c);p.add(Dt(m,g)),a.set(h.dest,p)}const u=i.shapes.concat(l).map(h=>({shape:h,current:!1,hash:Fn(h,Nt(h.dest,a),!1,c)}));s&&u.push({shape:s,current:!0,hash:Fn(s,Nt(s.dest,a),!0,c)});const f=u.map(h=>h.hash).join(";");if(f===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=f;const d=t.querySelector("defs");qa(i,u,d),ja(u,t.querySelector("g"),n.querySelector("g"),h=>Ha(e,h,i.brushes,a,c))}function qa(e,t,n){var r;const i=new Map;let o;for(const c of t.filter(l=>l.shape.dest&&l.shape.brush))o=Mi(e.brushes[c.shape.brush],c.shape.modifiers),!((r=c.shape.modifiers)===null||r===void 0)&&r.hilite&&i.set(Qe(o).key,Qe(o)),i.set(o.key,o);const s=new Set;let a=n.firstElementChild;for(;a;)s.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[c,l]of i.entries())s.has(c)||n.appendChild(Va(l))}function ja(e,t,n,r){const i=new Map;for(const o of e)i.set(o.hash,!1);for(const o of[t,n]){const s=[];let a=o.firstElementChild,c;for(;a;)c=a.getAttribute("cgHash"),i.has(c)?i.set(c,!0):s.push(a),a=a.nextElementSibling;for(const l of s)o.removeChild(l)}for(const o of e.filter(s=>!i.get(s.hash)))for(const s of r(o))s.isCustom?n.appendChild(s.el):t.appendChild(s.el)}function Fn({orig:e,dest:t,brush:n,piece:r,modifiers:i,customSvg:o,label:s},a,c,l){var u,f;return[l.width,l.height,c,e,t,n,a&&"-",r&&za(r),i&&Wa(i),o&&`custom-${Bn(o.html)},${(f=(u=o.center)===null||u===void 0?void 0:u[0])!==null&&f!==void 0?f:"o"}`,s&&`label-${Bn(s.text)}`].filter(d=>d).join(",")}function za(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function Wa(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function Bn(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return t.toString()}function Ha(e,{shape:t,current:n,hash:r},i,o,s){var a,c;const l=Ze(Ye(x(t.orig),e.orientation),s),u=t.dest?Ze(Ye(x(t.dest),e.orientation),s):l,f=t.brush&&Mi(i[t.brush],t.modifiers),d=o.get(t.dest),h=[];if(f){const p=O(M("g"),{cgHash:r});h.push({el:p}),l[0]!==u[0]||l[1]!==u[1]?p.appendChild(Ga(t,f,l,u,n,Nt(t.dest,o))):p.appendChild(Ua(i[t.brush],l,n,s))}if(t.label){const p=t.label;(a=p.fill)!==null&&a!==void 0||(p.fill=t.brush&&i[t.brush].color);const m=t.brush?void 0:"tr";h.push({el:Ja(p,r,l,u,d,m),isCustom:!0})}if(t.customSvg){const p=(c=t.customSvg.center)!==null&&c!==void 0?c:"orig",[m,g]=p==="label"?Ei(l,u,d).map(v=>v-.5):p==="dest"?u:l,b=O(M("g"),{transform:`translate(${m},${g})`,cgHash:r});b.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,h.push({el:b,isCustom:!0})}return h}function Ua(e,t,n,r){const i=Qa(),o=(r.width+r.height)/(4*Math.max(r.width,r.height));return O(M("circle"),{stroke:e.color,"stroke-width":i[n?0:1],fill:"none",opacity:Pi(e,n),cx:t[0],cy:t[1],r:o-i[1]/2})}function Qe(e){return["#ffffff","#fff","white"].includes(e.color)?Dn.hilitePrimary:Dn.hiliteWhite}function Ga(e,t,n,r,i,o){var s;function a(u){var f;const d=Za(o&&!i),h=r[0]-n[0],p=r[1]-n[1],m=Math.atan2(p,h),g=Math.cos(m)*d,b=Math.sin(m)*d;return O(M("line"),{stroke:u?Qe(t).color:t.color,"stroke-width":Ya(t,i)+(u?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${u?Qe(t).key:t.key})`,opacity:!((f=e.modifiers)===null||f===void 0)&&f.hilite?1:Pi(t,i),x1:n[0],y1:n[1],x2:r[0]-g,y2:r[1]-b})}if(!(!((s=e.modifiers)===null||s===void 0)&&s.hilite))return a(!1);const c=M("g"),l=O(M("g"),{filter:"url(#cg-filter-blur)"});return l.appendChild(Xa(n,r)),l.appendChild(a(!0)),c.appendChild(l),c.appendChild(a(!1)),c}function Va(e){const t=O(M("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(O(M("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function Ja(e,t,n,r,i,o){var s;const c=.4*.75**e.text.length,l=Ei(n,r,i),u=o==="tr"?.4:0,f=O(M("g"),{transform:`translate(${l[0]+u},${l[1]-u})`,cgHash:t});f.appendChild(O(M("circle"),{r:.4/2,"fill-opacity":o?1:.8,"stroke-opacity":o?1:.7,"stroke-width":.03,fill:(s=e.fill)!==null&&s!==void 0?s:"#666",stroke:"white"}));const d=O(M("text"),{"font-size":c,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return d.innerHTML=e.text,f.appendChild(d),f}function Ye(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function Nt(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function M(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function O(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function Mi(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}:e}function Qa(){return[3/64,4/64]}function Ya(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Pi(e,t){return(e.opacity||1)*(t?.9:1)}function Za(e){return(e?20:10)/64}function Ze(e,t){const n=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*r]}function Xa(e,t){const n={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return O(M("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function Dt(e,t,n=!0){const r=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return n?(Math.round(r*8/Math.PI)+16)%16:r}function ec(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((n,r)=>n+r*r,0))}function Ei(e,t,n){let r=ec(e,t);const i=Dt(e,t,!1);if(n&&(r-=33/64,n.size>1)){r-=10/64;const o=Dt(e,t);(n.has((o+1)%16)||n.has((o+15)%16))&&o&1&&(r-=.4)}return[e[0]-Math.cos(i)*r,e[1]-Math.sin(i)*r].map(o=>o+.5)}function tc(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const c of Ys)e.classList.toggle("orientation-"+c,t.orientation===c);e.classList.toggle("manipulable",!t.viewOnly);const n=H("cg-container");e.appendChild(n);const r=H("cg-board");n.appendChild(r);let i,o,s;if(t.drawable.visible&&(i=O(M("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(Ba()),i.appendChild(M("g")),o=O(M("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(M("g")),s=H("cg-auto-pieces"),n.appendChild(i),n.appendChild(o),n.appendChild(s)),t.coordinates){const c=t.orientation==="black"?" black":"",l=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const u=t.orientation==="white"?f=>f+1:f=>8-f;Ge.forEach((f,d)=>n.appendChild(gt(Ve.map(h=>f+h),"squares rank"+u(d)+c+l)))}else n.appendChild(gt(Ve,"ranks"+c+l)),n.appendChild(gt(Ge,"files"+c))}let a;return t.draggable.enabled&&t.draggable.showGhost&&(a=H("piece","ghost"),fn(a,!1),n.appendChild(a)),{board:r,container:n,wrap:e,ghost:a,svg:i,customSvg:o,autoPieces:s}}function gt(e,t){const n=H("coords",t);let r;for(const i of e)r=H("coord"),r.textContent=i,n.appendChild(r);return n}function nc(e,t){if(!e.dropmode.active)return;X(e),ee(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const r=pe(t),i=r&&ge(r,I(e),e.dom.bounds());i&&pi(e,"a0",i)}e.dom.redraw()}function rc(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const r=oc(e);n.addEventListener("touchstart",r,{passive:!1}),n.addEventListener("mousedown",r,{passive:!1})}function ic(e,t){const n=[];if("ResizeObserver"in window||n.push(Me(document.body,"chessground.resize",t)),!e.viewOnly){const r=Kn(e,La,Aa),i=Kn(e,Ra,Ma);for(const s of["touchmove","mousemove"])n.push(Me(document,s,r));for(const s of["touchend","mouseup"])n.push(Me(document,s,i));const o=()=>e.dom.bounds.clear();n.push(Me(document,"scroll",o,{capture:!0,passive:!0})),n.push(Me(window,"resize",o,{passive:!0}))}return()=>n.forEach(r=>r())}function Me(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}const oc=e=>t=>{e.draggable.current?Je(e):e.drawable.current?Si(e):t.shiftKey||ii(t)?e.drawable.enabled&&ka(e,t):e.viewOnly||(e.dropmode.active?nc(e,t):Ta(e,t))},Kn=(e,t,n)=>r=>{e.drawable.current?e.drawable.enabled&&n(e,r):e.viewOnly||t(e,r)};function sc(e){const t=I(e),n=De(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,o=e.animation.current,s=o?o.plan.anims:new Map,a=o?o.plan.fadings:new Map,c=e.draggable.current,l=cc(e),u=new Set,f=new Set,d=new Map,h=new Map;let p,m,g,b,v,w,k,A,D,F;for(m=r.firstChild;m;){if(p=m.cgKey,Oi(m))if(g=i.get(p),v=s.get(p),w=a.get(p),b=m.cgPiece,m.cgDragging&&(!c||c.orig!==p)&&(m.classList.remove("dragging"),z(m,n(x(p),t)),m.cgDragging=!1),!w&&m.cgFading&&(m.cgFading=!1,m.classList.remove("fading")),g){if(v&&m.cgAnimating&&b===Pe(g)){const _=x(p);_[0]+=v[2],_[1]+=v[3],m.classList.add("anim"),z(m,n(_,t))}else m.cgAnimating&&(m.cgAnimating=!1,m.classList.remove("anim"),z(m,n(x(p),t)),e.addPieceZIndex&&(m.style.zIndex=mt(x(p),t)));b===Pe(g)&&(!w||!m.cgFading)?u.add(p):w&&b===Pe(w)?(m.classList.add("fading"),m.cgFading=!0):vt(d,b,m)}else vt(d,b,m);else if(Ti(m)){const _=m.className;l.get(p)===_?f.add(p):vt(h,_,m)}m=m.nextSibling}for(const[_,q]of l)if(!f.has(_)){D=h.get(q),F=D&&D.pop();const P=n(x(_),t);if(F)F.cgKey=_,z(F,P);else{const T=H("square",q);T.cgKey=_,z(T,P),r.insertBefore(T,r.firstChild)}}for(const[_,q]of i)if(v=s.get(_),!u.has(_))if(k=d.get(Pe(q)),A=k&&k.pop(),A){A.cgKey=_,A.cgFading&&(A.classList.remove("fading"),A.cgFading=!1);const P=x(_);e.addPieceZIndex&&(A.style.zIndex=mt(P,t)),v&&(A.cgAnimating=!0,A.classList.add("anim"),P[0]+=v[2],P[1]+=v[3]),z(A,n(P,t))}else{const P=Pe(q),T=H("piece",P),G=x(_);T.cgPiece=P,T.cgKey=_,v&&(T.cgAnimating=!0,G[0]+=v[2],G[1]+=v[3]),z(T,n(G,t)),e.addPieceZIndex&&(T.style.zIndex=mt(G,t)),r.appendChild(T)}for(const _ of d.values())jn(e,_);for(const _ of h.values())jn(e,_)}function ac(e){const t=I(e),n=De(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(Oi(r)&&!r.cgAnimating||Ti(r))&&z(r,n(x(r.cgKey),t)),r=r.nextSibling}function qn(e){var t,n;const r=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,o=r.height/r.width,s=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=s*o;i.style.width=s+"px",i.style.height=a+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",s+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("---cg-height",a+"px")}const Oi=e=>e.tagName==="PIECE",Ti=e=>e.tagName==="SQUARE";function jn(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function mt(e,t){const r=e[1];return`${t?10-r:3+r}`}const Pe=e=>`${e.color} ${e.role}`;function cc(e){var t,n,r;const i=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)W(i,a,"last-move");if(e.check&&e.highlight.check&&W(i,e.check,"check"),e.selected&&(W(i,e.selected,"selected"),e.movable.showDests)){const a=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(a)for(const l of a)W(i,l,"move-dest"+(e.pieces.has(l)?" oc":""));const c=(r=(n=e.premovable.customDests)===null||n===void 0?void 0:n.get(e.selected))!==null&&r!==void 0?r:e.premovable.dests;if(c)for(const l of c)W(i,l,"premove-dest"+(e.pieces.has(l)?" oc":""))}const o=e.premovable.current;if(o)for(const a of o)W(i,a,"current-premove");else e.predroppable.current&&W(i,e.predroppable.current.key,"current-premove");const s=e.exploding;if(s)for(const a of s.keys)W(i,a,"exploding"+s.stage);return e.highlight.custom&&e.highlight.custom.forEach((a,c)=>{W(i,c,a)}),i}function W(e,t,n){const r=e.get(t);r?e.set(t,`${r} ${n}`):e.set(t,n)}function vt(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function lc(e,t,n){const r=new Map,i=[];for(const a of e)r.set(a.hash,!1);let o=t.firstElementChild,s;for(;o;)s=o.getAttribute("cgHash"),r.has(s)?r.set(s,!0):i.push(o),o=o.nextElementSibling;for(const a of i)t.removeChild(a);for(const a of e)r.get(a.hash)||t.appendChild(n(a))}function uc(e,t){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:hc(i),current:!1}));lc(r,t,i=>dc(e,i,e.dom.bounds()))}function fc(e){var t;const n=I(e),r=De(e.dom.bounds());let i=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;i;)ri(i,r(x(i.cgKey),n),i.cgScale),i=i.nextSibling}function dc(e,{shape:t,hash:n},r){var i,o,s;const a=t.orig,c=(i=t.piece)===null||i===void 0?void 0:i.role,l=(o=t.piece)===null||o===void 0?void 0:o.color,u=(s=t.piece)===null||s===void 0?void 0:s.scale,f=H("piece",`${c} ${l}`);return f.setAttribute("cgHash",n),f.cgKey=a,f.cgScale=u,ri(f,De(r)(x(a),I(e)),u),f}const hc=e=>{var t,n,r;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")};function pc(e,t){const n=Fa();wi(n,t||{});function r(){const i="dom"in n?n.dom.unbind:void 0,o=tc(e,n),s=Xs(()=>o.board.getBoundingClientRect()),a=u=>{sc(l),o.autoPieces&&uc(l,o.autoPieces),!u&&o.svg&&Ka(l,o.svg,o.customSvg)},c=()=>{qn(l),ac(l),o.autoPieces&&fc(l)},l=n;return l.dom={elements:o,bounds:s,redraw:gc(a),redrawNow:a,unbind:i},l.drawable.prevSvgHash="",qn(l),a(!1),rc(l,c),i||(l.dom.unbind=ic(l,c)),l.events.insert&&l.events.insert(o),l}return Da(r(),r)}function gc(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}const mc={p:"pawn",n:"knight",b:"bishop",r:"rook",q:"queen",k:"king"},Ft="abcdefgh",vc="12345678";class bn{constructor(t="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"){this.reset(t)}reset(t){this.board=Array(64).fill(null),this.turn="w",this.castling={K:!0,Q:!0,k:!0,q:!0},this.enPassant=null,this.halfmoves=0,this.fullmoves=1,this.loadFen(t)}loadFen(t){const n=t.split(" "),r=n[0];let i=0;for(const o of r)if(o!=="/")if(/[1-8]/.test(o))i+=parseInt(o);else{const s=o===o.toUpperCase()?"w":"b",a=o.toLowerCase();this.board[i]={color:s,type:a},i++}if(n[1]&&(this.turn=n[1]),n[2]&&(this.castling={K:!1,Q:!1,k:!1,q:!1},n[2]!=="-"))for(const o of n[2])this.castling[o]=!0;n[3]&&(this.enPassant=n[3]==="-"?null:n[3]),n[4]&&(this.halfmoves=parseInt(n[4])),n[5]&&(this.fullmoves=parseInt(n[5]))}getFen(){let t="";for(let r=0;r<8;r++){let i=0;for(let o=0;o<8;o++){const s=this.board[r*8+o];if(s){i>0&&(t+=i,i=0);const a=s.type;t+=s.color==="w"?a.toUpperCase():a}else i++}i>0&&(t+=i),r<7&&(t+="/")}t+=` ${this.turn}`;let n="";return this.castling.K&&(n+="K"),this.castling.Q&&(n+="Q"),this.castling.k&&(n+="k"),this.castling.q&&(n+="q"),t+=` ${n||"-"}`,t+=` ${this.enPassant||"-"}`,t+=` ${this.halfmoves}`,t+=` ${this.fullmoves}`,t}algebraicToIndex(t){if(!t||t.length!==2)return-1;const n=Ft.indexOf(t[0]),r=8-parseInt(t[1]);return n===-1||r<0||r>7?-1:r*8+n}indexToAlgebraic(t){const n=t%8,r=8-Math.floor(t/8);return Ft[n]+r}getPiece(t){const n=typeof t=="string"?this.algebraicToIndex(t):t;return this.board[n]}getLegalMoves(t){const n=typeof t=="string"?this.algebraicToIndex(t):t,r=this.board[n];if(!r||r.color!==this.turn)return[];const i=[],o=n%8,s=Math.floor(n/8),a=(l,u=null)=>{if(l>=0&&l<64){const f=this.board[l];(!f||f.color!==r.color)&&i.push({from:n,to:l,fromAlg:this.indexToAlgebraic(n),toAlg:this.indexToAlgebraic(l),promotion:u})}},c=(l,u)=>{let f=o+l,d=s+u;for(;f>=0&&f<8&&d>=0&&d<8;){const h=d*8+f,p=this.board[h];if(p){p.color!==r.color&&a(h);break}a(h),f+=l,d+=u}};switch(r.type){case"p":{const l=r.color==="w"?-1:1,u=r.color==="w"?6:1,f=r.color==="w"?0:7,d=(s+l)*8+o;if(!this.board[d]&&(s+l===f?["q","r","b","n"].forEach(h=>a(d,h)):a(d),s===u)){const h=(s+2*l)*8+o;this.board[h]||a(h)}for(const h of[-1,1])if(o+h>=0&&o+h<8){const p=(s+l)*8+(o+h),m=this.board[p];m&&m.color!==r.color&&(s+l===f?["q","r","b","n"].forEach(g=>a(p,g)):a(p)),this.enPassant===this.indexToAlgebraic(p)&&a(p)}break}case"n":{const l=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]];for(const[u,f]of l){const d=s+u,h=o+f;d>=0&&d<8&&h>=0&&h<8&&a(d*8+h)}break}case"b":c(-1,-1),c(-1,1),c(1,-1),c(1,1);break;case"r":c(-1,0),c(1,0),c(0,-1),c(0,1);break;case"q":c(-1,-1),c(-1,1),c(1,-1),c(1,1),c(-1,0),c(1,0),c(0,-1),c(0,1);break;case"k":{for(let l=-1;l<=1;l++)for(let u=-1;u<=1;u++){if(l===0&&u===0)continue;const f=s+l,d=o+u;f>=0&&f<8&&d>=0&&d<8&&a(f*8+d)}r.color==="w"&&s===7?(this.castling.K&&!this.board[61]&&!this.board[62]&&i.push({from:n,to:62,fromAlg:"e1",toAlg:"g1",castling:"K"}),this.castling.Q&&!this.board[57]&&!this.board[58]&&!this.board[59]&&i.push({from:n,to:58,fromAlg:"e1",toAlg:"c1",castling:"Q"})):r.color==="b"&&s===0&&(this.castling.k&&!this.board[5]&&!this.board[6]&&i.push({from:n,to:6,fromAlg:"e8",toAlg:"g8",castling:"k"}),this.castling.q&&!this.board[1]&&!this.board[2]&&!this.board[3]&&i.push({from:n,to:2,fromAlg:"e8",toAlg:"c8",castling:"q"}));break}}return i}move(t,n,r=null){const i=typeof t=="string"?this.algebraicToIndex(t):t,o=typeof n=="string"?this.algebraicToIndex(n):n,s=this.board[i];if(!s||s.color!==this.turn)return!1;const c=this.getLegalMoves(i).find(u=>u.to===o&&(!r||u.promotion===r));if(!c)return!1;const l=this.board[o];if(this.board[o]=s,this.board[i]=null,s.type==="p"){if(c.promotion&&(this.board[o]={color:s.color,type:c.promotion}),this.enPassant===this.indexToAlgebraic(o)){const u=s.color==="w"?o+8:o-8;this.board[u]=null}Math.abs(o-i)===16?this.enPassant=this.indexToAlgebraic((i+o)/2):this.enPassant=null}else this.enPassant=null;return c.castling&&(c.castling==="K"?(this.board[61]=this.board[63],this.board[63]=null):c.castling==="Q"?(this.board[59]=this.board[56],this.board[56]=null):c.castling==="k"?(this.board[5]=this.board[7],this.board[7]=null):c.castling==="q"&&(this.board[3]=this.board[0],this.board[0]=null)),s.type==="k"&&(s.color==="w"?(this.castling.K=!1,this.castling.Q=!1):(this.castling.k=!1,this.castling.q=!1)),(i===63||o===63)&&(this.castling.K=!1),(i===56||o===56)&&(this.castling.Q=!1),(i===7||o===7)&&(this.castling.k=!1),(i===0||o===0)&&(this.castling.q=!1),s.type==="p"||l?this.halfmoves=0:this.halfmoves++,this.turn==="b"&&this.fullmoves++,this.turn=this.turn==="w"?"b":"w",!0}parseUci(t){return!t||t.length<4?null:{from:t.substring(0,2),to:t.substring(2,4),promotion:t.length>4?t[4].toLowerCase():null}}moveUci(t){const n=this.parseUci(t);return n?this.move(n.from,n.to,n.promotion):!1}clone(){const t=new bn;return t.board=[...this.board.map(n=>n?{...n}:null)],t.turn=this.turn,t.castling={...this.castling},t.enPassant=this.enPassant,t.halfmoves=this.halfmoves,t.fullmoves=this.fullmoves,t}}const $i={Game:bn,PIECE_TYPES:mc,FILES:Ft,RANKS:vc};class bc{constructor(t,n={}){this.containerId=t,this.container=null,this.options={flipped:!1,interactive:!0,onMove:null,...n},this.cg=null,this.game=null,this.fen=null,this.mounted=!1}mount(){return this.mounted?Promise.resolve():new Promise(t=>{const n=()=>{if(this.container=document.getElementById(this.containerId),!this.container){requestAnimationFrame(n);return}const r=this.container.getBoundingClientRect();if(r.width<50||r.height<50){requestAnimationFrame(n);return}this.initChessground(),this.mounted=!0,t()};n()})}initChessground(){this.cg=pc(this.container,{orientation:this.options.flipped?"black":"white",movable:{free:!1,color:"both",dests:new Map,events:{after:(n,r)=>this.handleMove(n,r)}},draggable:{enabled:!0,showGhost:!0},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:150},premovable:{enabled:!1}});let t;new ResizeObserver(()=>{clearTimeout(t),t=setTimeout(()=>{this.cg&&this.cg.redrawAll()},50)}).observe(this.container)}setPosition(t){if(!this.cg)return;this.fen=t,this.game=new $i.Game(t);const n=t.split(" "),r=n[1]==="w"?"white":"black";this.cg.set({fen:n[0],turnColor:r,movable:{color:this.options.interactive?r:void 0,dests:this.options.interactive?this.getDestinations():new Map},check:this.isInCheck()}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.cg&&this.cg.redrawAll()})})}getDestinations(){if(!this.game)return new Map;const t=new Map;for(let n=0;n<64;n++){const r=this.game.board[n];if(r&&r.color===this.game.turn){const i=this.game.indexToAlgebraic(n),s=this.game.getLegalMoves(n).map(a=>a.toAlg);s.length>0&&t.set(i,s)}}return t}isInCheck(){return!1}handleMove(t,n){if(!this.game)return;const r=this.game.getPiece(t),o=(r==null?void 0:r.type)==="p"&&(n[1]==="8"||n[1]==="1")?"q":null;if(this.game.move(t,n,o)){if(this.setPosition(this.game.getFen()),this.options.onMove){const a=t+n+(o||"");this.options.onMove(a,this.game.getFen())}}else this.setPosition(this.fen)}flip(){this.options.flipped=!this.options.flipped,this.cg&&this.cg.set({orientation:this.options.flipped?"black":"white"})}setFlipped(t){this.options.flipped!==t&&(this.options.flipped=t,this.cg&&this.cg.set({orientation:t?"black":"white"}))}setInteractive(t){if(this.options.interactive=t,this.cg&&this.game){const n=this.game.turn==="w"?"white":"black";this.cg.set({movable:{color:t?n:void 0,dests:t?this.getDestinations():new Map}})}}redraw(){this.cg&&this.cg.redrawAll()}}function zn(e){return 50+50*(2/(1+Math.exp(-.00368208*e))-1)}function _c(){return{training:!1,settingsOpen:!1,loading:!1,hasStarted:!1,status:"",statusType:"",message:"",messageClass:"",lichessUser:localStorage.getItem("lichessUser")||"",chesscomUser:localStorage.getItem("chesscomUser")||"",numGames:parseInt(localStorage.getItem("numGames"))||20,tacticsFound:0,timeControls:[{id:"bullet",name:"Bullet",enabled:!1},{id:"blitz",name:"Blitz",enabled:!0},{id:"rapid",name:"Rapid",enabled:!0},{id:"classical",name:"Classical",enabled:!0},{id:"daily",name:"Daily",enabled:!0}],tactics:[],currentIndex:0,solved:!1,solutionShown:!1,autoNext:localStorage.getItem("autoNext")!=="false",board:null,stockfish:null,user:null,get currentTactic(){return this.tactics[this.currentIndex]||null},get badgeClass(){var t;const e=(t=this.currentTactic)==null?void 0:t.mistake_type;return e==="??"?"blunder":e==="?"?"mistake":""},init(){const e=localStorage.getItem("timeControls");if(e)try{const t=JSON.parse(e);this.timeControls.forEach(n=>{t[n.id]!==void 0&&(n.enabled=t[n.id])})}catch{}this.$watch("timeControls",()=>this.saveTimeControls(),{deep:!0}),this.$watch("autoNext",t=>localStorage.setItem("autoNext",t.toString()))},saveTimeControls(){const e={};this.timeControls.forEach(t=>e[t.id]=t.enabled),localStorage.setItem("timeControls",JSON.stringify(e))},async loadTactics(){const e=this.lichessUser.trim(),t=this.chesscomUser.trim();if(!e&&!t){this.setStatus("Enter at least one username","error");return}e&&localStorage.setItem("lichessUser",e),t&&localStorage.setItem("chesscomUser",t),localStorage.setItem("numGames",this.numGames.toString()),this.settingsOpen=!1,this.loading=!0,this.tactics=[],this.tacticsFound=0,this.gamesAnalyzed=0;try{this.setStatus("Loading engine..."),this.stockfish||(this.stockfish=new Qs),await this.stockfish.init();const n=this.getEnabledPerfTypes();if(e&&await this.processLichessGames(e,n),t&&await this.processChesscomGames(t,n),this.gamesAnalyzed===0){this.setStatus("No games found","error"),this.loading=!1;return}if(this.tactics.length===0){this.setStatus("No mistakes found",""),this.loading=!1;return}this.tactics=this.shuffle(this.tactics),this.currentIndex=0,this.training=!0,this.setStatus(""),await this.$nextTick(),await this.initBoard(),this.loadCurrentTactic()}catch(n){console.error("Error:",n),this.setStatus(`Error: ${n.message}`,"error")}finally{this.loading=!1}},async processLichessGames(e,t){this.setStatus("Downloading Lichess games...");const n=[];t.includes("bullet")&&n.push("bullet","ultraBullet"),t.includes("blitz")&&n.push("blitz"),t.includes("rapid")&&n.push("rapid"),t.includes("classical")&&n.push("classical"),t.includes("correspondence")&&n.push("correspondence");const r=Date.now()-90*24*60*60*1e3,i=new URLSearchParams({since:r.toString(),perfType:n.join(","),moves:"true",max:this.numGames.toString()});try{const o=await fetch(`https://lichess.org/api/games/user/${e}?${i}`,{headers:{Accept:"application/x-chess-pgn"}});if(!o.ok){console.warn("Lichess API error:",o.status);return}const s=await o.text(),a=this.splitPgn(s);for(let c=0;c<a.length;c++){this.setStatus(`Analyzing Lichess game ${c+1}/${a.length}...`);const l=await this.analyzeGame(a[c],e);this.tactics.push(...l),this.tacticsFound=this.tactics.length,this.gamesAnalyzed++}}catch(o){console.warn("Lichess fetch error:",o)}},async processChesscomGames(e,t){this.setStatus("Downloading Chess.com games...");const n=new Date,r=[];for(let i=0;i<3&&r.length<this.numGames;i++){const o=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0");try{const a=await fetch(`https://api.chess.com/pub/player/${e.toLowerCase()}/games/${o}/${s}/pgn`);if(a.ok){const c=await a.text(),l=this.splitPgn(c);for(const u of l){if(r.length>=this.numGames)break;this.matchesTimeControl(u,t)&&r.push(u)}}}catch(a){console.warn(`Chess.com error for ${o}/${s}:`,a)}n.setMonth(n.getMonth()-1)}for(let i=0;i<r.length;i++){this.setStatus(`Analyzing Chess.com game ${i+1}/${r.length}...`);const o=await this.analyzeGame(r[i],e);this.tactics.push(...o),this.tacticsFound=this.tactics.length,this.gamesAnalyzed++}},splitPgn(e){if(!(e!=null&&e.trim()))return[];const t=[];let n=[];for(const r of e.split(`
`))r.startsWith("[Event ")&&n.length>0&&(t.push(n.join(`
`)),n=[]),n.push(r);return n.length>0&&t.push(n.join(`
`)),t},matchesTimeControl(e,t){const n=e.match(/\[TimeControl "([^"]+)"\]/);if(!n)return!0;const r=n[1];if(r==="-")return t.includes("correspondence");const i=r.split("+"),o=parseInt(i[0])||0,s=parseInt(i[1])||0,a=o+40*s;return a<180?t.includes("bullet"):a<600?t.includes("blitz"):a<1800?t.includes("rapid"):t.includes("classical")},async analyzeGame(e,t){var h;const n=t.toLowerCase(),r={};for(const p of e.matchAll(/\[(\w+)\s+"([^"]*)"\]/g))r[p[1]]=p[2];console.log("=".repeat(80)),console.log(`Analyzing: ${r.White} vs ${r.Black}`),console.log("=".repeat(80));const i=(r.White||"").toLowerCase(),o=(r.Black||"").toLowerCase();let s=null;if(i.includes(n))s="w";else if(o.includes(n))s="b";else return[];console.log(`User plays: ${s==="w"?"White":"Black"}`);const a=e.match(/\n\n([\s\S]+)$/);if(!a)return[];const c=a[1].replace(/\{[^}]*\}/g,"").replace(/\([^)]*\)/g,"").replace(/\$\d+/g,"").replace(/\d+\.\.\./g,"").trim(),l=[];for(const p of c.matchAll(/(\d+)\.\s*(\S+)(?:\s+(\S+))?/g)){const m=parseInt(p[1]);p[2]&&!this.isResult(p[2])&&l.push({num:m,san:p[2],color:"w"}),p[3]&&!this.isResult(p[3])&&l.push({num:m,san:p[3],color:"b"})}const u=[],f=new window.Chess.Game,d=15;console.log(`Total moves: ${l.length}, analyzing at depth ${d}`),console.log("");for(const p of l){if(!(p.color===s)){const _n=this.findUci(f,p.san);_n&&f.moveUci(_n);continue}const g=f.getFen(),b=g.split(" ")[1]==="w",v=await this.stockfish.analyze(g,d),w=this.findUci(f,p.san);if(!w)continue;f.moveUci(w);const k=f.getFen(),A=k.split(" ")[1]==="w",D=await this.stockfish.analyze(k,d),F=(v.eval||0)*100,_=(D.eval||0)*100;let q=b?F:-F,P=A?_:-_,T=q,G=P;s==="b"&&(T=-q,G=-P);const st=zn(T),at=zn(G),Se=st-at,ct=Se>30,Ii=Se>20&&Se<=30,Li=ct?" BLUNDER":Ii?" MISTAKE":" OK";console.log(`--- Move ${p.num}. ${p.san} (${p.color==="w"?"White":"Black"}) ---`),console.log(`FEN: ${g}`),console.log(`Raw eval before: ${F.toFixed(0)}cp, after: ${_.toFixed(0)}cp`),console.log(`Eval Before: ${T.toFixed(0)}cp (${st.toFixed(1)}%)`),console.log(`Eval After:  ${G.toFixed(0)}cp (${at.toFixed(1)}%)`),console.log(`Delta: ${Se.toFixed(1)}% | ${Li}`),console.log(`PV: ${(v.pv||[]).slice(0,3).join(" ")}`),console.log(""),Se>20&&u.push({fen:g,user_move:p.san,correct_line:((h=v.pv)==null?void 0:h.slice(0,3))||[],mistake_type:ct?"??":"?",mistake_analysis:`${ct?"Blunder":"Mistake"}: ${st.toFixed(0)}%  ${at.toFixed(0)}%`,position_context:`Move ${p.num}, ${s==="w"?"White":"Black"} to play`,game_url:r.Link||r.Site||"",game_white:r.White||"",game_black:r.Black||""})}return console.log("=".repeat(80)),console.log(`Analysis complete. Found ${u.length} tactics.`),console.log("=".repeat(80)),u},isResult(e){return["1-0","0-1","1/2-1/2","*"].includes(e)},findUci(e,t){const n=t.replace(/[+#!?=]/g,"");for(let r=0;r<64;r++){const i=e.board[r];if(!i||i.color!==e.turn)continue;const o=e.getLegalMoves(r);for(const s of o)if(this.matchesSan(e,s,n))return s.fromAlg+s.toAlg+(s.promotion||"")}return null},matchesSan(e,t,n){const r=e.board[t.from];if(!r)return!1;if(n==="O-O"||n==="O-O-O")return t.castling===(n==="O-O"?r.color==="w"?"K":"k":r.color==="w"?"Q":"q");if(r.type==="p")return n.includes("x")?n[0]===t.fromAlg[0]&&n.slice(-2)===t.toAlg:n===t.toAlg||n.startsWith(t.toAlg);const i=r.type.toUpperCase();return n.startsWith(i)?n.slice(-2)===t.toAlg:!1},getEnabledPerfTypes(){const e=[];return this.timeControls.forEach(t=>{t.enabled&&(t.id==="bullet"&&e.push("bullet"),t.id==="blitz"&&e.push("blitz"),t.id==="rapid"&&e.push("rapid"),t.id==="classical"&&e.push("classical"),t.id==="daily"&&e.push("correspondence"))}),e},shuffle(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t},async initBoard(){this.board||(this.board=new bc("board",{interactive:!0,onMove:e=>this.handleMove(e)})),await this.board.mount()},loadCurrentTactic(){var n;const e=this.currentTactic;if(!e)return;this.solved=!1,this.solutionShown=!1,this.setMessage("","");const t=(n=e.position_context)==null?void 0:n.includes("Black");this.board.setFlipped(t),this.board.setPosition(e.fen),this.board.setInteractive(!0)},handleMove(e){var r,i,o;if(this.solved)return;const t=((o=(i=(r=this.currentTactic)==null?void 0:r.correct_line)==null?void 0:i[0])==null?void 0:o.toLowerCase())||"",n=e.toLowerCase();n===t||t.startsWith(n)||n.startsWith(t)?(this.solved=!0,this.setMessage("","correct"),this.board.setInteractive(!1),this.autoNext&&setTimeout(()=>this.nextTactic(),1200)):(this.setMessage("Try again","incorrect"),setTimeout(()=>{this.board.setPosition(this.currentTactic.fen),this.setMessage("","")},800))},showSolution(){this.solutionShown=!0},getSolutionSan(){var t;const e=this.currentTactic;return!e||!((t=e.correct_line)!=null&&t.length)?"?":this.convertUciLineToSan(e.fen,e.correct_line).join(" ")},convertUciLineToSan(e,t){if(!e||!(t!=null&&t.length))return t||[];try{const n=new window.Chess.Game(e),r=[];for(const i of t){const o=this.uciToSan(n,i);o?(r.push(o),n.moveUci(i)):r.push(i)}return r}catch(n){return console.warn("Failed to convert UCI to SAN:",n),t}},uciToSan(e,t){if(!t||t.length<4)return null;const n=t.substring(0,2),r=t.substring(2,4),i=t.length>4?t[4]:null,o=e.algebraicToIndex(n),s=e.algebraicToIndex(r),a=e.board[o];if(!a)return null;if(a.type==="k"){if(n==="e1"&&r==="g1")return"O-O";if(n==="e1"&&r==="c1")return"O-O-O";if(n==="e8"&&r==="g8")return"O-O";if(n==="e8"&&r==="c8")return"O-O-O"}const l=!!e.board[s]||a.type==="p"&&n[0]!==r[0];let u="";if(a.type==="p")l?u=n[0]+"x"+r:u=r,i&&(u+="="+i.toUpperCase());else{u=a.type.toUpperCase();const f=this.getDisambiguation(e,a,o,s);u+=f,l&&(u+="x"),u+=r}return u},getDisambiguation(e,t,n,r){const i=[];for(let u=0;u<64;u++){if(u===n)continue;const f=e.board[u];if(!f||f.type!==t.type||f.color!==t.color)continue;e.getLegalMoves(u).some(h=>h.to===r)&&i.push(u)}if(i.length===0)return"";const o=e.indexToAlgebraic(n),s=o[0],a=o[1],c=i.some(u=>e.indexToAlgebraic(u)[0]===s),l=i.some(u=>e.indexToAlgebraic(u)[1]===a);return c?l?s+a:a:s},prevTactic(){this.currentIndex>0&&(this.currentIndex--,this.loadCurrentTactic())},nextTactic(){this.currentIndex<this.tactics.length-1?(this.currentIndex++,this.loadCurrentTactic()):this.setMessage("All done!","correct")},openAnalysis(){var t;const e=(t=this.currentTactic)==null?void 0:t.fen;if(e){const n=e.replace(/ /g,"_"),i=e.split(" ")[1]==="w"?"white":"black";window.open(`https://lichess.org/analysis?fen=${n}&color=${i}`,"_blank")}},backToSetup(){this.training=!1,this.tactics=[],this.currentIndex=0},signOut(){this.user=null},setStatus(e,t=""){this.status=e,this.statusType=t},setMessage(e,t=""){this.message=e,this.messageClass=t}}}window.Chess=$i;window.Alpine=cn;cn.data("tacticsApp",_c);cn.start();
