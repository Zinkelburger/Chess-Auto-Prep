var ta=Object.defineProperty;var na=(e,t,n)=>t in e?ta(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>na(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var wn=!1,Sn=!1,Ie=[],xn=-1;function ra(e){ia(e)}function ia(e){Ie.includes(e)||Ie.push(e),oa()}function sa(e){let t=Ie.indexOf(e);t!==-1&&t>xn&&Ie.splice(t,1)}function oa(){!Sn&&!wn&&(wn=!0,queueMicrotask(aa))}function aa(){wn=!1,Sn=!0;for(let e=0;e<Ie.length;e++)Ie[e](),xn=e;Ie.length=0,xn=-1,Sn=!1}var Ze,ze,Je,pi,Cn=!0;function la(e){Cn=!1,e(),Cn=!0}function ca(e){Ze=e.reactive,Je=e.release,ze=t=>e.effect(t,{scheduler:n=>{Cn?ra(n):n()}}),pi=e.raw}function Dr(e){ze=e}function ua(e){let t=()=>{};return[r=>{let i=ze(r);return e._x_effects||(e._x_effects=new Set,e._x_runEffects=()=>{e._x_effects.forEach(s=>s())}),e._x_effects.add(i),t=()=>{i!==void 0&&(e._x_effects.delete(i),Je(i))},i},()=>{t()}]}function gi(e,t){let n=!0,r,i=ze(()=>{let s=e();JSON.stringify(s),n?r=s:queueMicrotask(()=>{t(s,r),r=s}),n=!1});return()=>Je(i)}var mi=[],_i=[],vi=[];function fa(e){vi.push(e)}function Wn(e,t){typeof t=="function"?(e._x_cleanups||(e._x_cleanups=[]),e._x_cleanups.push(t)):(t=e,_i.push(t))}function bi(e){mi.push(e)}function yi(e,t,n){e._x_attributeCleanups||(e._x_attributeCleanups={}),e._x_attributeCleanups[t]||(e._x_attributeCleanups[t]=[]),e._x_attributeCleanups[t].push(n)}function wi(e,t){e._x_attributeCleanups&&Object.entries(e._x_attributeCleanups).forEach(([n,r])=>{(t===void 0||t.includes(n))&&(r.forEach(i=>i()),delete e._x_attributeCleanups[n])})}function ha(e){var t,n;for((t=e._x_effects)==null||t.forEach(sa);(n=e._x_cleanups)!=null&&n.length;)e._x_cleanups.pop()()}var Hn=new MutationObserver(Yn),Gn=!1;function Qn(){Hn.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),Gn=!0}function Si(){da(),Hn.disconnect(),Gn=!1}var it=[];function da(){let e=Hn.takeRecords();it.push(()=>e.length>0&&Yn(e));let t=it.length;queueMicrotask(()=>{if(it.length===t)for(;it.length>0;)it.shift()()})}function L(e){if(!Gn)return e();Si();let t=e();return Qn(),t}var Vn=!1,Ft=[];function pa(){Vn=!0}function ga(){Vn=!1,Yn(Ft),Ft=[]}function Yn(e){if(Vn){Ft=Ft.concat(e);return}let t=[],n=new Set,r=new Map,i=new Map;for(let s=0;s<e.length;s++)if(!e[s].target._x_ignoreMutationObserver&&(e[s].type==="childList"&&(e[s].removedNodes.forEach(o=>{o.nodeType===1&&o._x_marker&&n.add(o)}),e[s].addedNodes.forEach(o=>{if(o.nodeType===1){if(n.has(o)){n.delete(o);return}o._x_marker||t.push(o)}})),e[s].type==="attributes")){let o=e[s].target,a=e[s].attributeName,l=e[s].oldValue,c=()=>{r.has(o)||r.set(o,[]),r.get(o).push({name:a,value:o.getAttribute(a)})},u=()=>{i.has(o)||i.set(o,[]),i.get(o).push(a)};o.hasAttribute(a)&&l===null?c():o.hasAttribute(a)?(u(),c()):u()}i.forEach((s,o)=>{wi(o,s)}),r.forEach((s,o)=>{mi.forEach(a=>a(o,s))});for(let s of n)t.some(o=>o.contains(s))||_i.forEach(o=>o(s));for(let s of t)s.isConnected&&vi.forEach(o=>o(s));t=null,n=null,r=null,i=null}function xi(e){return De(Ke(e))}function bt(e,t,n){return e._x_dataStack=[t,...Ke(n||e)],()=>{e._x_dataStack=e._x_dataStack.filter(r=>r!==t)}}function Ke(e){return e._x_dataStack?e._x_dataStack:typeof ShadowRoot=="function"&&e instanceof ShadowRoot?Ke(e.host):e.parentNode?Ke(e.parentNode):[]}function De(e){return new Proxy({objects:e},ma)}var ma={ownKeys({objects:e}){return Array.from(new Set(e.flatMap(t=>Object.keys(t))))},has({objects:e},t){return t==Symbol.unscopables?!1:e.some(n=>Object.prototype.hasOwnProperty.call(n,t)||Reflect.has(n,t))},get({objects:e},t,n){return t=="toJSON"?_a:Reflect.get(e.find(r=>Reflect.has(r,t))||{},t,n)},set({objects:e},t,n,r){const i=e.find(o=>Object.prototype.hasOwnProperty.call(o,t))||e[e.length-1],s=Object.getOwnPropertyDescriptor(i,t);return s!=null&&s.set&&(s!=null&&s.get)?s.set.call(r,n)||!0:Reflect.set(i,t,n)}};function _a(){return Reflect.ownKeys(this).reduce((t,n)=>(t[n]=Reflect.get(this,n),t),{})}function Zn(e){let t=r=>typeof r=="object"&&!Array.isArray(r)&&r!==null,n=(r,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(r)).forEach(([s,{value:o,enumerable:a}])=>{if(a===!1||o===void 0||typeof o=="object"&&o!==null&&o.__v_skip)return;let l=i===""?s:`${i}.${s}`;typeof o=="object"&&o!==null&&o._x_interceptor?r[s]=o.initialize(e,l,s):t(o)&&o!==r&&!(o instanceof Element)&&n(o,l)})};return n(e)}function Ci(e,t=()=>{}){let n={initialValue:void 0,_x_interceptor:!0,initialize(r,i,s){return e(this.initialValue,()=>va(r,i),o=>En(r,i,o),i,s)}};return t(n),r=>{if(typeof r=="object"&&r!==null&&r._x_interceptor){let i=n.initialize.bind(n);n.initialize=(s,o,a)=>{let l=r.initialize(s,o,a);return n.initialValue=l,i(s,o,a)}}else n.initialValue=r;return n}}function va(e,t){return t.split(".").reduce((n,r)=>n[r],e)}function En(e,t,n){if(typeof t=="string"&&(t=t.split(".")),t.length===1)e[t[0]]=n;else{if(t.length===0)throw error;return e[t[0]]||(e[t[0]]={}),En(e[t[0]],t.slice(1),n)}}var Ei={};function ue(e,t){Ei[e]=t}function pt(e,t){let n=ba(t);return Object.entries(Ei).forEach(([r,i])=>{Object.defineProperty(e,`$${r}`,{get(){return i(t,n)},enumerable:!1})}),e}function ba(e){let[t,n]=Ii(e),r={interceptor:Ci,...t};return Wn(e,n),r}function ya(e,t,n,...r){try{return n(...r)}catch(i){gt(i,e,t)}}function gt(...e){return Ai(...e)}var Ai=Sa;function wa(e){Ai=e}function Sa(e,t,n=void 0){e=Object.assign(e??{message:"No error message given."},{el:t,expression:n}),console.warn(`Alpine Expression Error: ${e.message}

${n?'Expression: "'+n+`"

`:""}`,t),setTimeout(()=>{throw e},0)}var Qe=!0;function ki(e){let t=Qe;Qe=!1;let n=e();return Qe=t,n}function Ne(e,t,n={}){let r;return V(e,t)(i=>r=i,n),r}function V(...e){return Mi(...e)}var Mi=$i;function xa(e){Mi=e}var Pi;function Ca(e){Pi=e}function $i(e,t){let n={};pt(n,e);let r=[n,...Ke(e)],i=typeof t=="function"?Ea(r,t):ka(r,t,e);return ya.bind(null,e,t,i)}function Ea(e,t){return(n=()=>{},{scope:r={},params:i=[],context:s}={})=>{if(!Qe){mt(n,t,De([r,...e]),i);return}let o=t.apply(De([r,...e]),i);mt(n,o)}}var sn={};function Aa(e,t){if(sn[e])return sn[e];let n=Object.getPrototypeOf(async function(){}).constructor,r=/^[\n\s]*if.*\(.*\)/.test(e.trim())||/^(let|const)\s/.test(e.trim())?`(async()=>{ ${e} })()`:e,s=(()=>{try{let o=new n(["__self","scope"],`with (scope) { __self.result = ${r} }; __self.finished = true; return __self.result;`);return Object.defineProperty(o,"name",{value:`[Alpine] ${e}`}),o}catch(o){return gt(o,t,e),Promise.resolve()}})();return sn[e]=s,s}function ka(e,t,n){let r=Aa(t,n);return(i=()=>{},{scope:s={},params:o=[],context:a}={})=>{r.result=void 0,r.finished=!1;let l=De([s,...e]);if(typeof r=="function"){let c=r.call(a,r,l).catch(u=>gt(u,n,t));r.finished?(mt(i,r.result,l,o,n),r.result=void 0):c.then(u=>{mt(i,u,l,o,n)}).catch(u=>gt(u,n,t)).finally(()=>r.result=void 0)}}}function mt(e,t,n,r,i){if(Qe&&typeof t=="function"){let s=t.apply(n,r);s instanceof Promise?s.then(o=>mt(e,o,n,r)).catch(o=>gt(o,i,t)):e(s)}else typeof t=="object"&&t instanceof Promise?t.then(s=>e(s)):e(t)}function Ma(...e){return Pi(...e)}function Pa(e,t,n={}){let r={};pt(r,e);let i=[r,...Ke(e)],s=De([n.scope??{},...i]),o=n.params??[];if(t.includes("await")){let a=Object.getPrototypeOf(async function(){}).constructor,l=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(async()=>{ ${t} })()`:t;return new a(["scope"],`with (scope) { let __result = ${l}; return __result }`).call(n.context,s)}else{let a=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(()=>{ ${t} })()`:t,c=new Function(["scope"],`with (scope) { let __result = ${a}; return __result }`).call(n.context,s);return typeof c=="function"&&Qe?c.apply(s,o):c}}var Jn="x-";function Xe(e=""){return Jn+e}function $a(e){Jn=e}var Kt={};function B(e,t){return Kt[e]=t,{before(n){if(!Kt[n]){console.warn(String.raw`Cannot find directive \`${n}\`. \`${e}\` will use the default order of execution`);return}const r=Oe.indexOf(n);Oe.splice(r>=0?r:Oe.indexOf("DEFAULT"),0,e)}}}function Ta(e){return Object.keys(Kt).includes(e)}function Xn(e,t,n){if(t=Array.from(t),e._x_virtualDirectives){let s=Object.entries(e._x_virtualDirectives).map(([a,l])=>({name:a,value:l})),o=Ti(s);s=s.map(a=>o.find(l=>l.name===a.name)?{name:`x-bind:${a.name}`,value:`"${a.value}"`}:a),t=t.concat(s)}let r={};return t.map(Ri((s,o)=>r[s]=o)).filter(Ki).map(Na(r,n)).sort(La).map(s=>Ia(e,s))}function Ti(e){return Array.from(e).map(Ri()).filter(t=>!Ki(t))}var An=!1,ut=new Map,Oi=Symbol();function Oa(e){An=!0;let t=Symbol();Oi=t,ut.set(t,[]);let n=()=>{for(;ut.get(t).length;)ut.get(t).shift()();ut.delete(t)},r=()=>{An=!1,n()};e(n),r()}function Ii(e){let t=[],n=a=>t.push(a),[r,i]=ua(e);return t.push(i),[{Alpine:tt,effect:r,cleanup:n,evaluateLater:V.bind(V,e),evaluate:Ne.bind(Ne,e)},()=>t.forEach(a=>a())]}function Ia(e,t){let n=()=>{},r=Kt[t.type]||n,[i,s]=Ii(e);yi(e,t.original,s);let o=()=>{e._x_ignore||e._x_ignoreSelf||(r.inline&&r.inline(e,t,i),r=r.bind(r,e,t,i),An?ut.get(Oi).push(r):r())};return o.runCleanups=s,o}var Ni=(e,t)=>({name:n,value:r})=>(n.startsWith(e)&&(n=n.replace(e,t)),{name:n,value:r}),Li=e=>e;function Ri(e=()=>{}){return({name:t,value:n})=>{let{name:r,value:i}=Fi.reduce((s,o)=>o(s),{name:t,value:n});return r!==t&&e(r,t),{name:r,value:i}}}var Fi=[];function er(e){Fi.push(e)}function Ki({name:e}){return Di().test(e)}var Di=()=>new RegExp(`^${Jn}([^:^.]+)\\b`);function Na(e,t){return({name:n,value:r})=>{let i=n.match(Di()),s=n.match(/:([a-zA-Z0-9\-_:]+)/),o=n.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],a=t||e[n]||n;return{type:i?i[1]:null,value:s?s[1]:null,modifiers:o.map(l=>l.replace(".","")),expression:r,original:a}}}var kn="DEFAULT",Oe=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",kn,"teleport"];function La(e,t){let n=Oe.indexOf(e.type)===-1?kn:e.type,r=Oe.indexOf(t.type)===-1?kn:t.type;return Oe.indexOf(n)-Oe.indexOf(r)}function ht(e,t,n={}){e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))}function Be(e,t){if(typeof ShadowRoot=="function"&&e instanceof ShadowRoot){Array.from(e.children).forEach(i=>Be(i,t));return}let n=!1;if(t(e,()=>n=!0),n)return;let r=e.firstElementChild;for(;r;)Be(r,t),r=r.nextElementSibling}function oe(e,...t){console.warn(`Alpine Warning: ${e}`,...t)}var Br=!1;function Ra(){Br&&oe("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),Br=!0,document.body||oe("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),ht(document,"alpine:init"),ht(document,"alpine:initializing"),Qn(),fa(t=>_e(t,Be)),Wn(t=>et(t)),bi((t,n)=>{Xn(t,n).forEach(r=>r())});let e=t=>!Ht(t.parentElement,!0);Array.from(document.querySelectorAll(ji().join(","))).filter(e).forEach(t=>{_e(t)}),ht(document,"alpine:initialized"),setTimeout(()=>{Ba()})}var tr=[],Bi=[];function qi(){return tr.map(e=>e())}function ji(){return tr.concat(Bi).map(e=>e())}function zi(e){tr.push(e)}function Ui(e){Bi.push(e)}function Ht(e,t=!1){return qe(e,n=>{if((t?ji():qi()).some(i=>n.matches(i)))return!0})}function qe(e,t){if(e){if(t(e))return e;if(e._x_teleportBack&&(e=e._x_teleportBack),e.parentNode instanceof ShadowRoot)return qe(e.parentNode.host,t);if(e.parentElement)return qe(e.parentElement,t)}}function Fa(e){return qi().some(t=>e.matches(t))}var Wi=[];function Ka(e){Wi.push(e)}var Da=1;function _e(e,t=Be,n=()=>{}){qe(e,r=>r._x_ignore)||Oa(()=>{t(e,(r,i)=>{r._x_marker||(n(r,i),Wi.forEach(s=>s(r,i)),Xn(r,r.attributes).forEach(s=>s()),r._x_ignore||(r._x_marker=Da++),r._x_ignore&&i())})})}function et(e,t=Be){t(e,n=>{ha(n),wi(n),delete n._x_marker})}function Ba(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([t,n,r])=>{Ta(n)||r.some(i=>{if(document.querySelector(i))return oe(`found "${i}", but missing ${t} plugin`),!0})})}var Mn=[],nr=!1;function rr(e=()=>{}){return queueMicrotask(()=>{nr||setTimeout(()=>{Pn()})}),new Promise(t=>{Mn.push(()=>{e(),t()})})}function Pn(){for(nr=!1;Mn.length;)Mn.shift()()}function qa(){nr=!0}function ir(e,t){return Array.isArray(t)?qr(e,t.join(" ")):typeof t=="object"&&t!==null?ja(e,t):typeof t=="function"?ir(e,t()):qr(e,t)}function qr(e,t){let n=i=>i.split(" ").filter(s=>!e.classList.contains(s)).filter(Boolean),r=i=>(e.classList.add(...i),()=>{e.classList.remove(...i)});return t=t===!0?t="":t||"",r(n(t))}function ja(e,t){let n=a=>a.split(" ").filter(Boolean),r=Object.entries(t).flatMap(([a,l])=>l?n(a):!1).filter(Boolean),i=Object.entries(t).flatMap(([a,l])=>l?!1:n(a)).filter(Boolean),s=[],o=[];return i.forEach(a=>{e.classList.contains(a)&&(e.classList.remove(a),o.push(a))}),r.forEach(a=>{e.classList.contains(a)||(e.classList.add(a),s.push(a))}),()=>{o.forEach(a=>e.classList.add(a)),s.forEach(a=>e.classList.remove(a))}}function Gt(e,t){return typeof t=="object"&&t!==null?za(e,t):Ua(e,t)}function za(e,t){let n={};return Object.entries(t).forEach(([r,i])=>{n[r]=e.style[r],r.startsWith("--")||(r=Wa(r)),e.style.setProperty(r,i)}),setTimeout(()=>{e.style.length===0&&e.removeAttribute("style")}),()=>{Gt(e,n)}}function Ua(e,t){let n=e.getAttribute("style",t);return e.setAttribute("style",t),()=>{e.setAttribute("style",n||"")}}function Wa(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function $n(e,t=()=>{}){let n=!1;return function(){n?t.apply(this,arguments):(n=!0,e.apply(this,arguments))}}B("transition",(e,{value:t,modifiers:n,expression:r},{evaluate:i})=>{typeof r=="function"&&(r=i(r)),r!==!1&&(!r||typeof r=="boolean"?Ga(e,n,t):Ha(e,r,t))});function Ha(e,t,n){Hi(e,ir,""),{enter:i=>{e._x_transition.enter.during=i},"enter-start":i=>{e._x_transition.enter.start=i},"enter-end":i=>{e._x_transition.enter.end=i},leave:i=>{e._x_transition.leave.during=i},"leave-start":i=>{e._x_transition.leave.start=i},"leave-end":i=>{e._x_transition.leave.end=i}}[n](t)}function Ga(e,t,n){Hi(e,Gt);let r=!t.includes("in")&&!t.includes("out")&&!n,i=r||t.includes("in")||["enter"].includes(n),s=r||t.includes("out")||["leave"].includes(n);t.includes("in")&&!r&&(t=t.filter((E,M)=>M<t.indexOf("out"))),t.includes("out")&&!r&&(t=t.filter((E,M)=>M>t.indexOf("out")));let o=!t.includes("opacity")&&!t.includes("scale"),a=o||t.includes("opacity"),l=o||t.includes("scale"),c=a?0:1,u=l?st(t,"scale",95)/100:1,h=st(t,"delay",0)/1e3,d=st(t,"origin","center"),y="opacity, transform",_=st(t,"duration",150)/1e3,w=st(t,"duration",75)/1e3,v="cubic-bezier(0.4, 0.0, 0.2, 1)";i&&(e._x_transition.enter.during={transformOrigin:d,transitionDelay:`${h}s`,transitionProperty:y,transitionDuration:`${_}s`,transitionTimingFunction:v},e._x_transition.enter.start={opacity:c,transform:`scale(${u})`},e._x_transition.enter.end={opacity:1,transform:"scale(1)"}),s&&(e._x_transition.leave.during={transformOrigin:d,transitionDelay:`${h}s`,transitionProperty:y,transitionDuration:`${w}s`,transitionTimingFunction:v},e._x_transition.leave.start={opacity:1,transform:"scale(1)"},e._x_transition.leave.end={opacity:c,transform:`scale(${u})`})}function Hi(e,t,n={}){e._x_transition||(e._x_transition={enter:{during:n,start:n,end:n},leave:{during:n,start:n,end:n},in(r=()=>{},i=()=>{}){Tn(e,t,{during:this.enter.during,start:this.enter.start,end:this.enter.end},r,i)},out(r=()=>{},i=()=>{}){Tn(e,t,{during:this.leave.during,start:this.leave.start,end:this.leave.end},r,i)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(e,t,n,r){const i=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let s=()=>i(n);if(t){e._x_transition&&(e._x_transition.enter||e._x_transition.leave)?e._x_transition.enter&&(Object.entries(e._x_transition.enter.during).length||Object.entries(e._x_transition.enter.start).length||Object.entries(e._x_transition.enter.end).length)?e._x_transition.in(n):s():e._x_transition?e._x_transition.in(n):s();return}e._x_hidePromise=e._x_transition?new Promise((o,a)=>{e._x_transition.out(()=>{},()=>o(r)),e._x_transitioning&&e._x_transitioning.beforeCancel(()=>a({isFromCancelledTransition:!0}))}):Promise.resolve(r),queueMicrotask(()=>{let o=Gi(e);o?(o._x_hideChildren||(o._x_hideChildren=[]),o._x_hideChildren.push(e)):i(()=>{let a=l=>{let c=Promise.all([l._x_hidePromise,...(l._x_hideChildren||[]).map(a)]).then(([u])=>u==null?void 0:u());return delete l._x_hidePromise,delete l._x_hideChildren,c};a(e).catch(l=>{if(!l.isFromCancelledTransition)throw l})})})};function Gi(e){let t=e.parentNode;if(t)return t._x_hidePromise?t:Gi(t)}function Tn(e,t,{during:n,start:r,end:i}={},s=()=>{},o=()=>{}){if(e._x_transitioning&&e._x_transitioning.cancel(),Object.keys(n).length===0&&Object.keys(r).length===0&&Object.keys(i).length===0){s(),o();return}let a,l,c;Qa(e,{start(){a=t(e,r)},during(){l=t(e,n)},before:s,end(){a(),c=t(e,i)},after:o,cleanup(){l(),c()}})}function Qa(e,t){let n,r,i,s=$n(()=>{L(()=>{n=!0,r||t.before(),i||(t.end(),Pn()),t.after(),e.isConnected&&t.cleanup(),delete e._x_transitioning})});e._x_transitioning={beforeCancels:[],beforeCancel(o){this.beforeCancels.push(o)},cancel:$n(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();s()}),finish:s},L(()=>{t.start(),t.during()}),qa(),requestAnimationFrame(()=>{if(n)return;let o=Number(getComputedStyle(e).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,a=Number(getComputedStyle(e).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;o===0&&(o=Number(getComputedStyle(e).animationDuration.replace("s",""))*1e3),L(()=>{t.before()}),r=!0,requestAnimationFrame(()=>{n||(L(()=>{t.end()}),Pn(),setTimeout(e._x_transitioning.finish,o+a),i=!0)})})}function st(e,t,n){if(e.indexOf(t)===-1)return n;const r=e[e.indexOf(t)+1];if(!r||t==="scale"&&isNaN(r))return n;if(t==="duration"||t==="delay"){let i=r.match(/([0-9]+)ms/);if(i)return i[1]}return t==="origin"&&["top","right","left","center","bottom"].includes(e[e.indexOf(t)+2])?[r,e[e.indexOf(t)+2]].join(" "):r}var xe=!1;function Ee(e,t=()=>{}){return(...n)=>xe?t(...n):e(...n)}function Va(e){return(...t)=>xe&&e(...t)}var Qi=[];function Qt(e){Qi.push(e)}function Ya(e,t){Qi.forEach(n=>n(e,t)),xe=!0,Vi(()=>{_e(t,(n,r)=>{r(n,()=>{})})}),xe=!1}var On=!1;function Za(e,t){t._x_dataStack||(t._x_dataStack=e._x_dataStack),xe=!0,On=!0,Vi(()=>{Ja(t)}),xe=!1,On=!1}function Ja(e){let t=!1;_e(e,(r,i)=>{Be(r,(s,o)=>{if(t&&Fa(s))return o();t=!0,i(s,o)})})}function Vi(e){let t=ze;Dr((n,r)=>{let i=t(n);return Je(i),()=>{}}),e(),Dr(t)}function Yi(e,t,n,r=[]){switch(e._x_bindings||(e._x_bindings=Ze({})),e._x_bindings[t]=n,t=r.includes("camel")?ol(t):t,t){case"value":Xa(e,n);break;case"style":tl(e,n);break;case"class":el(e,n);break;case"selected":case"checked":nl(e,t,n);break;default:Zi(e,t,n);break}}function Xa(e,t){if(es(e))e.attributes.value===void 0&&(e.value=t),window.fromModel&&(typeof t=="boolean"?e.checked=Nt(e.value)===t:e.checked=jr(e.value,t));else if(sr(e))Number.isInteger(t)?e.value=t:!Array.isArray(t)&&typeof t!="boolean"&&![null,void 0].includes(t)?e.value=String(t):Array.isArray(t)?e.checked=t.some(n=>jr(n,e.value)):e.checked=!!t;else if(e.tagName==="SELECT")sl(e,t);else{if(e.value===t)return;e.value=t===void 0?"":t}}function el(e,t){e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedClasses=ir(e,t)}function tl(e,t){e._x_undoAddedStyles&&e._x_undoAddedStyles(),e._x_undoAddedStyles=Gt(e,t)}function nl(e,t,n){Zi(e,t,n),il(e,t,n)}function Zi(e,t,n){[null,void 0,!1].includes(n)&&ll(t)?e.removeAttribute(t):(Ji(t)&&(n=t),rl(e,t,n))}function rl(e,t,n){e.getAttribute(t)!=n&&e.setAttribute(t,n)}function il(e,t,n){e[t]!==n&&(e[t]=n)}function sl(e,t){const n=[].concat(t).map(r=>r+"");Array.from(e.options).forEach(r=>{r.selected=n.includes(r.value)})}function ol(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function jr(e,t){return e==t}function Nt(e){return[1,"1","true","on","yes",!0].includes(e)?!0:[0,"0","false","off","no",!1].includes(e)?!1:e?!!e:null}var al=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function Ji(e){return al.has(e)}function ll(e){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(e)}function cl(e,t,n){return e._x_bindings&&e._x_bindings[t]!==void 0?e._x_bindings[t]:Xi(e,t,n)}function ul(e,t,n,r=!0){if(e._x_bindings&&e._x_bindings[t]!==void 0)return e._x_bindings[t];if(e._x_inlineBindings&&e._x_inlineBindings[t]!==void 0){let i=e._x_inlineBindings[t];return i.extract=r,ki(()=>Ne(e,i.expression))}return Xi(e,t,n)}function Xi(e,t,n){let r=e.getAttribute(t);return r===null?typeof n=="function"?n():n:r===""?!0:Ji(t)?!![t,"true"].includes(r):r}function sr(e){return e.type==="checkbox"||e.localName==="ui-checkbox"||e.localName==="ui-switch"}function es(e){return e.type==="radio"||e.localName==="ui-radio"}function ts(e,t){let n;return function(){const r=this,i=arguments,s=function(){n=null,e.apply(r,i)};clearTimeout(n),n=setTimeout(s,t)}}function ns(e,t){let n;return function(){let r=this,i=arguments;n||(e.apply(r,i),n=!0,setTimeout(()=>n=!1,t))}}function rs({get:e,set:t},{get:n,set:r}){let i=!0,s,o=ze(()=>{let a=e(),l=n();if(i)r(on(a)),i=!1;else{let c=JSON.stringify(a),u=JSON.stringify(l);c!==s?r(on(a)):c!==u&&t(on(l))}s=JSON.stringify(e()),JSON.stringify(n())});return()=>{Je(o)}}function on(e){return typeof e=="object"?JSON.parse(JSON.stringify(e)):e}function fl(e){(Array.isArray(e)?e:[e]).forEach(n=>n(tt))}var $e={},zr=!1;function hl(e,t){if(zr||($e=Ze($e),zr=!0),t===void 0)return $e[e];$e[e]=t,Zn($e[e]),typeof t=="object"&&t!==null&&t.hasOwnProperty("init")&&typeof t.init=="function"&&$e[e].init()}function dl(){return $e}var is={};function pl(e,t){let n=typeof t!="function"?()=>t:t;return e instanceof Element?ss(e,n()):(is[e]=n,()=>{})}function gl(e){return Object.entries(is).forEach(([t,n])=>{Object.defineProperty(e,t,{get(){return(...r)=>n(...r)}})}),e}function ss(e,t,n){let r=[];for(;r.length;)r.pop()();let i=Object.entries(t).map(([o,a])=>({name:o,value:a})),s=Ti(i);return i=i.map(o=>s.find(a=>a.name===o.name)?{name:`x-bind:${o.name}`,value:`"${o.value}"`}:o),Xn(e,i,n).map(o=>{r.push(o.runCleanups),o()}),()=>{for(;r.length;)r.pop()()}}var os={};function ml(e,t){os[e]=t}function _l(e,t){return Object.entries(os).forEach(([n,r])=>{Object.defineProperty(e,n,{get(){return(...i)=>r.bind(t)(...i)},enumerable:!1})}),e}var vl={get reactive(){return Ze},get release(){return Je},get effect(){return ze},get raw(){return pi},version:"3.15.3",flushAndStopDeferringMutations:ga,dontAutoEvaluateFunctions:ki,disableEffectScheduling:la,startObservingMutations:Qn,stopObservingMutations:Si,setReactivityEngine:ca,onAttributeRemoved:yi,onAttributesAdded:bi,closestDataStack:Ke,skipDuringClone:Ee,onlyDuringClone:Va,addRootSelector:zi,addInitSelector:Ui,setErrorHandler:wa,interceptClone:Qt,addScopeToNode:bt,deferMutations:pa,mapAttributes:er,evaluateLater:V,interceptInit:Ka,initInterceptors:Zn,injectMagics:pt,setEvaluator:xa,setRawEvaluator:Ca,mergeProxies:De,extractProp:ul,findClosest:qe,onElRemoved:Wn,closestRoot:Ht,destroyTree:et,interceptor:Ci,transition:Tn,setStyles:Gt,mutateDom:L,directive:B,entangle:rs,throttle:ns,debounce:ts,evaluate:Ne,evaluateRaw:Ma,initTree:_e,nextTick:rr,prefixed:Xe,prefix:$a,plugin:fl,magic:ue,store:hl,start:Ra,clone:Za,cloneNode:Ya,bound:cl,$data:xi,watch:gi,walk:Be,data:ml,bind:pl},tt=vl;function bl(e,t){const n=Object.create(null),r=e.split(",");for(let i=0;i<r.length;i++)n[r[i]]=!0;return i=>!!n[i]}var yl=Object.freeze({}),wl=Object.prototype.hasOwnProperty,Vt=(e,t)=>wl.call(e,t),Le=Array.isArray,dt=e=>as(e)==="[object Map]",Sl=e=>typeof e=="string",or=e=>typeof e=="symbol",Yt=e=>e!==null&&typeof e=="object",xl=Object.prototype.toString,as=e=>xl.call(e),ls=e=>as(e).slice(8,-1),ar=e=>Sl(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Cl=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},El=Cl(e=>e.charAt(0).toUpperCase()+e.slice(1)),cs=(e,t)=>e!==t&&(e===e||t===t),In=new WeakMap,ot=[],he,Re=Symbol("iterate"),Nn=Symbol("Map key iterate");function Al(e){return e&&e._isEffect===!0}function kl(e,t=yl){Al(e)&&(e=e.raw);const n=$l(e,t);return t.lazy||n(),n}function Ml(e){e.active&&(us(e),e.options.onStop&&e.options.onStop(),e.active=!1)}var Pl=0;function $l(e,t){const n=function(){if(!n.active)return e();if(!ot.includes(n)){us(n);try{return Ol(),ot.push(n),he=n,e()}finally{ot.pop(),fs(),he=ot[ot.length-1]}}};return n.id=Pl++,n.allowRecurse=!!t.allowRecurse,n._isEffect=!0,n.active=!0,n.raw=e,n.deps=[],n.options=t,n}function us(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}var Ve=!0,lr=[];function Tl(){lr.push(Ve),Ve=!1}function Ol(){lr.push(Ve),Ve=!0}function fs(){const e=lr.pop();Ve=e===void 0?!0:e}function ce(e,t,n){if(!Ve||he===void 0)return;let r=In.get(e);r||In.set(e,r=new Map);let i=r.get(n);i||r.set(n,i=new Set),i.has(he)||(i.add(he),he.deps.push(i),he.options.onTrack&&he.options.onTrack({effect:he,target:e,type:t,key:n}))}function Ce(e,t,n,r,i,s){const o=In.get(e);if(!o)return;const a=new Set,l=u=>{u&&u.forEach(h=>{(h!==he||h.allowRecurse)&&a.add(h)})};if(t==="clear")o.forEach(l);else if(n==="length"&&Le(e))o.forEach((u,h)=>{(h==="length"||h>=r)&&l(u)});else switch(n!==void 0&&l(o.get(n)),t){case"add":Le(e)?ar(n)&&l(o.get("length")):(l(o.get(Re)),dt(e)&&l(o.get(Nn)));break;case"delete":Le(e)||(l(o.get(Re)),dt(e)&&l(o.get(Nn)));break;case"set":dt(e)&&l(o.get(Re));break}const c=u=>{u.options.onTrigger&&u.options.onTrigger({effect:u,target:e,key:n,type:t,newValue:r,oldValue:i,oldTarget:s}),u.options.scheduler?u.options.scheduler(u):u()};a.forEach(c)}var Il=bl("__proto__,__v_isRef,__isVue"),hs=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(or)),Nl=ds(),Ll=ds(!0),Ur=Rl();function Rl(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const r=O(this);for(let s=0,o=this.length;s<o;s++)ce(r,"get",s+"");const i=r[t](...n);return i===-1||i===!1?r[t](...n.map(O)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){Tl();const r=O(this)[t].apply(this,n);return fs(),r}}),e}function ds(e=!1,t=!1){return function(r,i,s){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_raw"&&s===(e?t?Yl:_s:t?Vl:ms).get(r))return r;const o=Le(r);if(!e&&o&&Vt(Ur,i))return Reflect.get(Ur,i,s);const a=Reflect.get(r,i,s);return(or(i)?hs.has(i):Il(i))||(e||ce(r,"get",i),t)?a:Ln(a)?!o||!ar(i)?a.value:a:Yt(a)?e?vs(a):hr(a):a}}var Fl=Kl();function Kl(e=!1){return function(n,r,i,s){let o=n[r];if(!e&&(i=O(i),o=O(o),!Le(n)&&Ln(o)&&!Ln(i)))return o.value=i,!0;const a=Le(n)&&ar(r)?Number(r)<n.length:Vt(n,r),l=Reflect.set(n,r,i,s);return n===O(s)&&(a?cs(i,o)&&Ce(n,"set",r,i,o):Ce(n,"add",r,i)),l}}function Dl(e,t){const n=Vt(e,t),r=e[t],i=Reflect.deleteProperty(e,t);return i&&n&&Ce(e,"delete",t,void 0,r),i}function Bl(e,t){const n=Reflect.has(e,t);return(!or(t)||!hs.has(t))&&ce(e,"has",t),n}function ql(e){return ce(e,"iterate",Le(e)?"length":Re),Reflect.ownKeys(e)}var jl={get:Nl,set:Fl,deleteProperty:Dl,has:Bl,ownKeys:ql},zl={get:Ll,set(e,t){return console.warn(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0},deleteProperty(e,t){return console.warn(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0}},cr=e=>Yt(e)?hr(e):e,ur=e=>Yt(e)?vs(e):e,fr=e=>e,Zt=e=>Reflect.getPrototypeOf(e);function kt(e,t,n=!1,r=!1){e=e.__v_raw;const i=O(e),s=O(t);t!==s&&!n&&ce(i,"get",t),!n&&ce(i,"get",s);const{has:o}=Zt(i),a=r?fr:n?ur:cr;if(o.call(i,t))return a(e.get(t));if(o.call(i,s))return a(e.get(s));e!==i&&e.get(t)}function Mt(e,t=!1){const n=this.__v_raw,r=O(n),i=O(e);return e!==i&&!t&&ce(r,"has",e),!t&&ce(r,"has",i),e===i?n.has(e):n.has(e)||n.has(i)}function Pt(e,t=!1){return e=e.__v_raw,!t&&ce(O(e),"iterate",Re),Reflect.get(e,"size",e)}function Wr(e){e=O(e);const t=O(this);return Zt(t).has.call(t,e)||(t.add(e),Ce(t,"add",e,e)),this}function Hr(e,t){t=O(t);const n=O(this),{has:r,get:i}=Zt(n);let s=r.call(n,e);s?gs(n,r,e):(e=O(e),s=r.call(n,e));const o=i.call(n,e);return n.set(e,t),s?cs(t,o)&&Ce(n,"set",e,t,o):Ce(n,"add",e,t),this}function Gr(e){const t=O(this),{has:n,get:r}=Zt(t);let i=n.call(t,e);i?gs(t,n,e):(e=O(e),i=n.call(t,e));const s=r?r.call(t,e):void 0,o=t.delete(e);return i&&Ce(t,"delete",e,void 0,s),o}function Qr(){const e=O(this),t=e.size!==0,n=dt(e)?new Map(e):new Set(e),r=e.clear();return t&&Ce(e,"clear",void 0,void 0,n),r}function $t(e,t){return function(r,i){const s=this,o=s.__v_raw,a=O(o),l=t?fr:e?ur:cr;return!e&&ce(a,"iterate",Re),o.forEach((c,u)=>r.call(i,l(c),l(u),s))}}function Tt(e,t,n){return function(...r){const i=this.__v_raw,s=O(i),o=dt(s),a=e==="entries"||e===Symbol.iterator&&o,l=e==="keys"&&o,c=i[e](...r),u=n?fr:t?ur:cr;return!t&&ce(s,"iterate",l?Nn:Re),{next(){const{value:h,done:d}=c.next();return d?{value:h,done:d}:{value:a?[u(h[0]),u(h[1])]:u(h),done:d}},[Symbol.iterator](){return this}}}}function ve(e){return function(...t){{const n=t[0]?`on key "${t[0]}" `:"";console.warn(`${El(e)} operation ${n}failed: target is readonly.`,O(this))}return e==="delete"?!1:this}}function Ul(){const e={get(s){return kt(this,s)},get size(){return Pt(this)},has:Mt,add:Wr,set:Hr,delete:Gr,clear:Qr,forEach:$t(!1,!1)},t={get(s){return kt(this,s,!1,!0)},get size(){return Pt(this)},has:Mt,add:Wr,set:Hr,delete:Gr,clear:Qr,forEach:$t(!1,!0)},n={get(s){return kt(this,s,!0)},get size(){return Pt(this,!0)},has(s){return Mt.call(this,s,!0)},add:ve("add"),set:ve("set"),delete:ve("delete"),clear:ve("clear"),forEach:$t(!0,!1)},r={get(s){return kt(this,s,!0,!0)},get size(){return Pt(this,!0)},has(s){return Mt.call(this,s,!0)},add:ve("add"),set:ve("set"),delete:ve("delete"),clear:ve("clear"),forEach:$t(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(s=>{e[s]=Tt(s,!1,!1),n[s]=Tt(s,!0,!1),t[s]=Tt(s,!1,!0),r[s]=Tt(s,!0,!0)}),[e,n,t,r]}var[Wl,Hl]=Ul();function ps(e,t){const n=e?Hl:Wl;return(r,i,s)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?r:Reflect.get(Vt(n,i)&&i in r?n:r,i,s)}var Gl={get:ps(!1)},Ql={get:ps(!0)};function gs(e,t,n){const r=O(n);if(r!==n&&t.call(e,r)){const i=ls(e);console.warn(`Reactive ${i} contains both the raw and reactive versions of the same object${i==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var ms=new WeakMap,Vl=new WeakMap,_s=new WeakMap,Yl=new WeakMap;function Zl(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Jl(e){return e.__v_skip||!Object.isExtensible(e)?0:Zl(ls(e))}function hr(e){return e&&e.__v_isReadonly?e:bs(e,!1,jl,Gl,ms)}function vs(e){return bs(e,!0,zl,Ql,_s)}function bs(e,t,n,r,i){if(!Yt(e))return console.warn(`value cannot be made reactive: ${String(e)}`),e;if(e.__v_raw&&!(t&&e.__v_isReactive))return e;const s=i.get(e);if(s)return s;const o=Jl(e);if(o===0)return e;const a=new Proxy(e,o===2?r:n);return i.set(e,a),a}function O(e){return e&&O(e.__v_raw)||e}function Ln(e){return!!(e&&e.__v_isRef===!0)}ue("nextTick",()=>rr);ue("dispatch",e=>ht.bind(ht,e));ue("watch",(e,{evaluateLater:t,cleanup:n})=>(r,i)=>{let s=t(r),a=gi(()=>{let l;return s(c=>l=c),l},i);n(a)});ue("store",dl);ue("data",e=>xi(e));ue("root",e=>Ht(e));ue("refs",e=>(e._x_refs_proxy||(e._x_refs_proxy=De(Xl(e))),e._x_refs_proxy));function Xl(e){let t=[];return qe(e,n=>{n._x_refs&&t.push(n._x_refs)}),t}var an={};function ys(e){return an[e]||(an[e]=0),++an[e]}function ec(e,t){return qe(e,n=>{if(n._x_ids&&n._x_ids[t])return!0})}function tc(e,t){e._x_ids||(e._x_ids={}),e._x_ids[t]||(e._x_ids[t]=ys(t))}ue("id",(e,{cleanup:t})=>(n,r=null)=>{let i=`${n}${r?`-${r}`:""}`;return nc(e,i,t,()=>{let s=ec(e,n),o=s?s._x_ids[n]:ys(n);return r?`${n}-${o}-${r}`:`${n}-${o}`})});Qt((e,t)=>{e._x_id&&(t._x_id=e._x_id)});function nc(e,t,n,r){if(e._x_id||(e._x_id={}),e._x_id[t])return e._x_id[t];let i=r();return e._x_id[t]=i,n(()=>{delete e._x_id[t]}),i}ue("el",e=>e);ws("Focus","focus","focus");ws("Persist","persist","persist");function ws(e,t,n){ue(t,r=>oe(`You can't use [$${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,r))}B("modelable",(e,{expression:t},{effect:n,evaluateLater:r,cleanup:i})=>{let s=r(t),o=()=>{let u;return s(h=>u=h),u},a=r(`${t} = __placeholder`),l=u=>a(()=>{},{scope:{__placeholder:u}}),c=o();l(c),queueMicrotask(()=>{if(!e._x_model)return;e._x_removeModelListeners.default();let u=e._x_model.get,h=e._x_model.set,d=rs({get(){return u()},set(y){h(y)}},{get(){return o()},set(y){l(y)}});i(d)})});B("teleport",(e,{modifiers:t,expression:n},{cleanup:r})=>{e.tagName.toLowerCase()!=="template"&&oe("x-teleport can only be used on a <template> tag",e);let i=Vr(n),s=e.content.cloneNode(!0).firstElementChild;e._x_teleport=s,s._x_teleportBack=e,e.setAttribute("data-teleport-template",!0),s.setAttribute("data-teleport-target",!0),e._x_forwardEvents&&e._x_forwardEvents.forEach(a=>{s.addEventListener(a,l=>{l.stopPropagation(),e.dispatchEvent(new l.constructor(l.type,l))})}),bt(s,{},e);let o=(a,l,c)=>{c.includes("prepend")?l.parentNode.insertBefore(a,l):c.includes("append")?l.parentNode.insertBefore(a,l.nextSibling):l.appendChild(a)};L(()=>{o(s,i,t),Ee(()=>{_e(s)})()}),e._x_teleportPutBack=()=>{let a=Vr(n);L(()=>{o(e._x_teleport,a,t)})},r(()=>L(()=>{s.remove(),et(s)}))});var rc=document.createElement("div");function Vr(e){let t=Ee(()=>document.querySelector(e),()=>rc)();return t||oe(`Cannot find x-teleport element for selector: "${e}"`),t}var Ss=()=>{};Ss.inline=(e,{modifiers:t},{cleanup:n})=>{t.includes("self")?e._x_ignoreSelf=!0:e._x_ignore=!0,n(()=>{t.includes("self")?delete e._x_ignoreSelf:delete e._x_ignore})};B("ignore",Ss);B("effect",Ee((e,{expression:t},{effect:n})=>{n(V(e,t))}));function Rn(e,t,n,r){let i=e,s=l=>r(l),o={},a=(l,c)=>u=>c(l,u);if(n.includes("dot")&&(t=ic(t)),n.includes("camel")&&(t=sc(t)),n.includes("passive")&&(o.passive=!0),n.includes("capture")&&(o.capture=!0),n.includes("window")&&(i=window),n.includes("document")&&(i=document),n.includes("debounce")){let l=n[n.indexOf("debounce")+1]||"invalid-wait",c=Dt(l.split("ms")[0])?Number(l.split("ms")[0]):250;s=ts(s,c)}if(n.includes("throttle")){let l=n[n.indexOf("throttle")+1]||"invalid-wait",c=Dt(l.split("ms")[0])?Number(l.split("ms")[0]):250;s=ns(s,c)}return n.includes("prevent")&&(s=a(s,(l,c)=>{c.preventDefault(),l(c)})),n.includes("stop")&&(s=a(s,(l,c)=>{c.stopPropagation(),l(c)})),n.includes("once")&&(s=a(s,(l,c)=>{l(c),i.removeEventListener(t,s,o)})),(n.includes("away")||n.includes("outside"))&&(i=document,s=a(s,(l,c)=>{e.contains(c.target)||c.target.isConnected!==!1&&(e.offsetWidth<1&&e.offsetHeight<1||e._x_isShown!==!1&&l(c))})),n.includes("self")&&(s=a(s,(l,c)=>{c.target===e&&l(c)})),(ac(t)||xs(t))&&(s=a(s,(l,c)=>{lc(c,n)||l(c)})),i.addEventListener(t,s,o),()=>{i.removeEventListener(t,s,o)}}function ic(e){return e.replace(/-/g,".")}function sc(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function Dt(e){return!Array.isArray(e)&&!isNaN(e)}function oc(e){return[" ","_"].includes(e)?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function ac(e){return["keydown","keyup"].includes(e)}function xs(e){return["contextmenu","click","mouse"].some(t=>e.includes(t))}function lc(e,t){let n=t.filter(s=>!["window","document","prevent","stop","once","capture","self","away","outside","passive","preserve-scroll"].includes(s));if(n.includes("debounce")){let s=n.indexOf("debounce");n.splice(s,Dt((n[s+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.includes("throttle")){let s=n.indexOf("throttle");n.splice(s,Dt((n[s+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.length===0||n.length===1&&Yr(e.key).includes(n[0]))return!1;const i=["ctrl","shift","alt","meta","cmd","super"].filter(s=>n.includes(s));return n=n.filter(s=>!i.includes(s)),!(i.length>0&&i.filter(o=>((o==="cmd"||o==="super")&&(o="meta"),e[`${o}Key`])).length===i.length&&(xs(e.type)||Yr(e.key).includes(n[0])))}function Yr(e){if(!e)return[];e=oc(e);let t={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return t[e]=e,Object.keys(t).map(n=>{if(t[n]===e)return n}).filter(n=>n)}B("model",(e,{modifiers:t,expression:n},{effect:r,cleanup:i})=>{let s=e;t.includes("parent")&&(s=e.parentNode);let o=V(s,n),a;typeof n=="string"?a=V(s,`${n} = __placeholder`):typeof n=="function"&&typeof n()=="string"?a=V(s,`${n()} = __placeholder`):a=()=>{};let l=()=>{let d;return o(y=>d=y),Zr(d)?d.get():d},c=d=>{let y;o(_=>y=_),Zr(y)?y.set(d):a(()=>{},{scope:{__placeholder:d}})};typeof n=="string"&&e.type==="radio"&&L(()=>{e.hasAttribute("name")||e.setAttribute("name",n)});let u=e.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(e.type)||t.includes("lazy")?"change":"input",h=xe?()=>{}:Rn(e,u,t,d=>{c(ln(e,t,d,l()))});if(t.includes("fill")&&([void 0,null,""].includes(l())||sr(e)&&Array.isArray(l())||e.tagName.toLowerCase()==="select"&&e.multiple)&&c(ln(e,t,{target:e},l())),e._x_removeModelListeners||(e._x_removeModelListeners={}),e._x_removeModelListeners.default=h,i(()=>e._x_removeModelListeners.default()),e.form){let d=Rn(e.form,"reset",[],y=>{rr(()=>e._x_model&&e._x_model.set(ln(e,t,{target:e},l())))});i(()=>d())}e._x_model={get(){return l()},set(d){c(d)}},e._x_forceModelUpdate=d=>{d===void 0&&typeof n=="string"&&n.match(/\./)&&(d=""),window.fromModel=!0,L(()=>Yi(e,"value",d)),delete window.fromModel},r(()=>{let d=l();t.includes("unintrusive")&&document.activeElement.isSameNode(e)||e._x_forceModelUpdate(d)})});function ln(e,t,n,r){return L(()=>{if(n instanceof CustomEvent&&n.detail!==void 0)return n.detail!==null&&n.detail!==void 0?n.detail:n.target.value;if(sr(e))if(Array.isArray(r)){let i=null;return t.includes("number")?i=cn(n.target.value):t.includes("boolean")?i=Nt(n.target.value):i=n.target.value,n.target.checked?r.includes(i)?r:r.concat([i]):r.filter(s=>!cc(s,i))}else return n.target.checked;else{if(e.tagName.toLowerCase()==="select"&&e.multiple)return t.includes("number")?Array.from(n.target.selectedOptions).map(i=>{let s=i.value||i.text;return cn(s)}):t.includes("boolean")?Array.from(n.target.selectedOptions).map(i=>{let s=i.value||i.text;return Nt(s)}):Array.from(n.target.selectedOptions).map(i=>i.value||i.text);{let i;return es(e)?n.target.checked?i=n.target.value:i=r:i=n.target.value,t.includes("number")?cn(i):t.includes("boolean")?Nt(i):t.includes("trim")?i.trim():i}}})}function cn(e){let t=e?parseFloat(e):null;return uc(t)?t:e}function cc(e,t){return e==t}function uc(e){return!Array.isArray(e)&&!isNaN(e)}function Zr(e){return e!==null&&typeof e=="object"&&typeof e.get=="function"&&typeof e.set=="function"}B("cloak",e=>queueMicrotask(()=>L(()=>e.removeAttribute(Xe("cloak")))));Ui(()=>`[${Xe("init")}]`);B("init",Ee((e,{expression:t},{evaluate:n})=>typeof t=="string"?!!t.trim()&&n(t,{},!1):n(t,{},!1)));B("text",(e,{expression:t},{effect:n,evaluateLater:r})=>{let i=r(t);n(()=>{i(s=>{L(()=>{e.textContent=s})})})});B("html",(e,{expression:t},{effect:n,evaluateLater:r})=>{let i=r(t);n(()=>{i(s=>{L(()=>{e.innerHTML=s,e._x_ignoreSelf=!0,_e(e),delete e._x_ignoreSelf})})})});er(Ni(":",Li(Xe("bind:"))));var Cs=(e,{value:t,modifiers:n,expression:r,original:i},{effect:s,cleanup:o})=>{if(!t){let l={};gl(l),V(e,r)(u=>{ss(e,u,i)},{scope:l});return}if(t==="key")return fc(e,r);if(e._x_inlineBindings&&e._x_inlineBindings[t]&&e._x_inlineBindings[t].extract)return;let a=V(e,r);s(()=>a(l=>{l===void 0&&typeof r=="string"&&r.match(/\./)&&(l=""),L(()=>Yi(e,t,l,n))})),o(()=>{e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedStyles&&e._x_undoAddedStyles()})};Cs.inline=(e,{value:t,modifiers:n,expression:r})=>{t&&(e._x_inlineBindings||(e._x_inlineBindings={}),e._x_inlineBindings[t]={expression:r,extract:!1})};B("bind",Cs);function fc(e,t){e._x_keyExpression=t}zi(()=>`[${Xe("data")}]`);B("data",(e,{expression:t},{cleanup:n})=>{if(hc(e))return;t=t===""?"{}":t;let r={};pt(r,e);let i={};_l(i,r);let s=Ne(e,t,{scope:i});(s===void 0||s===!0)&&(s={}),pt(s,e);let o=Ze(s);Zn(o);let a=bt(e,o);o.init&&Ne(e,o.init),n(()=>{o.destroy&&Ne(e,o.destroy),a()})});Qt((e,t)=>{e._x_dataStack&&(t._x_dataStack=e._x_dataStack,t.setAttribute("data-has-alpine-state",!0))});function hc(e){return xe?On?!0:e.hasAttribute("data-has-alpine-state"):!1}B("show",(e,{modifiers:t,expression:n},{effect:r})=>{let i=V(e,n);e._x_doHide||(e._x_doHide=()=>{L(()=>{e.style.setProperty("display","none",t.includes("important")?"important":void 0)})}),e._x_doShow||(e._x_doShow=()=>{L(()=>{e.style.length===1&&e.style.display==="none"?e.removeAttribute("style"):e.style.removeProperty("display")})});let s=()=>{e._x_doHide(),e._x_isShown=!1},o=()=>{e._x_doShow(),e._x_isShown=!0},a=()=>setTimeout(o),l=$n(h=>h?o():s(),h=>{typeof e._x_toggleAndCascadeWithTransitions=="function"?e._x_toggleAndCascadeWithTransitions(e,h,o,s):h?a():s()}),c,u=!0;r(()=>i(h=>{!u&&h===c||(t.includes("immediate")&&(h?a():s()),l(h),c=h,u=!1)}))});B("for",(e,{expression:t},{effect:n,cleanup:r})=>{let i=pc(t),s=V(e,i.items),o=V(e,e._x_keyExpression||"index");e._x_prevKeys=[],e._x_lookup={},n(()=>dc(e,i,s,o)),r(()=>{Object.values(e._x_lookup).forEach(a=>L(()=>{et(a),a.remove()})),delete e._x_prevKeys,delete e._x_lookup})});function dc(e,t,n,r){let i=o=>typeof o=="object"&&!Array.isArray(o),s=e;n(o=>{gc(o)&&o>=0&&(o=Array.from(Array(o).keys(),v=>v+1)),o===void 0&&(o=[]);let a=e._x_lookup,l=e._x_prevKeys,c=[],u=[];if(i(o))o=Object.entries(o).map(([v,E])=>{let M=Jr(t,E,v,o);r(P=>{u.includes(P)&&oe("Duplicate key on x-for",e),u.push(P)},{scope:{index:v,...M}}),c.push(M)});else for(let v=0;v<o.length;v++){let E=Jr(t,o[v],v,o);r(M=>{u.includes(M)&&oe("Duplicate key on x-for",e),u.push(M)},{scope:{index:v,...E}}),c.push(E)}let h=[],d=[],y=[],_=[];for(let v=0;v<l.length;v++){let E=l[v];u.indexOf(E)===-1&&y.push(E)}l=l.filter(v=>!y.includes(v));let w="template";for(let v=0;v<u.length;v++){let E=u[v],M=l.indexOf(E);if(M===-1)l.splice(v,0,E),h.push([w,v]);else if(M!==v){let P=l.splice(v,1)[0],R=l.splice(M-1,1)[0];l.splice(v,0,R),l.splice(M,0,P),d.push([P,R])}else _.push(E);w=E}for(let v=0;v<y.length;v++){let E=y[v];E in a&&(L(()=>{et(a[E]),a[E].remove()}),delete a[E])}for(let v=0;v<d.length;v++){let[E,M]=d[v],P=a[E],R=a[M],F=document.createElement("div");L(()=>{R||oe('x-for ":key" is undefined or invalid',s,M,a),R.after(F),P.after(R),R._x_currentIfEl&&R.after(R._x_currentIfEl),F.before(P),P._x_currentIfEl&&P.after(P._x_currentIfEl),F.remove()}),R._x_refreshXForScope(c[u.indexOf(M)])}for(let v=0;v<h.length;v++){let[E,M]=h[v],P=E==="template"?s:a[E];P._x_currentIfEl&&(P=P._x_currentIfEl);let R=c[M],F=u[M],Z=document.importNode(s.content,!0).firstElementChild,ee=Ze(R);bt(Z,ee,s),Z._x_refreshXForScope=$=>{Object.entries($).forEach(([te,K])=>{ee[te]=K})},L(()=>{P.after(Z),Ee(()=>_e(Z))()}),typeof F=="object"&&oe("x-for key cannot be an object, it must be a string or an integer",s),a[F]=Z}for(let v=0;v<_.length;v++)a[_[v]]._x_refreshXForScope(c[u.indexOf(_[v])]);s._x_prevKeys=u})}function pc(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n=/^\s*\(|\)\s*$/g,r=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=e.match(r);if(!i)return;let s={};s.items=i[2].trim();let o=i[1].replace(n,"").trim(),a=o.match(t);return a?(s.item=o.replace(t,"").trim(),s.index=a[1].trim(),a[2]&&(s.collection=a[2].trim())):s.item=o,s}function Jr(e,t,n,r){let i={};return/^\[.*\]$/.test(e.item)&&Array.isArray(t)?e.item.replace("[","").replace("]","").split(",").map(o=>o.trim()).forEach((o,a)=>{i[o]=t[a]}):/^\{.*\}$/.test(e.item)&&!Array.isArray(t)&&typeof t=="object"?e.item.replace("{","").replace("}","").split(",").map(o=>o.trim()).forEach(o=>{i[o]=t[o]}):i[e.item]=t,e.index&&(i[e.index]=n),e.collection&&(i[e.collection]=r),i}function gc(e){return!Array.isArray(e)&&!isNaN(e)}function Es(){}Es.inline=(e,{expression:t},{cleanup:n})=>{let r=Ht(e);r._x_refs||(r._x_refs={}),r._x_refs[t]=e,n(()=>delete r._x_refs[t])};B("ref",Es);B("if",(e,{expression:t},{effect:n,cleanup:r})=>{e.tagName.toLowerCase()!=="template"&&oe("x-if can only be used on a <template> tag",e);let i=V(e,t),s=()=>{if(e._x_currentIfEl)return e._x_currentIfEl;let a=e.content.cloneNode(!0).firstElementChild;return bt(a,{},e),L(()=>{e.after(a),Ee(()=>_e(a))()}),e._x_currentIfEl=a,e._x_undoIf=()=>{L(()=>{et(a),a.remove()}),delete e._x_currentIfEl},a},o=()=>{e._x_undoIf&&(e._x_undoIf(),delete e._x_undoIf)};n(()=>i(a=>{a?s():o()})),r(()=>e._x_undoIf&&e._x_undoIf())});B("id",(e,{expression:t},{evaluate:n})=>{n(t).forEach(i=>tc(e,i))});Qt((e,t)=>{e._x_ids&&(t._x_ids=e._x_ids)});er(Ni("@",Li(Xe("on:"))));B("on",Ee((e,{value:t,modifiers:n,expression:r},{cleanup:i})=>{let s=r?V(e,r):()=>{};e.tagName.toLowerCase()==="template"&&(e._x_forwardEvents||(e._x_forwardEvents=[]),e._x_forwardEvents.includes(t)||e._x_forwardEvents.push(t));let o=Rn(e,t,n,a=>{s(()=>{},{scope:{$event:a},params:[a]})});i(()=>o())}));Jt("Collapse","collapse","collapse");Jt("Intersect","intersect","intersect");Jt("Focus","trap","focus");Jt("Mask","mask","mask");function Jt(e,t,n){B(t,r=>oe(`You can't use [x-${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,r))}tt.setEvaluator($i);tt.setRawEvaluator(Pa);tt.setReactivityEngine({reactive:hr,effect:kl,release:Ml,raw:O});var mc=tt,dr=mc;class _c{constructor(){this.worker=null,this.ready=!1,this.analyzing=!1,this.resolve=null,this.currentEval=null,this.bestMove=null,this.pv=[],this.initPromise=null}getOptimalThreadCount(){const t=navigator.hardwareConcurrency||1;return/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?Math.min(t,2):Math.min(t,4)}async init(){if(this.ready)return;if(this.initPromise)return this.initPromise;const t="/engines/stockfish.js";return this.initPromise=new Promise((n,r)=>{try{this.worker=new Worker(t),this.worker.onerror=i=>{console.error("Stockfish worker error:",i),r(new Error("Failed to load Stockfish engine"))},this.worker.onmessage=i=>{const s=i.data;if(s.includes("uciok")){this.ready=!0,this.worker.postMessage("setoption name Hash value 32");const o=this.getOptimalThreadCount();console.log(`Setting Stockfish threads to: ${o}`),this.worker.postMessage(`setoption name Threads value ${o}`),this.worker.postMessage("isready")}if(s.includes("readyok")&&!this.analyzing&&n(),s.startsWith("info depth")&&s.includes(" pv ")){const o=s.match(/score cp (-?\d+)/),a=s.match(/score mate (-?\d+)/),l=s.match(/ pv (.+)/);if(o)this.currentEval=parseInt(o[1])/100;else if(a){const c=parseInt(a[1]);this.currentEval=c>0?100:-100}l&&(this.pv=l[1].split(" "))}if(s.startsWith("bestmove")){const o=s.match(/bestmove (\S+)/);o&&(this.bestMove=o[1]),this.analyzing=!1,this.resolve&&(this.resolve({eval:this.currentEval,bestMove:this.bestMove,pv:[...this.pv]}),this.resolve=null)}},this.worker.postMessage("uci"),setTimeout(()=>{this.ready||r(new Error("Stockfish initialization timeout"))},1e4)}catch(i){r(i)}}),this.initPromise}async analyze(t,n=14){return this.ready||await this.init(),new Promise(r=>{this.resolve=r,this.analyzing=!0,this.currentEval=0,this.bestMove=null,this.pv=[],this.worker.postMessage("ucinewgame"),this.worker.postMessage(`position fen ${t}`),this.worker.postMessage(`go depth ${n}`)})}stop(){this.analyzing&&this.worker&&this.worker.postMessage("stop")}destroy(){this.worker&&(this.worker.terminate(),this.worker=null,this.ready=!1)}}class Xr{constructor(){this.module=null,this.ready=!1,this.analyzing=!1,this.resolve=null,this.currentEval=null,this.bestMove=null,this.pv=[],this.initPromise=null,this.engineName=null}async init(){if(!this.ready)return this.initPromise?this.initPromise:(this.initPromise=new Promise(async(t,n)=>{try{const r=this.createSharedWasmMemory(1536,32767);console.log("Initializing modern Stockfish with SharedArrayBuffer support...");const i="/stockfish-web/sf171-7.js",s=await import(i);this.module=await s.default({wasmMemory:r,locateFile:o=>o.endsWith(".wasm")?`/stockfish-web/${o}`:o,mainScriptUrlOrBlob:i}),this.module.listen=o=>{this.handleEngineMessage(o)},this.module.uci("uci"),setTimeout(()=>{this.ready||n(new Error("Modern Stockfish initialization timeout"))},15e3)}catch(r){console.error("Modern Stockfish initialization failed:",r),n(r)}}),this.initPromise)}createSharedWasmMemory(t,n=32767){let r=4;for(;;)try{return console.log(`Attempting to create SharedArrayBuffer memory: ${t}-${n} pages`),new WebAssembly.Memory({shared:!0,initial:t,maximum:n})}catch(i){if(n<=t||!(i instanceof RangeError))return console.warn("SharedArrayBuffer not available, falling back to regular memory"),new WebAssembly.Memory({initial:Math.min(t,1024),maximum:Math.min(n,2048)});n=Math.max(t,Math.ceil(n-n/r)),r=r===4?3:4}}handleEngineMessage(t){var r;const n=t.trim();if(n.includes("id name")&&(this.engineName=n.split("id name ")[1],console.log(`Engine name: ${this.engineName}`)),n.includes("uciok")){console.log("Engine ready, configuring options..."),this.module.uci("setoption name Hash value 64");const i=this.getOptimalThreadCount();console.log(`Setting threads to: ${i}`),this.module.uci(`setoption name Threads value ${i}`),this.module.uci("setoption name MultiPV value 1"),this.module.uci("isready")}if(n.includes("readyok")&&!this.analyzing&&(this.ready=!0,console.log("Modern Stockfish ready for analysis"),(r=this.resolve)==null||r.call(this)),n.startsWith("info depth")&&n.includes(" pv ")){const i=n.match(/score cp (-?\d+)/),s=n.match(/score mate (-?\d+)/),o=n.match(/ pv (.+)/);if(i)this.currentEval=parseInt(i[1])/100;else if(s){const a=parseInt(s[1]);this.currentEval=a>0?100:-100}o&&(this.pv=o[1].split(" "))}if(n.startsWith("bestmove")){const i=n.match(/bestmove (\S+)/);i&&(this.bestMove=i[1]),this.analyzing=!1,this.resolve&&(this.resolve({eval:this.currentEval,bestMove:this.bestMove,pv:[...this.pv],engine:this.engineName}),this.resolve=null)}}getOptimalThreadCount(){const t=navigator.hardwareConcurrency||1,n=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return typeof SharedArrayBuffer<"u"?n?Math.min(t,2):Math.min(t,8):1}async analyze(t,n=18){return this.ready||await this.init(),new Promise(r=>{this.resolve=r,this.analyzing=!0,this.currentEval=0,this.bestMove=null,this.pv=[],this.module.uci("ucinewgame"),this.module.uci(`position fen ${t}`),this.module.uci(`go depth ${n}`)})}stop(){this.analyzing&&this.module&&this.module.uci("stop")}destroy(){this.module&&(this.module.uci("quit"),this.module=null,this.ready=!1)}static isSupported(){const t=typeof WebAssembly<"u",n=typeof SharedArrayBuffer<"u",r=WebAssembly&&typeof WebAssembly.SIMD<"u";return{webassembly:t,sharedArrayBuffer:n,simd:r,recommended:t&&n}}}const vc=["white","black"],Bt=["a","b","c","d","e","f","g","h"],qt=["1","2","3","4","5","6","7","8"],bc=[...qt].reverse(),pr=Array.prototype.concat(...Bt.map(e=>qt.map(t=>e+t))),se=e=>pr[8*e[0]+e[1]],N=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],As=pr.map(N);function yc(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const wc=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},gr=e=>e==="white"?"black":"white",_t=(e,t)=>{const n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},Fn=(e,t)=>e.role===t.role&&e.color===t.color,yt=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],de=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},ks=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},mr=(e,t)=>{e.style.visibility=t?"visible":"hidden"},Ue=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Ms=e=>e.button===2,me=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function Ps(e,t,n){const r=N(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[n.left+n.width*r[0]/8+n.width/16,n.top+n.height*(7-r[1])/8+n.height/16]}const je=(e,t)=>Math.abs(e-t),Sc=e=>(t,n,r,i)=>je(t,r)<2&&(e==="white"?i===n+1||n<=1&&i===n+2&&t===r:i===n-1||n>=6&&i===n-2&&t===r),$s=(e,t,n,r)=>{const i=je(e,n),s=je(t,r);return i===1&&s===2||i===2&&s===1},Ts=(e,t,n,r)=>je(e,n)===je(t,r),Os=(e,t,n,r)=>e===n||t===r,Is=(e,t,n,r)=>Ts(e,t,n,r)||Os(e,t,n,r),xc=(e,t,n)=>(r,i,s,o)=>je(r,s)<2&&je(i,o)<2||n&&i===o&&i===(e==="white"?0:7)&&(r===4&&(s===2&&t.includes(0)||s===6&&t.includes(7))||t.includes(s));function Cc(e,t){const n=t==="white"?"1":"8",r=[];for(const[i,s]of e)i[1]===n&&s.color===t&&s.role==="rook"&&r.push(N(i)[0]);return r}function Ns(e,t,n){const r=e.get(t);if(!r)return[];const i=N(t),s=r.role,o=s==="pawn"?Sc(r.color):s==="knight"?$s:s==="bishop"?Ts:s==="rook"?Os:s==="queen"?Is:xc(r.color,Cc(e,r.color),n);return As.filter(a=>(i[0]!==a[0]||i[1]!==a[1])&&o(i[0],i[1],a[0],a[1])).map(se)}function J(e,...t){e&&setTimeout(()=>e(...t),1)}function Ec(e){e.orientation=gr(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Ac(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function kc(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,r]of e.pieces)r.role==="king"&&r.color===t&&(e.check=n)}function Mc(e,t,n,r){ke(e),e.premovable.current=[t,n],J(e.premovable.events.set,t,n,r)}function Ae(e){e.premovable.current&&(e.premovable.current=void 0,J(e.premovable.events.unset))}function Pc(e,t,n){Ae(e),e.predroppable.current={role:t,key:n},J(e.predroppable.events.set,t,n)}function ke(e){const t=e.predroppable;t.current&&(t.current=void 0,J(t.events.unset))}function $c(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||r.role!=="king")return!1;const i=N(t),s=N(n);if(i[1]!==0&&i[1]!==7||i[1]!==s[1])return!1;i[0]===4&&!e.pieces.has(n)&&(s[0]===6?n=se([7,s[1]]):s[0]===2&&(n=se([0,s[1]])));const o=e.pieces.get(n);return!o||o.color!==r.color||o.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),i[0]<s[0]?(e.pieces.set(se([6,s[1]]),r),e.pieces.set(se([5,s[1]]),o)):(e.pieces.set(se([2,s[1]]),r),e.pieces.set(se([3,s[1]]),o)),!0)}function Ls(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!r)return!1;const s=i&&i.color!==r.color?i:void 0;return n===e.selected&&ae(e),J(e.events.move,t,n,s),$c(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,J(e.events.change),s||!0}function _r(e,t,n,r){if(e.pieces.has(n))if(r)e.pieces.delete(n);else return!1;return J(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,J(e.events.change),e.movable.dests=void 0,e.turnColor=gr(e.turnColor),!0}function Rs(e,t,n){const r=Ls(e,t,n);return r&&(e.movable.dests=void 0,e.turnColor=gr(e.turnColor),e.animation.current=void 0),r}function Fs(e,t,n){if(vr(e,t,n)){const r=Rs(e,t,n);if(r){const i=e.hold.stop();ae(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(s.captured=r),J(e.movable.events.after,t,n,s),!0}}else if(Oc(e,t,n))return Mc(e,t,n,{ctrlKey:e.stats.ctrlKey}),ae(e),!0;return ae(e),!1}function Ks(e,t,n,r){const i=e.pieces.get(t);i&&(Tc(e,t,n)||r)?(e.pieces.delete(t),_r(e,i,n,r),J(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&Ic(e,t,n)?Pc(e,i.role,n):(Ae(e),ke(e)),e.pieces.delete(t),ae(e)}function Kn(e,t,n){if(J(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){ae(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&Fs(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Bs(e,t)||br(e,t))&&(Ds(e,t),e.hold.start())}function Ds(e,t){e.selected=t,br(e,t)?e.premovable.customDests||(e.premovable.dests=Ns(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function ae(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Bs(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const vr=(e,t,n)=>{var r,i;return t!==n&&Bs(e,t)&&(e.movable.free||!!(!((i=(r=e.movable.dests)===null||r===void 0?void 0:r.get(t))===null||i===void 0)&&i.includes(n)))};function Tc(e,t,n){const r=e.pieces.get(t);return!!r&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function br(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Oc(e,t,n){var r,i;const s=(i=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(t))!==null&&i!==void 0?i:Ns(e.pieces,t,e.premovable.castle);return t!==n&&br(e,t)&&s.includes(n)}function Ic(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function Nc(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Lc(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],r=t[1];let i=!1;if(vr(e,n,r)){const s=Rs(e,n,r);if(s){const o={premove:!0};s!==!0&&(o.captured=s),J(e.movable.events.after,n,r,o),i=!0}}return Ae(e),i}function Rc(e,t){const n=e.predroppable.current;let r=!1;if(!n)return!1;if(t(n)){const i={role:n.role,color:e.movable.color};_r(e,i,n.key)&&(J(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),r=!0)}return ke(e),r}function yr(e){Ae(e),ke(e),ae(e)}function ei(e){e.movable.color=e.movable.dests=e.animation.current=void 0,yr(e)}function We(e,t,n){let r=Math.floor(8*(e[0]-n.left)/n.width);t||(r=7-r);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(i=7-i),r>=0&&r<8&&i>=0&&i<8?se([r,i]):void 0}function Fc(e,t,n,r){const i=N(e),s=As.filter(c=>Is(i[0],i[1],c[0],c[1])||$s(i[0],i[1],c[0],c[1])),a=s.map(c=>Ps(se(c),n,r)).map(c=>_t(t,c)),[,l]=a.reduce((c,u,h)=>c[0]<u?c:[u,h],[a[0],0]);return se(s[l])}const X=e=>e.orientation==="white",qs="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Kc={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Dc={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function js(e){e==="start"&&(e=qs);const t=new Map;let n=7,r=0;for(const i of e)switch(i){case" ":case"[":return t;case"/":if(--n,n<0)return t;r=0;break;case"~":{const s=t.get(se([r-1,n]));s&&(s.promoted=!0);break}default:{const s=i.charCodeAt(0);if(s<57)r+=s-48;else{const o=i.toLowerCase();t.set(se([r,n]),{role:Kc[o],color:i===o?"black":"white"}),++r}}}return t}function Bc(e){return bc.map(t=>Bt.map(n=>{const r=e.get(n+t);if(r){let i=Dc[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function zs(e,t){t.animation&&(wr(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Us(e,t){var n,r,i;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((r=t.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),wr(e,t),t.fen&&(e.pieces=js(t.fen),e.drawable.shapes=((i=t.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in t&&kc(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&Ds(e,e.selected),zs(e,t),!e.movable.rookCastle&&e.movable.dests){const s=e.movable.color==="white"?"1":"8",o="e"+s,a=e.movable.dests.get(o),l=e.pieces.get(o);if(!a||!l||l.role!=="king")return;e.movable.dests.set(o,a.filter(c=>!(c==="a"+s&&a.includes("c"+s))&&!(c==="h"+s&&a.includes("g"+s))))}}function wr(e,t){for(const n in t)n==="__proto__"||n==="constructor"||!Object.prototype.hasOwnProperty.call(t,n)||(Object.prototype.hasOwnProperty.call(e,n)&&ti(e[n])&&ti(t[n])?wr(e[n],t[n]):e[n]=t[n])}function ti(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const Te=(e,t)=>t.animation.enabled?zc(e,t):we(e,t);function we(e,t){const n=e(t);return t.dom.redraw(),n}const un=(e,t)=>({key:e,pos:N(e),piece:t}),qc=(e,t)=>t.sort((n,r)=>_t(e.pos,n.pos)-_t(e.pos,r.pos))[0];function jc(e,t){const n=new Map,r=[],i=new Map,s=[],o=[],a=new Map;let l,c,u;for(const[h,d]of e)a.set(h,un(h,d));for(const h of pr)l=t.pieces.get(h),c=a.get(h),l?c?Fn(l,c.piece)||(s.push(c),o.push(un(h,l))):o.push(un(h,l)):c&&s.push(c);for(const h of o)c=qc(h,s.filter(d=>Fn(h.piece,d.piece))),c&&(u=[c.pos[0]-h.pos[0],c.pos[1]-h.pos[1]],n.set(h.key,u.concat(u)),r.push(c.key));for(const h of s)r.includes(h.key)||i.set(h.key,h.piece);return{anims:n,fadings:i}}function Ws(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(t-n.start)*n.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=Uc(r);for(const s of n.plan.anims.values())s[2]=s[0]*i,s[3]=s[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((s=performance.now())=>Ws(e,s))}}function zc(e,t){const n=new Map(t.pieces),r=e(t),i=jc(n,t);if(i.anims.size||i.fadings.size){const s=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},s||Ws(t,performance.now())}else t.dom.redraw();return r}const Uc=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Wc=["green","red","blue","yellow"];function Hc(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?ae(e):yr(e);const n=Ue(t),r=We(n,X(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:n,brush:Yc(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Hs(e))}function Hs(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=We(t.pos,X(e),e.dom.bounds());n||(t.snapToValidMove=!1);const r=t.snapToValidMove?Fc(t.orig,t.pos,X(e),e.dom.bounds()):n;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),Hs(e)}})}function Gc(e,t){e.drawable.current&&(e.drawable.current.pos=Ue(t))}function Qc(e){const t=e.drawable.current;t&&(t.mouseSq&&Zc(e.drawable,t),Gs(e))}function Gs(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Vc(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Qs(e.drawable))}function Yc(e){var t;const n=(e.shiftKey||e.ctrlKey)&&Ms(e),r=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return Wc[(n?1:0)+(r?2:0)]}function Zc(e,t){const n=i=>i.orig===t.orig&&i.dest===t.dest,r=e.shapes.find(n);r&&(e.shapes=e.shapes.filter(i=>!n(i))),(!r||r.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Qs(e)}function Qs(e){e.onChange&&e.onChange(e.shapes)}function Jc(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),r=Ue(t),i=We(r,X(e),n);if(!i)return;const s=e.pieces.get(i),o=e.selected;if(!o&&e.drawable.enabled&&(e.drawable.eraseOnClick||!s||s.color!==e.turnColor)&&Vc(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||s||o||Xc(e,r)))t.preventDefault();else if(t.touches)return;const a=!!e.premovable.current,l=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&vr(e,e.selected,i)?Te(h=>Kn(h,i),e):Kn(e,i);const c=e.selected===i,u=Ys(e,i);if(s&&u&&c&&Nc(e,i)){e.draggable.current={orig:i,piece:s,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:o,originTarget:t.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");const h=e.dom.elements.ghost;h&&(h.className=`ghost ${s.color} ${s.role}`,de(h,yt(n)(N(i),X(e))),mr(h,!0)),Sr(e)}else a&&Ae(e),l&&ke(e);e.dom.redraw()}function Xc(e,t){const n=X(e),r=e.dom.bounds(),i=Math.pow(r.width/8,2);for(const s of e.pieces.keys()){const o=Ps(s,n,r);if(_t(o,t)<=i)return!0}return!1}function eu(e,t,n,r){const i="a0";e.pieces.set(i,t),e.dom.redraw();const s=Ue(n);e.draggable.current={orig:i,piece:t,origPos:s,pos:s,started:!0,element:()=>Ys(e,i),originTarget:n.target,newPiece:!0,force:!!r,keyHasChanged:!1},Sr(e)}function Sr(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const r=e.pieces.get(n.orig);if(!r||!Fn(r,n.piece))jt(e);else if(!n.started&&_t(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const s=n.element();if(!s)return;s.cgDragging=!0,s.classList.add("dragging"),n.element=s}const i=e.dom.bounds();de(n.element,[n.pos[0]-i.left-i.width/16,n.pos[1]-i.top-i.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==We(n.pos,X(e),i))}Sr(e)})}function tu(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=Ue(t))}function nu(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}Ae(e),ke(e);const r=Ue(t)||n.pos,i=We(r,X(e),e.dom.bounds());i&&n.started&&n.orig!==i?n.newPiece?Ks(e,n.orig,i,n.force):(e.stats.ctrlKey=t.ctrlKey,Fs(e,n.orig,i)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(n.orig),J(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===i||!i)?ae(e):e.selectable.enabled||ae(e),Vs(e),e.draggable.current=void 0,e.dom.redraw()}function jt(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,ae(e),Vs(e),e.dom.redraw())}function Vs(e){const t=e.dom.elements;t.ghost&&mr(t.ghost,!1)}function Ys(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function ru(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{ni(e,2),setTimeout(()=>ni(e,void 0),120)},120)}function ni(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function iu(e,t){function n(){Ec(e),t()}return{set(r){r.orientation&&r.orientation!==e.orientation&&n(),zs(e,r),(r.fen?Te:we)(i=>Us(i,r),e)},state:e,getFen:()=>Bc(e.pieces),toggleOrientation:n,setPieces(r){Te(i=>Ac(i,r),e)},selectSquare(r,i){r?Te(s=>Kn(s,r,i),e):e.selected&&(ae(e),e.dom.redraw())},move(r,i){Te(s=>Ls(s,r,i),e)},newPiece(r,i){Te(s=>_r(s,r,i),e)},playPremove(){if(e.premovable.current){if(Te(Lc,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=Rc(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){we(Ae,e)},cancelPredrop(){we(ke,e)},cancelMove(){we(r=>{yr(r),jt(r)},e)},stop(){we(r=>{ei(r),jt(r)},e)},explode(r){ru(e,r)},setAutoShapes(r){we(i=>i.drawable.autoShapes=r,e)},setShapes(r){we(i=>i.drawable.shapes=r,e)},getKeyAtDomPos(r){return We(r,X(e),e.dom.bounds())},redrawAll:t,dragNewPiece(r,i,s){eu(e,r,i,s)},destroy(){ei(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function su(){return{pieces:js(qs),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:wc()}}const ri={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function ou(){const e=j("defs"),t=Y(j("filter"),{id:"cg-filter-blur"});return t.appendChild(Y(j("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function au(e,t,n){var r;const i=e.drawable,s=i.current,o=s&&s.mouseSq?s:void 0,a=new Map,l=e.dom.bounds(),c=i.autoShapes.filter(y=>!y.piece);for(const y of i.shapes.concat(c).concat(o?[o]:[])){if(!y.dest)continue;const _=(r=a.get(y.dest))!==null&&r!==void 0?r:new Set,w=Wt(Ut(N(y.orig),e.orientation),l),v=Wt(Ut(N(y.dest),e.orientation),l);_.add(Bn(w,v)),a.set(y.dest,_)}const u=i.shapes.concat(c).map(y=>({shape:y,current:!1,hash:ii(y,Dn(y.dest,a),!1,l)}));o&&u.push({shape:o,current:!0,hash:ii(o,Dn(o.dest,a),!0,l)});const h=u.map(y=>y.hash).join(";");if(h===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=h;const d=t.querySelector("defs");lu(i,u,d),cu(u,t.querySelector("g"),n.querySelector("g"),y=>hu(e,y,i.brushes,a,l))}function lu(e,t,n){var r;const i=new Map;let s;for(const l of t.filter(c=>c.shape.dest&&c.shape.brush))s=Zs(e.brushes[l.shape.brush],l.shape.modifiers),!((r=l.shape.modifiers)===null||r===void 0)&&r.hilite&&i.set(zt(s).key,zt(s)),i.set(s.key,s);const o=new Set;let a=n.firstElementChild;for(;a;)o.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[l,c]of i.entries())o.has(l)||n.appendChild(gu(c))}function cu(e,t,n,r){const i=new Map;for(const s of e)i.set(s.hash,!1);for(const s of[t,n]){const o=[];let a=s.firstElementChild,l;for(;a;)l=a.getAttribute("cgHash"),i.has(l)?i.set(l,!0):o.push(a),a=a.nextElementSibling;for(const c of o)s.removeChild(c)}for(const s of e.filter(o=>!i.get(o.hash)))for(const o of r(s))o.isCustom?n.appendChild(o.el):t.appendChild(o.el)}function ii({orig:e,dest:t,brush:n,piece:r,modifiers:i,customSvg:s,label:o},a,l,c){var u,h;return[c.width,c.height,l,e,t,n,a&&"-",r&&uu(r),i&&fu(i),s&&`custom-${si(s.html)},${(h=(u=s.center)===null||u===void 0?void 0:u[0])!==null&&h!==void 0?h:"o"}`,o&&`label-${si(o.text)}`].filter(d=>d).join(",")}function uu(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function fu(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function si(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return t.toString()}function hu(e,{shape:t,current:n,hash:r},i,s,o){var a,l;const c=Wt(Ut(N(t.orig),e.orientation),o),u=t.dest?Wt(Ut(N(t.dest),e.orientation),o):c,h=t.brush&&Zs(i[t.brush],t.modifiers),d=s.get(t.dest),y=[];if(h){const _=Y(j("g"),{cgHash:r});y.push({el:_}),c[0]!==u[0]||c[1]!==u[1]?_.appendChild(pu(t,h,c,u,n,Dn(t.dest,s))):_.appendChild(du(i[t.brush],c,n,o))}if(t.label){const _=t.label;(a=_.fill)!==null&&a!==void 0||(_.fill=t.brush&&i[t.brush].color);const w=t.brush?void 0:"tr";y.push({el:mu(_,r,c,u,d,w),isCustom:!0})}if(t.customSvg){const _=(l=t.customSvg.center)!==null&&l!==void 0?l:"orig",[w,v]=_==="label"?Xs(c,u,d).map(M=>M-.5):_==="dest"?u:c,E=Y(j("g"),{transform:`translate(${w},${v})`,cgHash:r});E.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,y.push({el:E,isCustom:!0})}return y}function du(e,t,n,r){const i=_u(),s=(r.width+r.height)/(4*Math.max(r.width,r.height));return Y(j("circle"),{stroke:e.color,"stroke-width":i[n?0:1],fill:"none",opacity:Js(e,n),cx:t[0],cy:t[1],r:s-i[1]/2})}function zt(e){return["#ffffff","#fff","white"].includes(e.color)?ri.hilitePrimary:ri.hiliteWhite}function pu(e,t,n,r,i,s){var o;function a(u){var h;const d=bu(s&&!i),y=r[0]-n[0],_=r[1]-n[1],w=Math.atan2(_,y),v=Math.cos(w)*d,E=Math.sin(w)*d;return Y(j("line"),{stroke:u?zt(t).color:t.color,"stroke-width":vu(t,i)+(u?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${u?zt(t).key:t.key})`,opacity:!((h=e.modifiers)===null||h===void 0)&&h.hilite?1:Js(t,i),x1:n[0],y1:n[1],x2:r[0]-v,y2:r[1]-E})}if(!(!((o=e.modifiers)===null||o===void 0)&&o.hilite))return a(!1);const l=j("g"),c=Y(j("g"),{filter:"url(#cg-filter-blur)"});return c.appendChild(yu(n,r)),c.appendChild(a(!0)),l.appendChild(c),l.appendChild(a(!1)),l}function gu(e){const t=Y(j("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(Y(j("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function mu(e,t,n,r,i,s){var o;const l=.4*.75**e.text.length,c=Xs(n,r,i),u=s==="tr"?.4:0,h=Y(j("g"),{transform:`translate(${c[0]+u},${c[1]-u})`,cgHash:t});h.appendChild(Y(j("circle"),{r:.4/2,"fill-opacity":s?1:.8,"stroke-opacity":s?1:.7,"stroke-width":.03,fill:(o=e.fill)!==null&&o!==void 0?o:"#666",stroke:"white"}));const d=Y(j("text"),{"font-size":l,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return d.innerHTML=e.text,h.appendChild(d),h}function Ut(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function Dn(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function j(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Y(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function Zs(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}:e}function _u(){return[3/64,4/64]}function vu(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Js(e,t){return(e.opacity||1)*(t?.9:1)}function bu(e){return(e?20:10)/64}function Wt(e,t){const n=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*r]}function yu(e,t){const n={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return Y(j("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function Bn(e,t,n=!0){const r=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return n?(Math.round(r*8/Math.PI)+16)%16:r}function wu(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((n,r)=>n+r*r,0))}function Xs(e,t,n){let r=wu(e,t);const i=Bn(e,t,!1);if(n&&(r-=33/64,n.size>1)){r-=10/64;const s=Bn(e,t);(n.has((s+1)%16)||n.has((s+15)%16))&&s&1&&(r-=.4)}return[e[0]-Math.cos(i)*r,e[1]-Math.sin(i)*r].map(s=>s+.5)}function Su(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const l of vc)e.classList.toggle("orientation-"+l,t.orientation===l);e.classList.toggle("manipulable",!t.viewOnly);const n=me("cg-container");e.appendChild(n);const r=me("cg-board");n.appendChild(r);let i,s,o;if(t.drawable.visible&&(i=Y(j("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(ou()),i.appendChild(j("g")),s=Y(j("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(j("g")),o=me("cg-auto-pieces"),n.appendChild(i),n.appendChild(s),n.appendChild(o)),t.coordinates){const l=t.orientation==="black"?" black":"",c=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const u=t.orientation==="white"?h=>h+1:h=>8-h;Bt.forEach((h,d)=>n.appendChild(fn(qt.map(y=>h+y),"squares rank"+u(d)+l+c)))}else n.appendChild(fn(qt,"ranks"+l+c)),n.appendChild(fn(Bt,"files"+l))}let a;return t.draggable.enabled&&t.draggable.showGhost&&(a=me("piece","ghost"),mr(a,!1),n.appendChild(a)),{board:r,container:n,wrap:e,ghost:a,svg:i,customSvg:s,autoPieces:o}}function fn(e,t){const n=me("coords",t);let r;for(const i of e)r=me("coord"),r.textContent=i,n.appendChild(r);return n}function xu(e,t){if(!e.dropmode.active)return;Ae(e),ke(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const r=Ue(t),i=r&&We(r,X(e),e.dom.bounds());i&&Ks(e,"a0",i)}e.dom.redraw()}function Cu(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const r=Au(e);n.addEventListener("touchstart",r,{passive:!1}),n.addEventListener("mousedown",r,{passive:!1})}function Eu(e,t){const n=[];if("ResizeObserver"in window||n.push(at(document.body,"chessground.resize",t)),!e.viewOnly){const r=oi(e,tu,Gc),i=oi(e,nu,Qc);for(const o of["touchmove","mousemove"])n.push(at(document,o,r));for(const o of["touchend","mouseup"])n.push(at(document,o,i));const s=()=>e.dom.bounds.clear();n.push(at(document,"scroll",s,{capture:!0,passive:!0})),n.push(at(window,"resize",s,{passive:!0}))}return()=>n.forEach(r=>r())}function at(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}const Au=e=>t=>{e.draggable.current?jt(e):e.drawable.current?Gs(e):t.shiftKey||Ms(t)?e.drawable.enabled&&Hc(e,t):e.viewOnly||(e.dropmode.active?xu(e,t):Jc(e,t))},oi=(e,t,n)=>r=>{e.drawable.current?e.drawable.enabled&&n(e,r):e.viewOnly||t(e,r)};function ku(e){const t=X(e),n=yt(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,s=e.animation.current,o=s?s.plan.anims:new Map,a=s?s.plan.fadings:new Map,l=e.draggable.current,c=Pu(e),u=new Set,h=new Set,d=new Map,y=new Map;let _,w,v,E,M,P,R,F,Z,ee;for(w=r.firstChild;w;){if(_=w.cgKey,eo(w))if(v=i.get(_),M=o.get(_),P=a.get(_),E=w.cgPiece,w.cgDragging&&(!l||l.orig!==_)&&(w.classList.remove("dragging"),de(w,n(N(_),t)),w.cgDragging=!1),!P&&w.cgFading&&(w.cgFading=!1,w.classList.remove("fading")),v){if(M&&w.cgAnimating&&E===lt(v)){const $=N(_);$[0]+=M[2],$[1]+=M[3],w.classList.add("anim"),de(w,n($,t))}else w.cgAnimating&&(w.cgAnimating=!1,w.classList.remove("anim"),de(w,n(N(_),t)),e.addPieceZIndex&&(w.style.zIndex=hn(N(_),t)));E===lt(v)&&(!P||!w.cgFading)?u.add(_):P&&E===lt(P)?(w.classList.add("fading"),w.cgFading=!0):dn(d,E,w)}else dn(d,E,w);else if(to(w)){const $=w.className;c.get(_)===$?h.add(_):dn(y,$,w)}w=w.nextSibling}for(const[$,te]of c)if(!h.has($)){Z=y.get(te),ee=Z&&Z.pop();const K=n(N($),t);if(ee)ee.cgKey=$,de(ee,K);else{const z=me("square",te);z.cgKey=$,de(z,K),r.insertBefore(z,r.firstChild)}}for(const[$,te]of i)if(M=o.get($),!u.has($))if(R=d.get(lt(te)),F=R&&R.pop(),F){F.cgKey=$,F.cgFading&&(F.classList.remove("fading"),F.cgFading=!1);const K=N($);e.addPieceZIndex&&(F.style.zIndex=hn(K,t)),M&&(F.cgAnimating=!0,F.classList.add("anim"),K[0]+=M[2],K[1]+=M[3]),de(F,n(K,t))}else{const K=lt(te),z=me("piece",K),re=N($);z.cgPiece=K,z.cgKey=$,M&&(z.cgAnimating=!0,re[0]+=M[2],re[1]+=M[3]),de(z,n(re,t)),e.addPieceZIndex&&(z.style.zIndex=hn(re,t)),r.appendChild(z)}for(const $ of d.values())li(e,$);for(const $ of y.values())li(e,$)}function Mu(e){const t=X(e),n=yt(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(eo(r)&&!r.cgAnimating||to(r))&&de(r,n(N(r.cgKey),t)),r=r.nextSibling}function ai(e){var t,n;const r=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,s=r.height/r.width,o=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=o*s;i.style.width=o+"px",i.style.height=a+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",o+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("---cg-height",a+"px")}const eo=e=>e.tagName==="PIECE",to=e=>e.tagName==="SQUARE";function li(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function hn(e,t){const r=e[1];return`${t?10-r:3+r}`}const lt=e=>`${e.color} ${e.role}`;function Pu(e){var t,n,r;const i=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)ge(i,a,"last-move");if(e.check&&e.highlight.check&&ge(i,e.check,"check"),e.selected&&(ge(i,e.selected,"selected"),e.movable.showDests)){const a=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(a)for(const c of a)ge(i,c,"move-dest"+(e.pieces.has(c)?" oc":""));const l=(r=(n=e.premovable.customDests)===null||n===void 0?void 0:n.get(e.selected))!==null&&r!==void 0?r:e.premovable.dests;if(l)for(const c of l)ge(i,c,"premove-dest"+(e.pieces.has(c)?" oc":""))}const s=e.premovable.current;if(s)for(const a of s)ge(i,a,"current-premove");else e.predroppable.current&&ge(i,e.predroppable.current.key,"current-premove");const o=e.exploding;if(o)for(const a of o.keys)ge(i,a,"exploding"+o.stage);return e.highlight.custom&&e.highlight.custom.forEach((a,l)=>{ge(i,l,a)}),i}function ge(e,t,n){const r=e.get(t);r?e.set(t,`${r} ${n}`):e.set(t,n)}function dn(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function $u(e,t,n){const r=new Map,i=[];for(const a of e)r.set(a.hash,!1);let s=t.firstElementChild,o;for(;s;)o=s.getAttribute("cgHash"),r.has(o)?r.set(o,!0):i.push(s),s=s.nextElementSibling;for(const a of i)t.removeChild(a);for(const a of e)r.get(a.hash)||t.appendChild(n(a))}function Tu(e,t){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:Nu(i),current:!1}));$u(r,t,i=>Iu(e,i,e.dom.bounds()))}function Ou(e){var t;const n=X(e),r=yt(e.dom.bounds());let i=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;i;)ks(i,r(N(i.cgKey),n),i.cgScale),i=i.nextSibling}function Iu(e,{shape:t,hash:n},r){var i,s,o;const a=t.orig,l=(i=t.piece)===null||i===void 0?void 0:i.role,c=(s=t.piece)===null||s===void 0?void 0:s.color,u=(o=t.piece)===null||o===void 0?void 0:o.scale,h=me("piece",`${l} ${c}`);return h.setAttribute("cgHash",n),h.cgKey=a,h.cgScale=u,ks(h,yt(r)(N(a),X(e)),u),h}const Nu=e=>{var t,n,r;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")};function Lu(e,t){const n=su();Us(n,t||{});function r(){const i="dom"in n?n.dom.unbind:void 0,s=Su(e,n),o=yc(()=>s.board.getBoundingClientRect()),a=u=>{ku(c),s.autoPieces&&Tu(c,s.autoPieces),!u&&s.svg&&au(c,s.svg,s.customSvg)},l=()=>{ai(c),Mu(c),s.autoPieces&&Ou(c)},c=n;return c.dom={elements:s,bounds:o,redraw:Ru(a),redrawNow:a,unbind:i},c.drawable.prevSvgHash="",ai(c),a(!1),Cu(c,l),i||(c.dom.unbind=Eu(c,l)),c.events.insert&&c.events.insert(s),c}return iu(r(),r)}function Ru(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}function Fu(e){return e!==null?{comment:e,variations:[]}:{variations:[]}}function Ku(e,t,n,r,i){const s={move:e,variations:i};return t&&(s.suffix=t),n&&(s.nag=n),r!==null&&(s.comment=r),s}function Du(...e){const[t,...n]=e;let r=t;for(const i of n)i!==null&&(r.variations=[i,...i.variations],i.variations=[],r=i);return t}function Bu(e,t){if(t.marker&&t.marker.comment){let n=t.root;for(;;){const r=n.variations[0];if(!r){n.comment=t.marker.comment;break}n=r}}return{headers:e,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function qu(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function Ye(e,t,n,r){var i=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(i,Ye.prototype),i.expected=t,i.found=n,i.location=r,i.name="SyntaxError",i}qu(Ye,Error);function pn(e,t,n){return n=n||" ",e.length>t?e:(t-=e.length,n+=n.repeat(t),e+n.slice(0,t))}Ye.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var n=null,r;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,s=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(i):i,o=this.location.source+":"+s.line+":"+s.column;if(n){var a=this.location.end,l=pn("",s.line.toString().length," "),c=n[i.line-1],u=i.line===a.line?a.column:c.length+1,h=u-i.column||1;t+=`
 --> `+o+`
`+l+` |
`+s.line+" | "+c+`
`+l+" | "+pn("",i.column-1," ")+pn("",h,"^")}else t+=`
 at `+o}return t};Ye.buildMessage=function(e,t){var n={literal:function(c){return'"'+i(c.text)+'"'},class:function(c){var u=c.parts.map(function(h){return Array.isArray(h)?s(h[0])+"-"+s(h[1]):s(h)});return"["+(c.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function r(c){return c.charCodeAt(0).toString(16).toUpperCase()}function i(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+r(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+r(u)})}function s(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+r(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+r(u)})}function o(c){return n[c.type](c)}function a(c){var u=c.map(o),h,d;if(u.sort(),u.length>0){for(h=1,d=1;h<u.length;h++)u[h-1]!==u[h]&&(u[d]=u[h],d++);u.length=d}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}function l(c){return c?'"'+i(c)+'"':"end of input"}return"Expected "+a(e)+" but "+l(t)+" found."};function ju(e,t){t=t!==void 0?t:{};var n={},r=t.grammarSource,i={pgn:Ir},s=Ir,o="[",a='"',l="]",c=".",u="O-O-O",h="O-O",d="0-0-0",y="0-0",_="$",w="{",v="}",E=";",M="(",P=")",R="1-0",F="0-1",Z="1/2-1/2",ee="*",$=/^[a-zA-Z]/,te=/^[^"]/,K=/^[0-9]/,z=/^[.]/,re=/^[a-zA-Z1-8\-=]/,en=/^[+#]/,wt=/^[!?]/,pe=/^[^}]/,He=/^[^\r\n]/,St=/^[ \t\r\n]/,tn=ie("tag pair"),xt=U("[",!1),nt=U('"',!1),xr=U("]",!1),io=ie("tag name"),nn=fe([["a","z"],["A","Z"]],!1,!1),so=ie("tag value"),Cr=fe(['"'],!0,!1),oo=ie("move number"),Ct=fe([["0","9"]],!1,!1),ao=U(".",!1),Er=fe(["."],!1,!1),lo=ie("standard algebraic notation"),co=U("O-O-O",!1),uo=U("O-O",!1),fo=U("0-0-0",!1),ho=U("0-0",!1),Ar=fe([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),po=fe(["+","#"],!1,!1),go=ie("suffix annotation"),kr=fe(["!","?"],!1,!1),mo=ie("NAG"),_o=U("$",!1),vo=ie("brace comment"),bo=U("{",!1),Mr=fe(["}"],!0,!1),yo=U("}",!1),wo=ie("rest of line comment"),So=U(";",!1),Pr=fe(["\r",`
`],!0,!1),xo=ie("variation"),Co=U("(",!1),Eo=U(")",!1),Ao=ie("game termination marker"),ko=U("1-0",!1),Mo=U("0-1",!1),Po=U("1/2-1/2",!1),$o=U("*",!1),To=ie("whitespace"),$r=fe([" ","	","\r",`
`],!1,!1),Oo=function(f,g){return Bu(f,g)},Io=function(f){return Object.fromEntries(f)},No=function(f,g){return[f,g]},Lo=function(f,g){return{root:f,marker:g}},Ro=function(f,g){return Du(Fu(f),...g.flat())},Fo=function(f,g,m,x,C){return Ku(f,g,m,x,C)},Ko=function(f){return f},Do=function(f){return f.replace(/[\r\n]+/g," ")},Bo=function(f){return f.trim()},qo=function(f){return f},jo=function(f,g){return{result:f,comment:g}},p=t.peg$currPos|0,Ge=[{line:1,column:1}],le=p,Et=t.peg$maxFailExpected||[],b=t.peg$silentFails|0,rt;if(t.startRule){if(!(t.startRule in i))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');s=i[t.startRule]}function U(f,g){return{type:"literal",text:f,ignoreCase:g}}function fe(f,g,m){return{type:"class",parts:f,inverted:g,ignoreCase:m}}function zo(){return{type:"end"}}function ie(f){return{type:"other",description:f}}function Tr(f){var g=Ge[f],m;if(g)return g;if(f>=Ge.length)m=Ge.length-1;else for(m=f;!Ge[--m];);for(g=Ge[m],g={line:g.line,column:g.column};m<f;)e.charCodeAt(m)===10?(g.line++,g.column=1):g.column++,m++;return Ge[f]=g,g}function Or(f,g,m){var x=Tr(f),C=Tr(g),T={source:r,start:{offset:f,line:x.line,column:x.column},end:{offset:g,line:C.line,column:C.column}};return T}function S(f){p<le||(p>le&&(le=p,Et=[]),Et.push(f))}function Uo(f,g,m){return new Ye(Ye.buildMessage(f,g),f,g,m)}function Ir(){var f,g,m;return f=p,g=Wo(),m=Qo(),f=Oo(g,m),f}function Wo(){var f,g,m;for(f=p,g=[],m=Nr();m!==n;)g.push(m),m=Nr();return m=Q(),f=Io(g),f}function Nr(){var f,g,m,x,C,T,Me;return b++,f=p,Q(),e.charCodeAt(p)===91?(g=o,p++):(g=n,b===0&&S(xt)),g!==n?(Q(),m=Ho(),m!==n?(Q(),e.charCodeAt(p)===34?(x=a,p++):(x=n,b===0&&S(nt)),x!==n?(C=Go(),e.charCodeAt(p)===34?(T=a,p++):(T=n,b===0&&S(nt)),T!==n?(Q(),e.charCodeAt(p)===93?(Me=l,p++):(Me=n,b===0&&S(xr)),Me!==n?f=No(m,C):(p=f,f=n)):(p=f,f=n)):(p=f,f=n)):(p=f,f=n)):(p=f,f=n),b--,f===n&&b===0&&S(tn),f}function Ho(){var f,g,m;if(b++,f=p,g=[],m=e.charAt(p),$.test(m)?p++:(m=n,b===0&&S(nn)),m!==n)for(;m!==n;)g.push(m),m=e.charAt(p),$.test(m)?p++:(m=n,b===0&&S(nn));else g=n;return g!==n?f=e.substring(f,p):f=g,b--,f===n&&(g=n,b===0&&S(io)),f}function Go(){var f,g,m;for(b++,f=p,g=[],m=e.charAt(p),te.test(m)?p++:(m=n,b===0&&S(Cr));m!==n;)g.push(m),m=e.charAt(p),te.test(m)?p++:(m=n,b===0&&S(Cr));return f=e.substring(f,p),b--,g=n,b===0&&S(so),f}function Qo(){var f,g,m;return f=p,g=Lr(),Q(),m=ea(),m===n&&(m=null),Q(),f=Lo(g,m),f}function Lr(){var f,g,m,x;for(f=p,g=rn(),g===n&&(g=null),m=[],x=Rr();x!==n;)m.push(x),x=Rr();return f=Ro(g,m),f}function Rr(){var f,g,m,x,C,T,Me,At;if(f=p,Q(),Vo(),Q(),g=Yo(),g!==n){for(m=Zo(),m===n&&(m=null),x=[],C=Fr();C!==n;)x.push(C),C=Fr();for(C=Q(),T=rn(),T===n&&(T=null),Me=[],At=Kr();At!==n;)Me.push(At),At=Kr();f=Fo(g,m,x,T,Me)}else p=f,f=n;return f}function Vo(){var f,g,m,x,C,T;for(b++,f=p,g=[],m=e.charAt(p),K.test(m)?p++:(m=n,b===0&&S(Ct));m!==n;)g.push(m),m=e.charAt(p),K.test(m)?p++:(m=n,b===0&&S(Ct));if(e.charCodeAt(p)===46?(m=c,p++):(m=n,b===0&&S(ao)),m!==n){for(x=Q(),C=[],T=e.charAt(p),z.test(T)?p++:(T=n,b===0&&S(Er));T!==n;)C.push(T),T=e.charAt(p),z.test(T)?p++:(T=n,b===0&&S(Er));g=[g,m,x,C],f=g}else p=f,f=n;return b--,f===n&&(g=n,b===0&&S(oo)),f}function Yo(){var f,g,m,x,C,T;if(b++,f=p,g=p,e.substr(p,5)===u?(m=u,p+=5):(m=n,b===0&&S(co)),m===n&&(e.substr(p,3)===h?(m=h,p+=3):(m=n,b===0&&S(uo)),m===n&&(e.substr(p,5)===d?(m=d,p+=5):(m=n,b===0&&S(fo)),m===n&&(e.substr(p,3)===y?(m=y,p+=3):(m=n,b===0&&S(ho)),m===n))))if(m=p,x=e.charAt(p),$.test(x)?p++:(x=n,b===0&&S(nn)),x!==n){if(C=[],T=e.charAt(p),re.test(T)?p++:(T=n,b===0&&S(Ar)),T!==n)for(;T!==n;)C.push(T),T=e.charAt(p),re.test(T)?p++:(T=n,b===0&&S(Ar));else C=n;C!==n?(x=[x,C],m=x):(p=m,m=n)}else p=m,m=n;return m!==n?(x=e.charAt(p),en.test(x)?p++:(x=n,b===0&&S(po)),x===n&&(x=null),m=[m,x],g=m):(p=g,g=n),g!==n?f=e.substring(f,p):f=g,b--,f===n&&(g=n,b===0&&S(lo)),f}function Zo(){var f,g,m;for(b++,f=p,g=[],m=e.charAt(p),wt.test(m)?p++:(m=n,b===0&&S(kr));m!==n;)g.push(m),g.length>=2?m=n:(m=e.charAt(p),wt.test(m)?p++:(m=n,b===0&&S(kr)));return g.length<1?(p=f,f=n):f=g,b--,f===n&&(g=n,b===0&&S(go)),f}function Fr(){var f,g,m,x,C;if(b++,f=p,Q(),e.charCodeAt(p)===36?(g=_,p++):(g=n,b===0&&S(_o)),g!==n){if(m=p,x=[],C=e.charAt(p),K.test(C)?p++:(C=n,b===0&&S(Ct)),C!==n)for(;C!==n;)x.push(C),C=e.charAt(p),K.test(C)?p++:(C=n,b===0&&S(Ct));else x=n;x!==n?m=e.substring(m,p):m=x,m!==n?f=Ko(m):(p=f,f=n)}else p=f,f=n;return b--,f===n&&b===0&&S(mo),f}function rn(){var f;return f=Jo(),f===n&&(f=Xo()),f}function Jo(){var f,g,m,x,C;if(b++,f=p,e.charCodeAt(p)===123?(g=w,p++):(g=n,b===0&&S(bo)),g!==n){for(m=p,x=[],C=e.charAt(p),pe.test(C)?p++:(C=n,b===0&&S(Mr));C!==n;)x.push(C),C=e.charAt(p),pe.test(C)?p++:(C=n,b===0&&S(Mr));m=e.substring(m,p),e.charCodeAt(p)===125?(x=v,p++):(x=n,b===0&&S(yo)),x!==n?f=Do(m):(p=f,f=n)}else p=f,f=n;return b--,f===n&&(g=n,b===0&&S(vo)),f}function Xo(){var f,g,m,x,C;if(b++,f=p,e.charCodeAt(p)===59?(g=E,p++):(g=n,b===0&&S(So)),g!==n){for(m=p,x=[],C=e.charAt(p),He.test(C)?p++:(C=n,b===0&&S(Pr));C!==n;)x.push(C),C=e.charAt(p),He.test(C)?p++:(C=n,b===0&&S(Pr));m=e.substring(m,p),f=Bo(m)}else p=f,f=n;return b--,f===n&&(g=n,b===0&&S(wo)),f}function Kr(){var f,g,m,x;return b++,f=p,Q(),e.charCodeAt(p)===40?(g=M,p++):(g=n,b===0&&S(Co)),g!==n?(m=Lr(),m!==n?(Q(),e.charCodeAt(p)===41?(x=P,p++):(x=n,b===0&&S(Eo)),x!==n?f=qo(m):(p=f,f=n)):(p=f,f=n)):(p=f,f=n),b--,f===n&&b===0&&S(xo),f}function ea(){var f,g,m;return b++,f=p,e.substr(p,3)===R?(g=R,p+=3):(g=n,b===0&&S(ko)),g===n&&(e.substr(p,3)===F?(g=F,p+=3):(g=n,b===0&&S(Mo)),g===n&&(e.substr(p,7)===Z?(g=Z,p+=7):(g=n,b===0&&S(Po)),g===n&&(e.charCodeAt(p)===42?(g=ee,p++):(g=n,b===0&&S($o))))),g!==n?(Q(),m=rn(),m===n&&(m=null),f=jo(g,m)):(p=f,f=n),b--,f===n&&(g=n,b===0&&S(Ao)),f}function Q(){var f,g;for(b++,f=[],g=e.charAt(p),St.test(g)?p++:(g=n,b===0&&S($r));g!==n;)f.push(g),g=e.charAt(p),St.test(g)?p++:(g=n,b===0&&S($r));return b--,g=n,b===0&&S(To),f}if(rt=s(),t.peg$library)return{peg$result:rt,peg$currPos:p,peg$FAILED:n,peg$maxFailExpected:Et,peg$maxFailPos:le};if(rt!==n&&p===e.length)return rt;throw rt!==n&&p<e.length&&S(zo()),Uo(Et,le<e.length?e.charAt(le):null,le<e.length?Or(le,le+1):Or(le,le))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const Lt=0xffffffffffffffffn;function gn(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function ci(e,t){return e*t&Lt}function zu(e){return function(){let t=BigInt(e&Lt),n=BigInt(e>>64n&Lt);const r=ci(gn(ci(t,5n),7n),9n);return n^=t,t=(gn(t,24n)^n^n<<16n)&Lt,n=gn(n,37n),e=n<<64n|t,r}}const Xt=zu(0xa187eb39cdcaed8f31c4b365b102e01en),Uu=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Xt()))),Wu=Array.from({length:8},()=>Xt()),Hu=Array.from({length:16},()=>Xt()),mn=Xt(),G="w",ne="b",D="p",qn="n",Rt="b",ft="r",Se="q",q="k",_n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Ot{constructor(t,n){I(this,"color");I(this,"from");I(this,"to");I(this,"piece");I(this,"captured");I(this,"promotion");I(this,"flags");I(this,"san");I(this,"lan");I(this,"before");I(this,"after");const{color:r,piece:i,from:s,to:o,flags:a,captured:l,promotion:c}=n,u=W(s),h=W(o);this.color=r,this.piece=i,this.from=u,this.to=h,this.san=t._moveToSan(n,t._moves({legal:!0})),this.lan=u+h,this.before=t.fen(),t._makeMove(n),this.after=t.fen(),t._undoMove(),this.flags="";for(const d in k)k[d]&a&&(this.flags+=Pe[d]);l&&(this.captured=l),c&&(this.promotion=c,this.lan+=c)}isCapture(){return this.flags.indexOf(Pe.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Pe.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Pe.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Pe.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Pe.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Pe.BIG_PAWN)>-1}}const H=-1,Pe={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},k={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},jn={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Gu={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Qu={...jn,...Gu},A={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},vn={b:[16,32,17,15],w:[-16,-32,-17,-15]},ui={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Vu=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Yu=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Zu={p:1,n:2,b:4,r:8,q:16,k:32},Ju="pnbrqkPNBRQK",fi=[qn,Rt,ft,Se],Xu=7,ef=6,tf=1,nf=0,It={[q]:k.KSIDE_CASTLE,[Se]:k.QSIDE_CASTLE},be={w:[{square:A.a1,flag:k.QSIDE_CASTLE},{square:A.h1,flag:k.KSIDE_CASTLE}],b:[{square:A.a8,flag:k.QSIDE_CASTLE},{square:A.h8,flag:k.KSIDE_CASTLE}]},rf={b:tf,w:ef},bn="--";function Fe(e){return e>>4}function vt(e){return e&15}function no(e){return"0123456789".indexOf(e)!==-1}function W(e){const t=vt(e),n=Fe(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function ct(e){return e===G?ne:G}function sf(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(t[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(t[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=t[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<i.length;o++){let a=0,l=!1;for(let c=0;c<i[o].length;c++)if(no(i[o][c])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(i[o][c],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[o][c]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,l=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:a}of s){if(!a.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((t[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(i[0]+i[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function of(e,t){const n=e.from,r=e.to,i=e.piece;let s=0,o=0,a=0;for(let l=0,c=t.length;l<c;l++){const u=t[l].from,h=t[l].to,d=t[l].piece;i===d&&n!==u&&r===h&&(s++,Fe(n)===Fe(u)&&o++,vt(n)===vt(u)&&a++)}return s>0?o>0&&a>0?W(n):a>0?W(n).charAt(1):W(n).charAt(0):""}function ye(e,t,n,r,i,s=void 0,o=k.NORMAL){const a=Fe(r);if(i===D&&(a===Xu||a===nf))for(let l=0;l<fi.length;l++){const c=fi[l];e.push({color:t,from:n,to:r,piece:i,captured:s,promotion:c,flags:o|k.PROMOTION})}else e.push({color:t,from:n,to:r,piece:i,captured:s,flags:o})}function hi(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:D:(t=t.toLowerCase(),t==="o"?q:t)}function yn(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}let af=class{constructor(t=_n,{skipValidation:n=!1}={}){I(this,"_board",new Array(128));I(this,"_turn",G);I(this,"_header",{});I(this,"_kings",{w:H,b:H});I(this,"_epSquare",-1);I(this,"_halfMoves",0);I(this,"_moveNumber",0);I(this,"_history",[]);I(this,"_comments",{});I(this,"_castling",{w:0,b:0});I(this,"_hash",0n);I(this,"_positionCount",new Map);this.load(t,{skipValidation:n})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:H,b:H},this._turn=G,this._castling={w:0,b:0},this._epSquare=H,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Qu},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:n=!1,preserveHeaders:r=!1}={}){let i=t.split(/\s+/);if(i.length>=2&&i.length<6){const a=["-","-","0","1"];t=i.concat(a.slice(-(6-i.length))).join(" ")}if(i=t.split(/\s+/),!n){const{ok:a,error:l}=sf(t);if(!a)throw new Error(l)}const s=i[0];let o=0;this.clear({preserveHeaders:r});for(let a=0;a<s.length;a++){const l=s.charAt(a);if(l==="/")o+=8;else if(no(l))o+=parseInt(l,10);else{const c=l<"a"?G:ne;this._put({type:l.toLowerCase(),color:c},W(o)),o++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=k.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=k.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=k.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=k.QSIDE_CASTLE),this._epSquare=i[3]==="-"?H:A[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var o,a;let n=0,r="";for(let l=A.a8;l<=A.h1;l++){if(this._board[l]){n>0&&(r+=n,n=0);const{color:c,type:u}=this._board[l];r+=c===G?u.toUpperCase():u.toLowerCase()}else n++;l+1&136&&(n>0&&(r+=n),l!==A.h1&&(r+="/"),n=0,l+=8)}let i="";this._castling[G]&k.KSIDE_CASTLE&&(i+="K"),this._castling[G]&k.QSIDE_CASTLE&&(i+="Q"),this._castling[ne]&k.KSIDE_CASTLE&&(i+="k"),this._castling[ne]&k.QSIDE_CASTLE&&(i+="q"),i=i||"-";let s="-";if(this._epSquare!==H)if(t)s=W(this._epSquare);else{const l=this._epSquare+(this._turn===G?16:-16),c=[l+1,l-1];for(const u of c){if(u&136)continue;const h=this._turn;if(((o=this._board[u])==null?void 0:o.color)===h&&((a=this._board[u])==null?void 0:a.type)===D){this._makeMove({color:h,from:u,to:this._epSquare,piece:D,captured:D,flags:k.EP_CAPTURE});const d=!this._isKingAttacked(h);if(this._undoMove(),d){s=W(this._epSquare);break}}}}return[r,this._turn,i,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:n,type:r}=this._board[t],i={w:0,b:1}[n],s={p:0,n:1,b:2,r:3,q:4,k:5}[r];return Uu[i][s][t]}_epKey(){return this._epSquare===H?0n:Wu[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return Hu[t]}_computeHash(){let t=0n;for(let n=A.a8;n<=A.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(t^=this._pieceKey(n))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=mn),t}_updateSetup(t){this._history.length>0||(t!==_n?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(_n)}get(t){return this._board[A[t]]}findPiece(t){var r;const n=[];for(let i=A.a8;i<=A.h1;i++){if(i&136){i+=7;continue}!this._board[i]||((r=this._board[i])==null?void 0:r.color)!==t.color||this._board[i].color===t.color&&this._board[i].type===t.type&&n.push(W(i))}return n}put({type:t,color:n},r){return this._put({type:t,color:n},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,n){this._hash^=this._pieceKey(t),this._board[t]=n,this._hash^=this._pieceKey(t)}_put({type:t,color:n},r){if(Ju.indexOf(t.toLowerCase())===-1||!(r in A))return!1;const i=A[r];if(t==q&&!(this._kings[n]==H||this._kings[n]==i))return!1;const s=this._board[i];return s&&s.type===q&&(this._kings[s.color]=H),this._set(i,{type:t,color:n}),t===q&&(this._kings[n]=i),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const n=this.get(t);return this._clear(A[t]),n&&n.type===q&&(this._kings[n.color]=H),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var r,i,s,o,a,l,c,u,h,d,y,_;this._hash^=this._castlingKey();const t=((r=this._board[A.e1])==null?void 0:r.type)===q&&((i=this._board[A.e1])==null?void 0:i.color)===G,n=((s=this._board[A.e8])==null?void 0:s.type)===q&&((o=this._board[A.e8])==null?void 0:o.color)===ne;(!t||((a=this._board[A.a1])==null?void 0:a.type)!==ft||((l=this._board[A.a1])==null?void 0:l.color)!==G)&&(this._castling.w&=-65),(!t||((c=this._board[A.h1])==null?void 0:c.type)!==ft||((u=this._board[A.h1])==null?void 0:u.color)!==G)&&(this._castling.w&=-33),(!n||((h=this._board[A.a8])==null?void 0:h.type)!==ft||((d=this._board[A.a8])==null?void 0:d.color)!==ne)&&(this._castling.b&=-65),(!n||((y=this._board[A.h8])==null?void 0:y.type)!==ft||((_=this._board[A.h8])==null?void 0:_.color)!==ne)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,o;if(this._epSquare===H)return;const t=this._epSquare+(this._turn===G?-16:16),n=this._epSquare+(this._turn===G?16:-16),r=[n+1,n-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((s=this._board[n])==null?void 0:s.color)!==ct(this._turn)||((o=this._board[n])==null?void 0:o.type)!==D){this._hash^=this._epKey(),this._epSquare=H;return}const i=a=>{var l,c;return!(a&136)&&((l=this._board[a])==null?void 0:l.color)===this._turn&&((c=this._board[a])==null?void 0:c.type)===D};r.some(i)||(this._hash^=this._epKey(),this._epSquare=H)}_attacked(t,n,r){const i=[];for(let s=A.a8;s<=A.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==t)continue;const o=this._board[s],a=s-n;if(a===0)continue;const l=a+119;if(Vu[l]&Zu[o.type]){if(o.type===D){if(a>0&&o.color===G||a<=0&&o.color===ne)if(r)i.push(W(s));else return!0;continue}if(o.type==="n"||o.type==="k")if(r){i.push(W(s));continue}else return!0;const c=Yu[l];let u=s+c,h=!1;for(;u!==n;){if(this._board[u]!=null){h=!0;break}u+=c}if(!h)if(r){i.push(W(s));continue}else return!0}}return r?i:!1}attackers(t,n){return n?this._attacked(n,A[t],!0):this._attacked(this._turn,A[t],!0)}_isKingAttacked(t){const n=this._kings[t];return n===-1?!1:this._attacked(ct(t),n)}hash(){return this._hash.toString(16)}isAttacked(t,n){return this._attacked(n,A[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let r=0,i=0;for(let s=A.a8;s<=A.h1;s++){if(i=(i+1)%2,s&136){s+=7;continue}const o=this._board[s];o&&(t[o.type]=o.type in t?t[o.type]+1:1,o.type===Rt&&n.push(i),r++)}if(r===2)return!0;if(r===3&&(t[Rt]===1||t[qn]===1))return!0;if(r===t[Rt]+2){let s=0;const o=n.length;for(let a=0;a<o;a++)s+=n[a];if(s===0||s===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:n=void 0,piece:r=void 0}={}){const i=this._moves({square:n,piece:r});return t?i.map(s=>new Ot(this,s)):i.map(s=>this._moveToSan(s,i))}_moves({legal:t=!0,piece:n=void 0,square:r=void 0}={}){var y;const i=r?r.toLowerCase():void 0,s=n==null?void 0:n.toLowerCase(),o=[],a=this._turn,l=ct(a);let c=A.a8,u=A.h1,h=!1;if(i)if(i in A)c=u=A[i],h=!0;else return[];for(let _=c;_<=u;_++){if(_&136){_+=7;continue}if(!this._board[_]||this._board[_].color===l)continue;const{type:w}=this._board[_];let v;if(w===D){if(s&&s!==w)continue;v=_+vn[a][0],this._board[v]||(ye(o,a,_,v,D),v=_+vn[a][1],rf[a]===Fe(_)&&!this._board[v]&&ye(o,a,_,v,D,void 0,k.BIG_PAWN));for(let E=2;E<4;E++)v=_+vn[a][E],!(v&136)&&(((y=this._board[v])==null?void 0:y.color)===l?ye(o,a,_,v,D,this._board[v].type,k.CAPTURE):v===this._epSquare&&ye(o,a,_,v,D,D,k.EP_CAPTURE))}else{if(s&&s!==w)continue;for(let E=0,M=ui[w].length;E<M;E++){const P=ui[w][E];for(v=_;v+=P,!(v&136);){if(!this._board[v])ye(o,a,_,v,w);else{if(this._board[v].color===a)break;ye(o,a,_,v,w,this._board[v].type,k.CAPTURE);break}if(w===qn||w===q)break}}}}if((s===void 0||s===q)&&(!h||u===this._kings[a])){if(this._castling[a]&k.KSIDE_CASTLE){const _=this._kings[a],w=_+2;!this._board[_+1]&&!this._board[w]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,_+1)&&!this._attacked(l,w)&&ye(o,a,this._kings[a],w,q,void 0,k.KSIDE_CASTLE)}if(this._castling[a]&k.QSIDE_CASTLE){const _=this._kings[a],w=_-2;!this._board[_-1]&&!this._board[_-2]&&!this._board[_-3]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,_-1)&&!this._attacked(l,w)&&ye(o,a,this._kings[a],w,q,void 0,k.QSIDE_CASTLE)}}if(!t||this._kings[a]===-1)return o;const d=[];for(let _=0,w=o.length;_<w;_++)this._makeMove(o[_]),this._isKingAttacked(a)||d.push(o[_]),this._undoMove();return d}move(t,{strict:n=!1}={}){let r=null;if(typeof t=="string")r=this._moveFromSan(t,n);else if(t===null)r=this._moveFromSan(bn,n);else if(typeof t=="object"){const s=this._moves();for(let o=0,a=s.length;o<a;o++)if(t.from===W(s[o].from)&&t.to===W(s[o].to)&&(!("promotion"in s[o])||t.promotion===s[o].promotion)){r=s[o];break}}if(!r)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&r.flags&k.NULL_MOVE)throw new Error("Null move not allowed when in check");const i=new Ot(this,r);return this._makeMove(r),this._incPositionCount(),i}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,n){this._hash^=this._pieceKey(t),this._board[n]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(n)}_makeMove(t){var i,s,o,a;const n=this._turn,r=ct(n);if(this._push(t),t.flags&k.NULL_MOVE){n===ne&&this._moveNumber++,this._halfMoves++,this._turn=r,this._epSquare=H;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&k.EP_CAPTURE&&(this._turn===ne?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:n})),this._board[t.to].type===q){if(this._kings[n]=t.to,t.flags&k.KSIDE_CASTLE){const l=t.to-1,c=t.to+1;this._movePiece(c,l)}else if(t.flags&k.QSIDE_CASTLE){const l=t.to+1,c=t.to-2;this._movePiece(c,l)}this._castling[n]=0}if(this._castling[n]){for(let l=0,c=be[n].length;l<c;l++)if(t.from===be[n][l].square&&this._castling[n]&be[n][l].flag){this._castling[n]^=be[n][l].flag;break}}if(this._castling[r]){for(let l=0,c=be[r].length;l<c;l++)if(t.to===be[r][l].square&&this._castling[r]&be[r][l].flag){this._castling[r]^=be[r][l].flag;break}}if(this._hash^=this._castlingKey(),t.flags&k.BIG_PAWN){let l;n===ne?l=t.to-16:l=t.to+16,!(t.to-1&136)&&((i=this._board[t.to-1])==null?void 0:i.type)===D&&((s=this._board[t.to-1])==null?void 0:s.color)===r||!(t.to+1&136)&&((o=this._board[t.to+1])==null?void 0:o.type)===D&&((a=this._board[t.to+1])==null?void 0:a.color)===r?(this._epSquare=l,this._hash^=this._epKey()):this._epSquare=H}else this._epSquare=H;t.piece===D?this._halfMoves=0:t.flags&(k.CAPTURE|k.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===ne&&this._moveNumber++,this._turn=r,this._hash^=mn}undo(){const t=this._hash,n=this._undoMove();if(n){const r=new Ot(this,n);return this._decPositionCount(t),r}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=mn;const r=this._turn,i=ct(r);if(n.flags&k.NULL_MOVE)return n;if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:r})),n.captured)if(n.flags&k.EP_CAPTURE){let s;r===ne?s=n.to-16:s=n.to+16,this._set(s,{type:D,color:i})}else this._set(n.to,{type:n.captured,color:i});if(n.flags&(k.KSIDE_CASTLE|k.QSIDE_CASTLE)){let s,o;n.flags&k.KSIDE_CASTLE?(s=n.to+1,o=n.to-1):(s=n.to-2,o=n.to+1),this._movePiece(o,s)}return n}pgn({newline:t=`
`,maxWidth:n=0}={}){const r=[];let i=!1;for(const d in this._header)this._header[d]&&r.push(`[${d} "${this._header[d]}"]`+t),i=!0;i&&this._history.length&&r.push(t);const s=d=>{const y=this._comments[this.fen()];if(typeof y<"u"){const _=d.length>0?" ":"";d=`${d}${_}{${y}}`}return d},o=[];for(;this._history.length>0;)o.push(this._undoMove());const a=[];let l="";for(o.length===0&&a.push(s(""));o.length>0;){l=s(l);const d=o.pop();if(!d)break;if(!this._history.length&&d.color==="b"){const y=`${this._moveNumber}. ...`;l=l?`${l} ${y}`:y}else d.color==="w"&&(l.length&&a.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(d,this._moves({legal:!0})),this._makeMove(d)}if(l.length&&a.push(s(l)),a.push(this._header.Result||"*"),n===0)return r.join("")+a.join(" ");const c=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},u=function(d,y){for(const _ of y.split(" "))if(_){if(d+_.length>n){for(;c();)d--;r.push(t),d=0}r.push(_),d+=_.length,r.push(" "),d++}return c()&&d--,d};let h=0;for(let d=0;d<a.length;d++){if(h+a[d].length>n&&a[d].includes("{")){h=u(h,a[d]);continue}h+a[d].length>n&&d!==0?(r[r.length-1]===" "&&r.pop(),r.push(t),h=0):d!==0&&(r.push(" "),h++),r.push(a[d]),h+=a[d].length}return r.join("")}header(...t){for(let n=0;n<t.length;n+=2)typeof t[n]=="string"&&typeof t[n+1]=="string"&&(this._header[t[n]]=t[n+1]);return this._header}setHeader(t,n){return this._header[t]=n??jn[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=jn[t]||null,!0):!1}getHeaders(){const t={};for(const[n,r]of Object.entries(this._header))r!==null&&(t[n]=r);return t}loadPgn(t,{strict:n=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(t=t.replace(new RegExp(r,"g"),`
`));const i=ju(t);this.reset();const s=i.headers;let o="";for(const c in s)c.toLowerCase()==="fen"&&(o=s[c]),this.header(c,s[c]);if(!n)o&&this.load(o,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let a=i.root;for(;a;){if(a.move){const c=this._moveFromSan(a.move,n);if(c==null)throw new Error(`Invalid move in PGN: ${a.move}`);this._makeMove(c),this._incPositionCount()}a.comment!==void 0&&(this._comments[this.fen()]=a.comment),a=a.variations[0]}const l=i.result;l&&Object.keys(this._header).length&&this._header.Result!==l&&this.setHeader("Result",l)}_moveToSan(t,n){let r="";if(t.flags&k.KSIDE_CASTLE)r="O-O";else if(t.flags&k.QSIDE_CASTLE)r="O-O-O";else{if(t.flags&k.NULL_MOVE)return bn;if(t.piece!==D){const i=of(t,n);r+=t.piece.toUpperCase()+i}t.flags&(k.CAPTURE|k.EP_CAPTURE)&&(t.piece===D&&(r+=W(t.from)[0]),r+="x"),r+=W(t.to),t.promotion&&(r+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(t,n=!1){let r=yn(t);if(n||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O")),r==bn)return{color:this._turn,from:0,to:0,piece:"k",flags:k.NULL_MOVE};let i=hi(r),s=this._moves({legal:!0,piece:i});for(let d=0,y=s.length;d<y;d++)if(r===yn(this._moveToSan(s[d],s)))return s[d];if(n)return null;let o,a,l,c,u,h=!1;if(a=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(o=a[1],l=a[2],c=a[3],u=a[4],l.length==1&&(h=!0)):(a=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(o=a[1],l=a[2],c=a[3],u=a[4],l.length==1&&(h=!0))),i=hi(r),s=this._moves({legal:!0,piece:o||i}),!c)return null;for(let d=0,y=s.length;d<y;d++)if(l){if((!o||o.toLowerCase()==s[d].piece)&&A[l]==s[d].from&&A[c]==s[d].to&&(!u||u.toLowerCase()==s[d].promotion))return s[d];if(h){const _=W(s[d].from);if((!o||o.toLowerCase()==s[d].piece)&&A[c]==s[d].to&&(l==_[0]||l==_[1])&&(!u||u.toLowerCase()==s[d].promotion))return s[d]}}else if(r===yn(this._moveToSan(s[d],s)).replace("x",""))return s[d];return null}ascii(){let t=`   +------------------------+
`;for(let n=A.a8;n<=A.h1;n++){if(vt(n)===0&&(t+=" "+"87654321"[Fe(n)]+" |"),this._board[n]){const r=this._board[n].type,s=this._board[n].color===G?r.toUpperCase():r.toLowerCase();t+=" "+s+" "}else t+=" . ";n+1&136&&(t+=`|
`,n+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const n=this._moves({legal:!1});let r=0;const i=this._turn;for(let s=0,o=n.length;s<o;s++)this._makeMove(n[s]),this._isKingAttacked(i)||(t-1>0?r+=this.perft(t-1):r++),this._undoMove();return r}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let n=[];for(let r=A.a8;r<=A.h1;r++)this._board[r]==null?n.push(null):n.push({square:W(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(t.push(n),n=[],r+=8);return t}squareColor(t){if(t in A){const n=A[t];return(Fe(n)+vt(n))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const n=[],r=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const i=n.pop();if(!i)break;t?r.push(new Ot(this,i)):r.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return r}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const n=this._positionCount.get(t)??0;n===1?this._positionCount.delete(t):this._positionCount.set(t,n-1)}_pruneComments(){const t=[],n={},r=i=>{i in this._comments&&(n[i]=this._comments[i])};for(;this._history.length>0;)t.push(this._undoMove());for(r(this.fen());;){const i=t.pop();if(!i)break;this._makeMove(i),r(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const n=this._comments[t];return delete this._comments[t],{fen:t,comment:n}})}setCastlingRights(t,n){for(const i of[q,Se])n[i]!==void 0&&(n[i]?this._castling[t]|=It[i]:this._castling[t]&=~It[i]);this._updateCastlingRights();const r=this.getCastlingRights(t);return(n[q]===void 0||n[q]===r[q])&&(n[Se]===void 0||n[Se]===r[Se])}getCastlingRights(t){return{[q]:(this._castling[t]&It[q])!==0,[Se]:(this._castling[t]&It[Se])!==0}}moveNumber(){return this._moveNumber}};const lf={p:"pawn",n:"knight",b:"bishop",r:"rook",q:"queen",k:"king"},zn="abcdefgh",cf="12345678";class uf{constructor(t){this.chess=new af(t),this.updateBoardCache()}reset(t){try{this.chess.load(t||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")}catch(n){console.error("Invalid FEN:",t,n),this.chess.reset()}this.updateBoardCache()}updateBoardCache(){this.board=Array(64).fill(null);const t=this.chess.board();for(let i=0;i<8;i++)for(let s=0;s<8;s++){const o=t[i][s];o&&(this.board[i*8+s]={type:o.type,color:o.color})}this.turn=this.chess.turn();const n=this.chess.getCastlingRights("w"),r=this.chess.getCastlingRights("b");this.castling={K:n.k,Q:n.q,k:r.k,q:r.q}}getFen(){return this.chess.fen()}algebraicToIndex(t){if(!t||t.length!==2)return-1;const n=zn.indexOf(t[0]),r=8-parseInt(t[1]);return n===-1||r<0||r>7?-1:r*8+n}indexToAlgebraic(t){const n=t%8,r=8-Math.floor(t/8);return zn[n]+r}getPiece(t){const n=typeof t=="string"?this.algebraicToIndex(t):t;return this.board[n]}getLegalMoves(t){const n=typeof t=="string"?this.algebraicToIndex(t):t,r=this.indexToAlgebraic(n);return this.chess.moves({square:r,verbose:!0}).map(s=>{let o;return s.flags.includes("k")&&(o=s.color==="w"?"K":"k"),s.flags.includes("q")&&(o=s.color==="w"?"Q":"q"),{from:this.algebraicToIndex(s.from),to:this.algebraicToIndex(s.to),fromAlg:s.from,toAlg:s.to,promotion:s.promotion,castling:o}})}move(t,n,r=null){try{const i={from:typeof t=="string"?t:this.indexToAlgebraic(t),to:typeof n=="string"?n:this.indexToAlgebraic(n),promotion:r||void 0};if(this.chess.move(i))return this.updateBoardCache(),!0}catch{}return!1}parseUci(t){return!t||t.length<4?null:{from:t.substring(0,2),to:t.substring(2,4),promotion:t.length>4?t[4].toLowerCase():null}}moveUci(t){const n=this.parseUci(t);return n?this.move(n.from,n.to,n.promotion):!1}moveSan(t){try{const n=this.chess.move(t);if(n)return this.updateBoardCache(),n}catch{}return null}inCheck(){return this.chess.inCheck()}isGameOver(){return this.chess.isGameOver()}getSan(t){const n=this.parseUci(t);if(!n)return null;const i=this.chess.moves({verbose:!0}).find(s=>s.from===n.from&&s.to===n.to&&(!n.promotion||s.promotion===n.promotion));return i?i.san:null}}const ro={Game:uf,PIECE_TYPES:lf,FILES:zn,RANKS:cf};class ff{constructor(t,n={}){this.containerId=t,this.container=null,this.options={flipped:!1,interactive:!0,onMove:null,...n},this.cg=null,this.game=null,this.fen=null,this.mounted=!1}mount(){return this.mounted?Promise.resolve():new Promise(t=>{const n=()=>{if(this.container=document.getElementById(this.containerId),!this.container){requestAnimationFrame(n);return}const r=this.container.getBoundingClientRect();if(r.width<50||r.height<50){requestAnimationFrame(n);return}this.initChessground(),this.mounted=!0,t()};n()})}initChessground(){this.cg=Lu(this.container,{orientation:this.options.flipped?"black":"white",movable:{free:!1,color:"both",dests:new Map,events:{after:(n,r)=>this.handleMove(n,r)}},draggable:{enabled:!0,showGhost:!0},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:150},premovable:{enabled:!1}});let t;new ResizeObserver(()=>{clearTimeout(t),t=setTimeout(()=>{this.cg&&this.cg.redrawAll()},50)}).observe(this.container)}setPosition(t){if(!this.cg)return;this.fen=t,this.game=new ro.Game(t);const n=t.split(" "),r=n[1]==="w"?"white":"black";this.cg.set({fen:n[0],turnColor:r,lastMove:void 0,movable:{color:this.options.interactive?r:void 0,dests:this.options.interactive?this.getDestinations():new Map},check:this.isInCheck()}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.cg&&this.cg.redrawAll()})})}getDestinations(){if(!this.game)return new Map;const t=new Map;for(let n=0;n<64;n++){const r=this.game.board[n];if(r&&r.color===this.game.turn){const i=this.game.indexToAlgebraic(n),o=this.game.getLegalMoves(n).map(a=>a.toAlg);o.length>0&&t.set(i,o)}}return t}isInCheck(){return this.game?this.game.inCheck():!1}handleMove(t,n){if(!this.game)return;const r=this.game.getPiece(t),s=(r==null?void 0:r.type)==="p"&&(n[1]==="8"||n[1]==="1")?"q":null;if(this.game.move(t,n,s)){if(this.setPosition(this.game.getFen()),this.options.onMove){const a=t+n+(s||"");this.options.onMove(a,this.game.getFen())}}else this.setPosition(this.fen)}flip(){this.options.flipped=!this.options.flipped,this.cg&&this.cg.set({orientation:this.options.flipped?"black":"white"})}setFlipped(t){this.options.flipped!==t&&(this.options.flipped=t,this.cg&&this.cg.set({orientation:t?"black":"white"}))}setInteractive(t){if(this.options.interactive=t,this.cg&&this.game){const n=this.game.turn==="w"?"white":"black";this.cg.set({movable:{color:t?n:void 0,dests:t?this.getDestinations():new Map}})}}redraw(){this.cg&&this.cg.redrawAll()}}const hf=-.00368208;function Un(e){const t=Math.max(-1e3,Math.min(1e3,e));return 2/(1+Math.exp(hf*t))-1}function di(e){return 50+50*Un(e)}function df(){return{training:!1,settingsOpen:!1,loading:!1,hasStarted:!1,status:"",statusType:"",message:"",messageClass:"",lichessUser:localStorage.getItem("lichessUser")||"",chesscomUser:localStorage.getItem("chesscomUser")||"",numGames:parseInt(localStorage.getItem("numGames"))||20,analysisDepth:parseInt(localStorage.getItem("analysisDepth"))||15,tacticsFound:0,timeControls:[{id:"bullet",name:"Bullet",enabled:!1},{id:"blitz",name:"Blitz",enabled:!0},{id:"rapid",name:"Rapid",enabled:!0},{id:"classical",name:"Classical",enabled:!0},{id:"daily",name:"Daily",enabled:!0}],tactics:[],currentIndex:0,solved:!1,solutionShown:!1,autoNext:localStorage.getItem("autoNext")!=="false",board:null,stockfish:null,user:null,get currentTactic(){return this.tactics[this.currentIndex]||null},get badgeClass(){var t;const e=(t=this.currentTactic)==null?void 0:t.mistake_type;return e==="??"?"blunder":e==="?"?"mistake":""},init(){const e=localStorage.getItem("timeControls");if(e)try{const t=JSON.parse(e);this.timeControls.forEach(n=>{t[n.id]!==void 0&&(n.enabled=t[n.id])})}catch{}this.$watch("timeControls",()=>this.saveTimeControls(),{deep:!0}),this.$watch("autoNext",t=>localStorage.setItem("autoNext",t.toString()))},saveTimeControls(){const e={};this.timeControls.forEach(t=>e[t.id]=t.enabled),localStorage.setItem("timeControls",JSON.stringify(e))},async loadTactics(){const e=this.lichessUser.trim(),t=this.chesscomUser.trim();if(!e&&!t){this.setStatus("Enter at least one username","error");return}e&&localStorage.setItem("lichessUser",e),t&&localStorage.setItem("chesscomUser",t),localStorage.setItem("numGames",this.numGames.toString()),localStorage.setItem("analysisDepth",this.analysisDepth.toString()),this.settingsOpen=!1,this.loading=!0,this.tactics=[],this.tacticsFound=0,this.gamesAnalyzed=0;try{if(this.setStatus("Loading engine..."),!this.stockfish){const r=Xr.isSupported();console.log("Engine support:",r),r.recommended?(console.log("Using modern Stockfish with SharedArrayBuffer"),this.stockfish=new Xr):(console.log("Falling back to legacy Stockfish"),this.stockfish=new _c)}await this.stockfish.init();const n=this.getEnabledPerfTypes();if(e&&await this.processLichessGames(e,n),t&&await this.processChesscomGames(t,n),this.gamesAnalyzed===0){this.setStatus("No games found","error"),this.loading=!1;return}if(this.tactics.length===0){this.setStatus("No mistakes found",""),this.loading=!1;return}this.currentIndex=0,this.training=!0,this.setStatus(""),await this.$nextTick(),await this.initBoard(),this.loadCurrentTactic()}catch(n){console.error("Error:",n),this.setStatus(`Error: ${n.message}`,"error")}finally{this.loading=!1}},async processLichessGames(e,t){this.setStatus("Downloading Lichess games...");const n=[];t.includes("bullet")&&n.push("bullet","ultraBullet"),t.includes("blitz")&&n.push("blitz"),t.includes("rapid")&&n.push("rapid"),t.includes("classical")&&n.push("classical"),t.includes("correspondence")&&n.push("correspondence");const r=new URLSearchParams({perfType:n.join(","),moves:"true",max:this.numGames.toString()});try{const i=await fetch(`https://lichess.org/api/games/user/${e}?${r}`,{headers:{Accept:"application/x-chess-pgn"}});if(!i.ok){console.warn("Lichess API error:",i.status);return}const s=await i.text(),o=this.splitPgn(s);for(let a=0;a<o.length;a++){this.setStatus(`Analyzing Lichess game ${a+1}/${o.length}...`);const l=await this.analyzeGame(o[a],e);this.tactics.push(...l),this.tacticsFound=this.tactics.length,this.gamesAnalyzed++}}catch(i){console.warn("Lichess fetch error:",i)}},async processChesscomGames(e,t){this.setStatus("Downloading Chess.com games...");const n=new Date,r=[];for(let i=0;i<3&&r.length<this.numGames;i++){const s=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0");try{const a=await fetch(`https://api.chess.com/pub/player/${e.toLowerCase()}/games/${s}/${o}/pgn`);if(a.ok){const l=await a.text(),c=this.splitPgn(l);for(const u of c){if(r.length>=this.numGames)break;this.matchesTimeControl(u,t)&&r.push(u)}}}catch(a){console.warn(`Chess.com error for ${s}/${o}:`,a)}n.setMonth(n.getMonth()-1)}for(let i=0;i<r.length;i++){this.setStatus(`Analyzing Chess.com game ${i+1}/${r.length}...`);const s=await this.analyzeGame(r[i],e);this.tactics.push(...s),this.tacticsFound=this.tactics.length,this.gamesAnalyzed++}},splitPgn(e){if(!(e!=null&&e.trim()))return[];const t=[];let n=[];for(const r of e.split(`
`))r.startsWith("[Event ")&&n.length>0&&(t.push(n.join(`
`)),n=[]),n.push(r);return n.length>0&&t.push(n.join(`
`)),t},matchesTimeControl(e,t){const n=e.match(/\[TimeControl "([^"]+)"\]/);if(!n)return!0;const r=n[1];if(r==="-")return t.includes("correspondence");const i=r.split("+"),s=parseInt(i[0])||0,o=parseInt(i[1])||0,a=s+40*o;return a<180?t.includes("bullet"):a<600?t.includes("blitz"):a<1800?t.includes("rapid"):t.includes("classical")},async analyzeGame(e,t){var y;const n=t.toLowerCase(),r={};for(const _ of e.matchAll(/\[(\w+)\s+"([^"]*)"\]/g))r[_[1]]=_[2];console.log("=".repeat(80)),console.log(`Analyzing: ${r.White} vs ${r.Black}`),console.log("=".repeat(80));const i=(r.White||"").toLowerCase(),s=(r.Black||"").toLowerCase();let o=null;if(i.includes(n))o="w";else if(s.includes(n))o="b";else return[];console.log(`User plays: ${o==="w"?"White":"Black"}`);const a=e.match(/\n\n([\s\S]+)$/);if(!a)return[];const l=a[1].replace(/\{[^}]*\}/g,"").replace(/\([^)]*\)/g,"").replace(/\$\d+/g,"").replace(/\d+\.\.\./g,"").trim(),c=[];for(const _ of l.matchAll(/(\d+)\.\s*(\S+)(?:\s+(\S+))?/g)){const w=parseInt(_[1]);_[2]&&!this.isResult(_[2])&&c.push({num:w,san:_[2],color:"w"}),_[3]&&!this.isResult(_[3])&&c.push({num:w,san:_[3],color:"b"})}const u=[],h=new window.Chess.Game,d=Math.min(this.analysisDepth||15,25);console.log(`Total moves: ${c.length}, analyzing at depth ${d}`),console.log("");for(const _ of c){if(!(_.color===o)){h.moveSan(_.san)||console.warn(`Failed to play opponent move: ${_.san}`);continue}const v=h.getFen(),E=v.split(" ")[1]==="w",M=await this.stockfish.analyze(v,d),P=h.moveSan(_.san);if(!P){console.warn(`Failed to play user move: ${_.san}`);continue}P.lan||P.from+P.to+(P.promotion||"");const R=h.getFen();if(h.isGameOver()){console.log(`--- Move ${_.num}. ${_.san} | Skipping: Game over after this move ---`),console.log("");continue}const F=R.split(" ")[1]==="w",Z=await this.stockfish.analyze(R,d),ee=(M.eval||0)*100,$=(Z.eval||0)*100;let te=E?ee:-ee,K=F?$:-$,z=te,re=K;o==="b"&&(z=-te,re=-K);const en=Un(z),wt=Un(re),pe=en-wt,He=pe>=.3,St=pe>=.2&&pe<.3,tn=He?" BLUNDER":St?" MISTAKE":" OK",xt=di(z),nt=di(re);console.log(`--- Move ${_.num}. ${_.san} (${_.color==="w"?"White":"Black"}) ---`),console.log(`FEN: ${v}`),console.log(`Raw eval before: ${ee.toFixed(0)}cp, after: ${$.toFixed(0)}cp`),console.log(`Eval Before: ${z.toFixed(0)}cp (${xt.toFixed(1)}%)`),console.log(`Eval After:  ${re.toFixed(0)}cp (${nt.toFixed(1)}%)`),console.log(`Delta: ${pe.toFixed(3)} (${(pe*50).toFixed(1)}%) | ${tn}`),console.log(`PV: ${(M.pv||[]).slice(0,3).join(" ")}`),console.log(""),pe>=.2&&u.push({fen:v,user_move:_.san,correct_line:((y=M.pv)==null?void 0:y.slice(0,3))||[],mistake_type:He?"??":"?",mistake_analysis:`${He?"Blunder":"Mistake"}: ${xt.toFixed(0)}%  ${nt.toFixed(0)}%`,position_context:`Move ${_.num}, ${o==="w"?"White":"Black"} to play`,game_url:r.Link||r.Site||"",game_white:r.White||"",game_black:r.Black||""})}return console.log("=".repeat(80)),console.log(`Analysis complete. Found ${u.length} tactics.`),console.log("=".repeat(80)),u},isResult(e){return["1-0","0-1","1/2-1/2","*"].includes(e)},getEnabledPerfTypes(){const e=[];return this.timeControls.forEach(t=>{t.enabled&&(t.id==="bullet"&&e.push("bullet"),t.id==="blitz"&&e.push("blitz"),t.id==="rapid"&&e.push("rapid"),t.id==="classical"&&e.push("classical"),t.id==="daily"&&e.push("correspondence"))}),e},shuffle(e){const t=[...e];for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t},async initBoard(){this.board||(this.board=new ff("board",{interactive:!0,onMove:e=>this.handleMove(e)})),await this.board.mount()},loadCurrentTactic(){var n;const e=this.currentTactic;if(!e)return;this.solved=!1,this.solutionShown=!1,this.setMessage("","");const t=(n=e.position_context)==null?void 0:n.includes("Black");this.board.setFlipped(t),this.board.setPosition(e.fen),this.board.setInteractive(!0)},handleMove(e){var r,i,s;if(this.solved)return;const t=((s=(i=(r=this.currentTactic)==null?void 0:r.correct_line)==null?void 0:i[0])==null?void 0:s.toLowerCase())||"",n=e.toLowerCase();if(n===t||t.startsWith(n)||n.startsWith(t)){this.solved=!0;const o=this.getFirstMoveSan();this.setMessage(`${o} is correct`,"correct"),this.board.setInteractive(!1),this.autoNext&&setTimeout(()=>this.nextTactic(),1200)}else this.setMessage("Try again","incorrect"),setTimeout(()=>{this.board.setPosition(this.currentTactic.fen),this.setMessage("","")},800)},getFirstMoveSan(){var t;const e=this.currentTactic;if(!e||!((t=e.correct_line)!=null&&t.length))return"?";try{return new window.Chess.Game(e.fen).getSan(e.correct_line[0])||e.correct_line[0]}catch{return e.correct_line[0]}},showSolution(){this.solutionShown=!0},getSolutionSan(){var t;const e=this.currentTactic;return!e||!((t=e.correct_line)!=null&&t.length)?"?":this.convertUciLineToSan(e.fen,e.correct_line).join(" ")},convertUciLineToSan(e,t){if(!e||!(t!=null&&t.length))return t||[];try{const n=new window.Chess.Game(e),r=[];for(const i of t){const s=this.uciToSan(n,i);s?(r.push(s),n.moveUci(i)):r.push(i)}return r}catch(n){return console.warn("Failed to convert UCI to SAN:",n),t}},uciToSan(e,t){return e.getSan?e.getSan(t):t},prevTactic(){this.currentIndex>0&&(this.currentIndex--,this.loadCurrentTactic())},nextTactic(){this.currentIndex<this.tactics.length-1?(this.currentIndex++,this.loadCurrentTactic()):this.setMessage("All done!","correct")},openAnalysis(){var t;const e=(t=this.currentTactic)==null?void 0:t.fen;if(e){const n=e.replace(/ /g,"_"),i=e.split(" ")[1]==="w"?"white":"black";window.open(`https://lichess.org/analysis?fen=${n}&color=${i}`,"_blank")}},backToSetup(){this.training=!1,this.tactics=[],this.currentIndex=0},signOut(){this.user=null},setStatus(e,t=""){this.status=e,this.statusType=t},setMessage(e,t=""){this.message=e,this.messageClass=t}}}window.Chess=ro;window.Alpine=dr;dr.data("tacticsApp",df);dr.start();
